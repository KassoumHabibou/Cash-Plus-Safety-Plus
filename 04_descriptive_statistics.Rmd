---
title: "Cash Plus, Safety Plus? Intimate Partner Violence and Productive Inclusion in Mauritania"
subtitle: "Descriptive statistics"
author: "IBRAHIM KASSOUM Habibou"
date: '`r format (Sys.Date(), "%d %B %Y")`'
output: 
  officedown::rdocx_document:
    mapstyles:
      Normal: ['First Paragraph']
---

```{r setup, include=FALSE}
# Set random seed for reproducibility
set.seed(7654)

# Set number of decimal places to display
options(digits = 3)

# Configure knitr chunk options:
knitr::opts_chunk$set(
 echo = FALSE,          # Don't show R code in output
 message = FALSE,       # Don't show messages
 warning = FALSE,       # Don't show warnings
 cache = FALSE,         # Don't cache results
 fig.align = 'center',  # Center figures
 fig.width = 6,         # Figure width in inches
 fig.asp = 0.618,       # Figure aspect ratio (golden ratio)
 fig.show = "hold"      # Hold multiple plots until end of chunk
)

# Set dplyr print options to show 6 rows max
options(dplyr.print_min = 6, dplyr.print_max = 6)


```


```{r, include=FALSE, results='hide', echo=FALSE}

######################## Importing library and external files ##################
### List of required packages
required_packages <- c("tidyverse", "dplyr","readr","officedown", "officer", "gtsummary", "flextable", "magrittr", "lmtest","haven", "readxl","data.table","stringr","labelled","sandwich","car","fastDummies")

### Check if packages are installed
missing_packages <- setdiff(required_packages, installed.packages()[,"Package"])

### Install missing packages
if (length(missing_packages) > 0) {
  install.packages(missing_packages)
}

### Load all packages
lapply(required_packages, library, character.only = TRUE)

# Remove all objects
rm(list = ls())
```


```{r echo=F}

set_gtsummary_theme(theme_gtsummary_compact())

######### Create default BioAVR table from dataframe
#
# Dependencies : dplyr, flextable, officer
# source link : https://www.r-bloggers.com/2021/11/publication-ready-tables-with-flextable-and-own-theme-in-r/

customtab_defaults <- function(){
set_flextable_defaults(font.family = "Times New Roman",
font.size = 9,
border.color = "black",  
width = 2  # Set your preferred default column width (in inches)
)
}
FitFlextableToPage <- function(ft, pgwidth = 25){

  ft_out <- ft %>% autofit()

  ft_out <- width(ft_out, width = dim(ft_out)$widths*pgwidth /(flextable_dim(ft_out)$widths))
  return(ft_out)
}

custom_tab <- function(df, header, footer){
  
  flextable(df) %>%
   # width(width = 2) %>%  # Set column width for all columns
    add_header_lines(header) %>%
    add_footer_lines(footer) %>%
    bold(i = 1, part = "header") %>%
    hline_top(part = "header", 
              border = fp_border(color = "white", width = 3, style = "solid")) %>%
    hline(i = 1, part = "header",
          border = fp_border(color = "black", width = 0.25, style = "solid")) %>%
    hline_top(part = "body",
              border = fp_border(color = "black", width = 0.25, style = "solid")) %>%
    hline_bottom(part = "body",
                 border = fp_border(color = "black", width = 0.25, style = "solid")) %>%
    hline_bottom(part = "footer",
                 border = fp_border(color = "black", width = 0.25, style = "solid")) %>%
    border_inner_h(part = "body",
                   border = fp_border(color = "black", width = 0.25, style = "dotted")) %>%
    bg(part = "body", bg = "white") %>%
    align(part = "all", align = "center") %>%
    align(j = 1, part = "all", align = "left")
}

```



```{r echo=F}
# This function aims at providing customized statistics in the table that 
# with be produced using the gtsummary package
# Basically the gtsummary does not include such a function 
add_by_n <- function(data, variable, by, tbl, ...) {
  data %>%
    select(all_of(c(variable, by))) %>%
    dplyr::group_by(.data[[by]]) %>%
    dplyr::summarise_all(~sum(!is.na(.))) %>%
    rlang::set_names(c("by", "variable")) %>%
    dplyr::left_join(
      tbl$df_by %>% select(by, by_col),
      by = "by"
    ) %>%
    mutate(
      by_col = paste0("add_n_", by_col),
      variable = style_number(variable)
    ) %>%
    select(-by) %>%
    tidyr::pivot_wider(names_from = by_col, 
                       values_from = variable)
}

## define custom test
fisher.test.simulate.p.values <- function(data, variable, by, ...) {
  test_results <- stats::fisher.test(data[[variable]], data[[by]], simulate.p.value = TRUE)
  
  # Return a tibble instead of a list
  tibble::tibble(
    p.value = test_results$p.value,
    test = test_results$method,
    conf.int = test_results$conf.int
  )
}
```

```{r}

######################## Loading the datasets ##################################
# Read the stata file containing the global dataframe into allrounds_MRT_hh
baseline_MRT_hh <- readRDS(paste0(getwd(),"/output/data/baseline_MRT_hh.rds"))
allrounds_MRT_hh <- readRDS(paste0(getwd(),"/output/data/allrounds_MRT_hh.rds"))
followup_MRT_hh <- readRDS(paste0(getwd(),"/output/data/followup_MRT_hh_and_ipv_MRT_hh.rds"))
ipv_df_all <- readRDS(paste0(getwd(),"/output/data/ipv_df_all.rds"))

# Convert treatment variables from numeric to factor variables for both datasets
# This is useful for regression analysis and plotting as factors are treated as categorical variables
# For baseline dataset
baseline_MRT_hh$treatment_pi <- haven::as_factor(baseline_MRT_hh$treatment_pi)           # Convert PM treatment to factor
baseline_MRT_hh$treatment_csh_trnsfr <- haven::as_factor(baseline_MRT_hh$treatment_csh_trnsfr) # Convert cash transfer treatment to factor

# For all rounds dataset  
followup_MRT_hh$treatment_pi <- haven::as_factor(followup_MRT_hh$treatment_pi)         # Convert PM treatment to factor
followup_MRT_hh$treatment_csh_trnsfr <- haven::as_factor(followup_MRT_hh$treatment_csh_trnsfr) # Convert cash transfer treatment to factor



# For the IPV module 
ipv_df_all$treatment_pi <- haven::as_factor(ipv_df_all$treatment_pi)         # Convert pi treatment to factor
ipv_df_all$treatment_csh_trnsfr <- haven::as_factor(ipv_df_all$treatment_csh_trnsfr) # Convert cash transfer treatment to factor

followup_MRT_hh_pi <- followup_MRT_hh %>%
  filter(reg_hh_pi_mrt == 1)

followup_MRT_hh_csh_trnsfr <- followup_MRT_hh %>%
  filter(reg_hh_csh_mrt == 1)

followup_MRT_hh  <- followup_MRT_hh %>%
  filter(reg_hh_csh_mrt == 1| reg_hh_pi_mrt == 1)


control_ipv_vars_fac <- c("control_ipv_sev_12m")
emotional_ipv_vars_fac <- c("emo_ipv_sev_12m")
physical_ipv_vars_fac <- c("phy_ipv_sev_12m")
sexual_ipv_vars_fac <- c("sex_ipv_sev_12m")
sexual_phy_ipv_vars_fac <- c("sex_phy_ipv_sev_12m")
economic_ipv_vars_fac <- c("eco_ipv_sev_12m")
other_ipv_vars_fac <- c("all_ipv_sev_12m")

control_ipv_vars_num <- c("control_ipv_sev_index")
emotional_ipv_vars_num <- c("emo_ipv_sev_index") #, "emo_severity_12m_z"
physical_ipv_vars_num <- c("phy_ipv_sev_index")
sexual_ipv_vars_num <- c("sex_ipv_sev_index")
sexual_phy_ipv_vars_num <- c("sex_phy_ipv_sev_index")
economic_ipv_vars_num <- c("eco_ipv_sev_index")
other_ipv_vars_num <- c("all_ipv_sev_index")

```

<!---BLOCK_TOC--->


<!---BLOCK_LANDSCAPE_START--->
\newpage
# Summary

**Key Takeaways**:

- Around 54 percent of the women who participated in the evaluation gave their consent for the IPV module.
- Reasons for non-consent to the IPV module appear balanced between the different intervention groups with no significant differences.  
- Overall, beneficiaries of the productive inclusion program present higher rates of IPV than recipients of the Tekavoul program.  
- The most common type of violence is the partner controlling behavior, affecting over half of the women in the entire sample. The variation between groups is small.  
- Interestingly, intervention groups generally show slightly higher IPV rates than control groups, which could indicate:  
  * Increased awareness and comfort in reporting among intervention group participants.  
  * Potential backlash effects from economic or social interventions.  
- The psychosocial package presents the highest rate of sexual IPV, while economic IPV is more common among recipients of the capital and full packages.  
- The variables that will be considered in the heterogeneity analysis are:  
  * The sex of the Partner  
  * The beneficiary relationship to the Partner  
  * Partner literacy  
  * Beneficiary literacy  
  * Partner number of years of education (the median value as the threshold)  
  * Beneficiary number of years of education (the median value as the threshold)
  * Beneficiary share of savings owned by their partner (the median value as the threshold)
  * Control over earnings index (the median value as the threshold)
  * Control over household resources index (the median value as the threshold)
  * Intra-household dynamics index (the median value as the threshold)
  * Beneficiary's share of total revenue (the median value as the threshold) 
  * Age gap between the Partner and the beneficiary (the median value as the threshold) 
- Enumerators fixed effects (FE) will be included in all regressions since there is variation in the number of surveyed individuals across treatment group.
- They are not informations on drinking behavior 

\newpage
# Consent for the IPV module balance 


The following table presents the balance test for the IPV (Intimate Partner Violence) module from the second follow-up survey. Understanding this balance is important because it helps determine whether the sample remains properly randomized. Any imbalance could potentially affect the results, which is particularly important since IPV is the main outcome measure in this analysis.

- Out of the total sample size of 2,561 individuals, 54% (1,371 respondents) participated in the IPV module. This indicates that just over half of the sample provided consent, which is a common challenge in sensitive data collection.
- A notable proportion (28 percent) of non-participants were over the age of 50 and 9 percent of them are widow hence less exposed to the IPV.
- The remaining 9 percent of the women did not respond due to various reasons, including household refusal, absence during the survey period, or the respondent no longer residing in the household.
- *There are 15 women in the cash assignment group that are above 50 and included in the tekavoul program impact evaluation and answered to the IPV module*
- *27 women in the cash assignment group are aged above 50*.

```{r}

ipv_df_all <- ipv_df_all %>%
  mutate(status_noconsent=as.character(labelled::unlabelled(status_noconsent)),
         status_noconsent=ifelse(is.na(status_noconsent)," La répondante clef a participé",status_noconsent)%>%
           structure(label = "Status of consent to the IPV module"))

dataconsent <- ipv_df_all %>%
  filter(reg_hh_csh_mrt == 1 | reg_hh_pi_mrt == 1) %>% 
  fastDummies::dummy_cols(select_columns="status_noconsent", omit_colname_prefix = TRUE)

colnames(dataconsent) <- gsub("status_noconsent_", "",colnames(dataconsent), fixed = T)
# Create a table with tbl_summary
ipv_df_all %>%
  filter(reg_hh_csh_mrt == 1 | reg_hh_pi_mrt == 1) %>% 
  select(status_noconsent) %>% 
  tbl_summary(
    statistic = list(all_categorical = "{n} ({p}%)"),
    missing = "ifany"
  ) %>%
  modify_header(
    label = "Status"
  ) %>%
  bold_labels() %>% 
    modify_header(label ~ "") # Modify the table header to provide a descriptive label
```


In the following, I performed balance checks on the variable consent to the IPV module by type of treatment. Overall, non-response is balanced between treatment groups.

## Tekavoul program


```{r}
# Create vectors of variable names and their corresponding labels
var_vec = unique(dataconsent$status_noconsent)


# Create corresponding human-readable labels for each variable
label_vec = unique(dataconsent$status_noconsent)

label_var = c("Balance for no consent to the IPV module")

var_lab = c("Balance")

# Convert all variables in var_vec to numeric type
dataconsent <- dataconsent  %>% 
  dplyr::mutate(across(var_vec, as.numeric))

# Create a tibble mapping variable names to their labels
description = tibble(
  name = var_vec,
  label = label_vec
)

# Create a named list of variable labels
var_labels <- setNames(as.list(description$label), description$name)

# Apply the variable labels to the dataset
dataconsent <- dataconsent %>%
  set_variable_labels(.labels = var_labels, .strict = FALSE)



# Filter to get the cash recipient in the followup_MRT_hh that receive the Tekavoul
# and is in the age transfert
ipv_df_all_csh_trnsfr <- dataconsent %>%
  filter(reg_hh_csh_mrt == 1)


# Create summary statistics table grouped by treatment
balance_tab_1 = ipv_df_all_csh_trnsfr %>% 
  dplyr::select(treatment_csh_trnsfr,var_vec) %>%  
  tbl_summary(by = treatment_csh_trnsfr,
              type = (list=var_vec ~ "continuous"),
              statistic = list(all_continuous() ~ "{mean}({sd})"),
              digits = everything() ~ c(2,2), 
              missing = "no") %>% 
  modify_header(label = 'Variable')

# Create vector of treatment binary comparison variables
lst_treatment_bin="treatment_csh_trnsfr"

# Calculate p-values for each treatment comparison and variable
balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) {
  df_coef_value <- data.frame(variable = character(), 
                       treatment = character(), 
                       coef_val = character(), 
                       stringsAsFactors = FALSE)
  
  # Loop through each variable and run logistic regression
  for (v_name in var_vec) {
    # Fit logistic regression with clustered standard errors
    reg <- glm(as.formula(paste0(treat_var, " ~ ", "`", v_name,"`" ," + strata")), 
               family = binomial, 
               data = ipv_df_all_csh_trnsfr)
    
    # Calculate p-value and add significance stars
    coef_val <- round(coeftest(reg, vcovCL(reg, cluster = ipv_df_all_csh_trnsfr$cluster))[2, 1], 3)
    pval <- round(coeftest(reg, vcovCL(reg, cluster = ipv_df_all_csh_trnsfr$cluster))[2, 4], 3)
    
    # Add significance stars based on p-value thresholds
    if (pval < 0.01) {
      coef_val <- paste0(as.character(coef_val), "***")
    } else if (pval < 0.05) {
      coef_val <- paste0(as.character(coef_val), "**")
    } else if (pval < 0.1) {
      coef_val <- paste0(as.character(coef_val), "*")
    }else {
       coef_val <- as.character(coef_val)
    }
    
    df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name, 
                                        treatment = treat_var, 
                                        coef_val = coef_val, 
                                        stringsAsFactors = FALSE))
  }
  
  return(df_coef_value)
})

# Reshape p-value table to wide format with treatment comparisons as columns
balance_tab_2 <- balance_tab_2 %>% 
  pivot_wider(id_cols = "variable", 
              names_from = "treatment", 
              values_from = "coef_val") 

# Rename columns to show treatment group comparisons
names(balance_tab_2) <- c("variable","(1)-(2)")

#Keep the variables of interest
balance_tab_2 <- balance_tab_2 %>% 
  select("(1)-(2)")

# Create table for joint F-tests
  

myfooter <- ipv_df_all_csh_trnsfr %>% 
  dplyr::select(treatment_csh_trnsfr,cluster, strata) %>%  
  group_by(treatment_csh_trnsfr) %>% 
  summarise(nbr._cluster = n_distinct(cluster),
            nbr._strata = n_distinct(strata)) %>% 
  column_to_rownames(var="treatment_csh_trnsfr")

#transpose data frame
myfooter_t <- transpose(myfooter)

#redefine row and column names
rownames(myfooter_t) <- colnames(myfooter)
colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[c(6,7)]

myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>%
  mutate(Variable=dplyr::recode(Variable, nbr._cluster = "N cluster", nbr._strata = "N strata"))


balance_tab = cbind(
  balance_tab_1,
  balance_tab_2)

# Adding the row on the nbr. of cluster and strata
balance_tab <- plyr::rbind.fill(balance_tab,myfooter_t)

header <- str_squish(str_remove("Table : Balance Table ", "\n"))
# Set Table footer
footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level. Fixed effects using randomization strata are included in all estimation regressions. *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n"))
# Set custom_tab() defaults
customtab_defaults()
custom_tab(balance_tab, header, footer)
```


## Productive inclusion program


```{r}

ipv_df_all_pi <- dataconsent %>%
  filter(reg_hh_pi_mrt == 1)

# Create summary statistics table grouped by treatment
balance_tab_1 = ipv_df_all_pi %>% 
  dplyr::select(treatment_pi,var_vec) %>%  
  tbl_summary(by = treatment_pi,
              type = (list=var_vec ~ "continuous"),
              statistic = list(all_continuous() ~ "{mean}({sd})"),
              digits = everything() ~ c(2,2), 
              missing = "no") %>% 
  modify_header(label = 'Variable')

# Create vector of treatment binary comparison variables
lst_treatment_bin=paste("treatment_pi_", seq(1,6,1), sep="")

# Adding the variable for the pooled T-test
lst_treatment_bin <- append(lst_treatment_bin, "treat_dum_pi")

# Calculate p-values for each treatment comparison and variable
balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) {
  df_coef_value <- data.frame(variable = character(), 
                       treatment = character(), 
                       coef_val = character(), 
                       stringsAsFactors = FALSE)
  #browser()
  # Loop through each variable and run logistic regression
  for (v_name in var_vec) {
    # Fit logistic regression with clustered standard errors
      reg <- glm(as.formula(paste0(treat_var, " ~ ", "`", v_name,"`" ," + strata")), 
               family = binomial, 
               data = ipv_df_all_pi)
    
    # Calculate p-value and add significance stars
    coef_val <- round(coeftest(reg, vcovCL(reg, cluster = ipv_df_all_pi$cluster))[2, 1], 3)
    pval <- round(coeftest(reg, vcovCL(reg, cluster = ipv_df_all_pi$cluster))[2, 4], 3)
    # Add significance stars based on p-value thresholds
    if (pval < 0.01) {
      coef_val <- paste0(as.character(coef_val), "***")
    } else if (pval < 0.05) {
      coef_val <- paste0(as.character(coef_val), "**")
    } else if (pval < 0.1) {
      coef_val <- paste0(as.character(coef_val), "*")
    }else {
       coef_val <- as.character(coef_val)
    }
    
    df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name, 
                                        treatment = treat_var, 
                                        coef_val = coef_val, 
                                        stringsAsFactors = FALSE))
  }
  
  return(df_coef_value)
})

# Reshape p-value table to wide format with treatment comparisons as columns
balance_tab_2 <- balance_tab_2 %>% 
  pivot_wider(id_cols = "variable", 
              names_from = "treatment", 
              values_from = "coef_val") 

# Rename columns to show treatment group comparisons
names(balance_tab_2) <- c("variable","(1)-(2)","(1)-(3)","(1)-(4)",
                     "(2)-(3)","(2)-(4)","(3)-(4)", "Pooled F-test \n P-value")

#Keep the variables of interest
balance_tab_2 <- balance_tab_2 %>% 
  select("(1)-(2)","(1)-(3)","(1)-(4)",
         "(2)-(3)","(2)-(4)","(3)-(4)",
         "Pooled F-test \n P-value")

# Create table for joint F-tests
  
# For each variable, run joint F-test of treatment effects

balance_tab_3 <- purrr::map_dfr(var_vec, function(v_name) { 
  
    # Fit regression model
    model <- lm(as.formula(paste0( "`", v_name,"`" , " ~ treatment_pi + strata")), 
                 #family = binomial,
                 data = ipv_df_all_pi)

    # Create hypotheses for joint test of treatment effects
    trtmnt_qult_hpthss <- c(
      paste0("treatment_pi",levels(ipv_df_all_pi$treatment_pi)[-1][1],
             "=","treatment_pi",levels(ipv_df_all_pi$treatment_pi)[-1][2]),
      paste0("treatment_pi",levels(ipv_df_all_pi$treatment_pi)[-1][1],
             "=","treatment_pi",levels(ipv_df_all_pi$treatment_pi)[-1][3]))

    # Perform joint F-test with clustered standard errors
    joint_f_test <- linearHypothesis(model, 
                                    trtmnt_qult_hpthss,
                                    test = "F", 
                                    vcov. = vcovCL(model, ipv_df_all_pi$cluster))

    # Get and format p-value with significance stars
    coef_val_ftest <- round(joint_f_test$`F`[2],3)
    pval <- round(joint_f_test$`Pr(>F)`[2],3)
    if (pval < 0.01) {
      coef_val_ftest <- paste0(as.character(coef_val_ftest), "***")
    } else if (pval < 0.05) {
      coef_val_ftest <- paste0(as.character(coef_val_ftest), "**")
    } else if (pval < 0.1) {
      coef_val_ftest <- paste0(as.character(coef_val_ftest), "*")
    }else {
       coef_val_ftest <- as.character(coef_val_ftest)
    }

    # Add results to balance table
    temp_balance <- tibble(
  "Joint F-test \n P-value" = coef_val_ftest)
    

})
  



myfooter <- ipv_df_all_pi %>% 
  dplyr::select(treatment_pi,cluster, strata) %>%  
  group_by(treatment_pi) %>% 
  summarise(nbr._cluster = n_distinct(cluster),
            nbr._strata = n_distinct(strata)) %>% 
  column_to_rownames(var="treatment_pi")

#transpose data frame
myfooter_t <- transpose(myfooter)

#redefine row and column names
rownames(myfooter_t) <- colnames(myfooter)
colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[seq(6,9,1)]

myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>%
  mutate(Variable=dplyr::recode(Variable, nbr._cluster = "N cluster", nbr._strata = "N strata"))


balance_tab = cbind(
  balance_tab_1,
  balance_tab_2,
  balance_tab_3) %>% 
  relocate("Pooled F-test \n P-value", .after = "Joint F-test \n P-value")

# Adding the row on the nbr. of cluster and strata
balance_tab <- plyr::rbind.fill(balance_tab,myfooter_t)

header <- str_squish(str_remove("Table : Balance Table ", "\n"))
# Set Table footer
footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level. Fixed effects using randomization strata are included in all estimation regressions. The joint F-test shows the p-value from a test of equality of treatment arms. While the pooled F-test shows the p-value from a test of pooled treatment (i.e., a regression with a dummy for any treatment arm). *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n"))
# Set custom_tab() defaults
customtab_defaults()
custom_tab(balance_tab, header, footer)


```

\newpage

# Descriptive Statistics

## IPV variables

The following tables primarily consider women who provided consent for the IPV module.  
The observed differences between this balance table and the attrition table in the following sections arise from the fact that some women did not provide consent for participation.

**Index construction**: See: https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0282339

- A binary variable coded as 1 is created if a female beneficiary of the program responded affirmatively to any of the items related to IPV.
- Additionally, a continuous variable is constructed as the standardized average of the responses to each of these items that report the frequency of instances of each type of violence experienced in the past 12 months. This variable is measured on a 4-point Likert frequency scale (0 = Never, 1 = Once, 2 = Sometimes, 3 = Often). It is coded as "missing" only if all the items are missing. The range of the continuous variable is 0–3.

For all types of violence (except *controlling behavior*), the survey typically asks three sequential questions:

- Whether it has ever happened;  
- Whether it happened in the past 12 months;  
- For incidents in the past 12 months, the frequency (once, occasionally, or often)  

\newpage

### Partner's controlling behavior

- Overall rates range between 51 percent and 56 percent across program groups.
- The control group rates are around 51 percent in the Productive Inclusion program, which is slightly lower than the intervention groups' average for the same program (between 52 and 56 percent). 
- In the Tekavoul program, the control group presents around 3 percentage points more controlling behavior than the intervention group.
- This type of IPV contains question on:
  * ipv1: Being jealous or angry if the wife speaks to other men,
  * ipv2: Accusing the wife of being unfaithful,
  * ipv3: Trying to prevent the wife from seeing family or friends,
  * ipv5: Insisting on knowing the wife's whereabouts at all times,
  * ipv6: Expecting the wife to ask permission before seeking healthcare,
  * ipv7: Preventing the wife from working outside the home.
  

```{r}
var_label(followup_MRT_hh_pi$control_ipv_sev_12m) <- "Partner's controlling behavior Index (last 12 months)"

# For the productive inclusion program
tbl_pi <- followup_MRT_hh_pi %>% 
  select(treatment_pi, all_of(control_ipv_vars_fac), all_of(control_ipv_vars_num)) %>% 
  mutate(across(all_of(control_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_pi = unlabelled(treatment_pi)) %>% 
  tbl_summary(by = treatment_pi,
           label = list(control_ipv_sev_12m ~ "Binary for control IPV In the last 12 months",
                        control_ipv_sev_index ~ "Control IPV index" 
                        ), # Label for the Controling behavior variable.
           type = list(all_of(control_ipv_vars_fac) ~ "continuous", all_of(control_ipv_vars_num) ~ "continuous"), # Specify the variable as dichotomous.
             value = list(all_of(control_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Partner's controlling behavior") %>% # Modify the table header to provide a descriptive label
    add_overall() 

tbl_pi_pool <- followup_MRT_hh_pi %>% 
  select(treatment_pi_pool, all_of(control_ipv_vars_fac), all_of(control_ipv_vars_num)) %>% 
  mutate(across(all_of(control_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_pi_pool = unlabelled(treatment_pi_pool)) %>% 
  tbl_summary(by = treatment_pi_pool,
           label = list(control_ipv_sev_12m ~ "Binary for control IPV In the last 12 months",
                        control_ipv_sev_index ~ "Control IPV index" 
                        ), # Label for the Controling behavior variable.
           type = list(all_of(control_ipv_vars_fac) ~ "continuous", all_of(control_ipv_vars_num) ~ "continuous"), # Specify the variable as dichotomous.
             value = list(all_of(control_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Partner's controlling behavior") %>% # Modify the table header to provide a descriptive label
    add_overall() 

# For the Tekavoul program
tbl_csh_trnsfr <- followup_MRT_hh_csh_trnsfr %>% 
  select(treatment_csh_trnsfr, all_of(control_ipv_vars_fac), all_of(control_ipv_vars_num)) %>% 
  mutate(across(all_of(control_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_csh_trnsfr = unlabelled(treatment_csh_trnsfr)) %>% 
  tbl_summary(by = treatment_csh_trnsfr,
           label = list(control_ipv_sev_12m ~ "Binary for control IPV In the last 12 months",
                        control_ipv_sev_index ~ "Control IPV index" 
                        ), # Label for the Controling behavior variable.
           type = list(all_of(control_ipv_vars_fac) ~ "continuous", all_of(control_ipv_vars_num) ~ "continuous"), # Specify the variable as dichotomous.
             value = list(all_of(control_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Partner's controlling behavior") %>% # Modify the table header to provide a descriptive label
    add_overall() 


## Creating the final table
tbl <- tbl_merge(
  tbls = list(
              tbl_csh_trnsfr, # Tekavoul
              tbl_pi, # Productive inclusion
              tbl_pi_pool), # Pool inclusion

  tab_spanner = c("Tekavoul", "Productive inclusion", "Productive inclusion (Pool)")
) %>%
  modify_footnote(everything() ~ NA) 
# Adding the row on the nbr. of cluster and strata


tbl
```

\newpage

### Emotional Violence


- Emotional IPV rates are considerably lower than controlling behaviors, ranging between 7 percent and 10 percent across groups.
- The Capital package presents slightly higher rates at 10.27 percent compared to the other interventions.
- Control groups show lower rates (around 7 percent) than intervention groups (8-10 percent).
- This type of IPV contains question on:
  * ipv8: Humiliating the wife in front of others,
  * ipv9: Threatening to hurt the wife or someone close to her,
  * ipv10: Insulting or belittling the wife,
  * ipv11: Deliberately scaring or intimidating the wife (through looks, shouting, breaking things).


```{r}

# For the productive inclusion program
tbl_pi <- followup_MRT_hh_pi %>% 
  select(treatment_pi, all_of(c(emotional_ipv_vars_fac, emotional_ipv_vars_num))) %>% 
  mutate(across(all_of(emotional_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_pi = unlabelled(treatment_pi)) %>% 
  tbl_summary(by = treatment_pi,
           label = list(
                        emo_ipv_sev_12m ~ "Binary for emo. IPV in the last 12 months",
                        emo_ipv_sev_index ~ "Emo. IPV severity index"), # Label for the Controling behavior variable.
           type = list(all_of(emotional_ipv_vars_fac) ~ "continuous", all_of(emotional_ipv_vars_num)~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(emotional_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Emotional Violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 

tbl_pi_pool <- followup_MRT_hh_pi %>% 
  select(treatment_pi_pool, all_of(c(emotional_ipv_vars_fac, emotional_ipv_vars_num))) %>% 
  mutate(across(all_of(emotional_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_pi_pool = unlabelled(treatment_pi_pool)) %>% 
  tbl_summary(by = treatment_pi_pool,
           label = list(
                        emo_ipv_sev_12m ~ "Binary for emo. IPV in the last 12 months",
                        emo_ipv_sev_index ~ "Emo. IPV severity index"), # Label for the Controling behavior variable.
           type = list(all_of(emotional_ipv_vars_fac) ~ "continuous", all_of(emotional_ipv_vars_num)~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(emotional_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Emotional Violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 

# For the Tekavoul program
tbl_csh_trnsfr <- followup_MRT_hh_csh_trnsfr %>% 
  select(treatment_csh_trnsfr, all_of(c(emotional_ipv_vars_fac, emotional_ipv_vars_num))) %>% 
  mutate(across(all_of(emotional_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_csh_trnsfr = unlabelled(treatment_csh_trnsfr)) %>% 
  tbl_summary(by = treatment_csh_trnsfr,
            label = list(
                        emo_ipv_sev_12m ~ "Binary for emo. IPV in the last 12 months",
                        emo_ipv_sev_index ~ "Emo. IPV severity index"), # Label for the Controling behavior variable.
           type = list(all_of(emotional_ipv_vars_fac) ~ "continuous", all_of(emotional_ipv_vars_num)~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(emotional_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Emotional Violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 


## Creating the final table
tbl <- tbl_merge(
  tbls = list(
              tbl_csh_trnsfr, # Tekavoul
              tbl_pi, # Productive inclusion
              tbl_pi_pool), # Pool inclusion

  tab_spanner = c("Tekavoul", "Productive inclusion", "Productive inclusion (Pool)")
)  %>%
  modify_footnote(everything() ~ NA) 

tbl
```

\newpage

### Physical Violence


- The overall prevalence of physical violence ranges from about 0.99 percent in the Tekavoul program to 1.55 percent in the Productive Inclusion program.
- There appears to be slight variation between control groups (0.89 percent in Tekavoul control, 1.09 percent in productive inclusion control) and the beneficiaries of the two programs (1.05 percent in the beneficiaries of the cash assignment in the Tekavoul program, 1.80 percent for the beneficiary of the productive inclusion).
- Within the productive inclusion program, the psychosocial and the full intervention groups show the highest rates (around 2 percent).
- The physical IPV  and severity indices are very low across all groups, with minimal variation.
- This type of IPV contains questions on :
  * ipv12: slapping or throwing objects that could cause injury,
  * ipv13: Pushing, shoving, or pulling hair,
  * ipv14: Punching or hitting with objects that could cause injury,
  * ipv15: Kicking, dragging, or beating,
  * ipv16: Attempting to strangle or burn intentionally (not accidentally),
  * ipv17: Threatening or attacking with weapons (knife, gun, etc.).

```{r}

# For the productive inclusion program
tbl_pi <- followup_MRT_hh_pi %>% 
  select(treatment_pi, all_of(c(physical_ipv_vars_fac, physical_ipv_vars_num))) %>% 
  mutate(across(all_of(physical_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_pi = unlabelled(treatment_pi)) %>% 
  tbl_summary(by = treatment_pi,
           label = list(
                        phy_ipv_sev_index ~ "Phy. IPV severity index",
                        phy_ipv_sev_12m ~ "Binary for phy. IPV in the last 12 months"), 
           type = list(all_of(physical_ipv_vars_fac) ~ "continuous", all_of(physical_ipv_vars_num) ~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(physical_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Physical Violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 

tbl_pi_pool <- followup_MRT_hh_pi %>% 
  select(treatment_pi_pool, all_of(c(physical_ipv_vars_fac, physical_ipv_vars_num))) %>% 
  mutate(across(all_of(physical_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_pi_pool = unlabelled(treatment_pi_pool)) %>% 
  tbl_summary(by = treatment_pi_pool,
           label = list(
                        phy_ipv_sev_index ~ "Phy. IPV severity index",
                        phy_ipv_sev_12m ~ "Binary for phy. IPV in the last 12 months"),  
           type = list(all_of(physical_ipv_vars_fac) ~ "continuous", physical_ipv_vars_num ~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(physical_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Physical Violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 

# For the Tekavoul program
tbl_csh_trnsfr <- followup_MRT_hh_csh_trnsfr %>% 
  select(treatment_csh_trnsfr, all_of(c(physical_ipv_vars_fac, physical_ipv_vars_num))) %>%  
  mutate(across(all_of(physical_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_csh_trnsfr = unlabelled(treatment_csh_trnsfr)) %>% 
  tbl_summary(by = treatment_csh_trnsfr,
           label = list(
                        phy_ipv_sev_index ~ "Phy. IPV severity index",
                        phy_ipv_sev_12m ~ "Binary for phy. IPV in the last 12 months"),  
           type = list(all_of(physical_ipv_vars_fac) ~ "continuous", physical_ipv_vars_num ~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(physical_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Physical Violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 


## Creating the final table
tbl <- tbl_merge(
  tbls = list(
              tbl_csh_trnsfr, # Tekavoul
              tbl_pi, # Productive inclusion
              tbl_pi_pool), # Pool inclusion

  tab_spanner = c("Tekavoul", "Productive inclusion", "Productive inclusion (Pool)")
) %>%
  modify_footnote(everything() ~ NA) 

tbl
```
\newpage

### Sexual Violence

- Sexual IPV prevalence ranges from 4.46 percent in Tekavoul to 7.47 percent in Productive Inclusion. There's a more noticeable difference between control and intervention groups.
- The Psychosocial package recipient group shows the highest rate at 11.02 percent.
- The control groups consistently show lower rates than intervention groups.
- The severity indices for sexual violence are overall higher than those for physical violence.
- This type of IPV contains questions on:
  * ipv18: physically forcing sexual intercourse against the wife's will
  * ipv19: having unwanted sexual intercourse due to fear of consequences
  * ipv20: forcing degrading or humiliating sexual acts


```{r}


# For the productive inclusion program
tbl_pi <- followup_MRT_hh_pi %>% 
  select(treatment_pi, all_of(c(sexual_ipv_vars_fac, sexual_ipv_vars_num))) %>% 
  mutate(across(all_of(sexual_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_pi = unlabelled(treatment_pi)) %>% 
  tbl_summary(by = treatment_pi,
           label = list(
                        sex_ipv_sev_index ~ "Sex. IPV severity index",
                        sex_ipv_sev_12m ~ "Binary for sex. IPV in the last 12 months"), # Label for the Controling behavior variable.
           type = list(all_of(sexual_ipv_vars_fac) ~ "continuous", all_of(sexual_ipv_vars_num) ~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(sexual_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Sexual violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 

tbl_pi_pool <- followup_MRT_hh_pi %>% 
  select(treatment_pi_pool, all_of(c(sexual_ipv_vars_fac,sexual_ipv_vars_num))) %>% 
  mutate(across(all_of(sexual_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_pi_pool = unlabelled(treatment_pi_pool)) %>% 
  tbl_summary(by = treatment_pi_pool,
           label = list(
                        sex_ipv_sev_index ~ "Sex. IPV severity index",
                        sex_ipv_sev_12m ~ "Binary for sex. IPV in the last 12 months"), # Label for the Controling behavior variable.
           type = list(all_of(sexual_ipv_vars_fac) ~ "continuous", all_of(sexual_ipv_vars_num) ~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(sexual_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Sexual violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 

# For the Tekavoul program
tbl_csh_trnsfr <- followup_MRT_hh_csh_trnsfr %>% 
  select(treatment_csh_trnsfr, all_of(c(sexual_ipv_vars_fac, sexual_ipv_vars_num))) %>% 
  mutate(across(all_of(sexual_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_csh_trnsfr = unlabelled(treatment_csh_trnsfr)) %>% 
  tbl_summary(by = treatment_csh_trnsfr,
           label = list(
                        sex_ipv_sev_index ~ "Sex. IPV severity index",
                        sex_ipv_sev_12m ~ "Binary for sex. IPV in the last 12 months"), # Label for the Controling behavior variable.
  type = list(all_of(sexual_ipv_vars_fac) ~ "continuous", all_of(sexual_ipv_vars_num) ~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(sexual_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Sexual violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 


## Creating the final table
tbl <- tbl_merge(
  tbls = list(
              tbl_csh_trnsfr, # Tekavoul
              tbl_pi, # Productive inclusion
              tbl_pi_pool), # Pool inclusion

  tab_spanner = c("Tekavoul", "Productive inclusion", "Productive inclusion (Pool)")
)  %>%
  modify_footnote(everything() ~ NA) 

tbl
```
\newpage

### Sexual and Physical

```{r}


# For the productive inclusion program
tbl_pi <- followup_MRT_hh_pi %>% 
  select(treatment_pi, all_of(c(sexual_phy_ipv_vars_fac, sexual_phy_ipv_vars_num))) %>% 
  mutate(across(all_of(sexual_phy_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_pi = unlabelled(treatment_pi)) %>% 
  tbl_summary(by = treatment_pi,
           label = list(
                        sex_phy_ipv_sev_index ~ "Phy. and sex. IPV severity index",
                        sex_phy_ipv_sev_12m ~ "Binary for sex. or phy. IPV in the last 12 months"), # Label
           type = list(all_of(sexual_phy_ipv_vars_fac) ~ "continuous", all_of(sexual_phy_ipv_vars_num) ~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(sexual_phy_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Sexual or Physical violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 

tbl_pi_pool <- followup_MRT_hh_pi %>% 
  select(treatment_pi_pool, all_of(c(sexual_phy_ipv_vars_fac, sexual_phy_ipv_vars_num))) %>% 
  mutate(across(all_of(sexual_phy_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_pi_pool = unlabelled(treatment_pi_pool)) %>% 
  tbl_summary(by = treatment_pi_pool,
           label = list(
                        sex_phy_ipv_sev_index ~ "Phy. and sex. IPV severity index",
                        sex_phy_ipv_sev_12m ~ "Binary for sex. or phy. IPV in the last 12 months"), # Label
            type = list(all_of(sexual_phy_ipv_vars_fac) ~ "continuous", all_of(sexual_phy_ipv_vars_num) ~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(sexual_phy_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Sexual or Physical violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 

# For the Tekavoul program
tbl_csh_trnsfr <- followup_MRT_hh_csh_trnsfr %>% 
  select(treatment_csh_trnsfr, all_of(c(sexual_phy_ipv_vars_fac, sexual_phy_ipv_vars_num))) %>% 
  mutate(across(all_of(sexual_phy_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_csh_trnsfr = unlabelled(treatment_csh_trnsfr)) %>% 
  tbl_summary(by = treatment_csh_trnsfr,
           label = list(
                        sex_phy_ipv_sev_index ~ "Phy. and sex. IPV severity index",
                        sex_phy_ipv_sev_12m ~ "Binary for sex. or phy. IPV in the last 12 months"), # Label
            type = list(all_of(sexual_phy_ipv_vars_fac) ~ "continuous", all_of(sexual_phy_ipv_vars_num) ~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(sexual_phy_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Sexual or Physical violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 


## Creating the final table
tbl <- tbl_merge(
  tbls = list(
              tbl_csh_trnsfr, # Tekavoul
              tbl_pi, # Productive inclusion
              tbl_pi_pool), # Pool inclusion

  tab_spanner = c("Tekavoul", "Productive inclusion", "Productive inclusion (Pool)")
)  %>%
  modify_footnote(everything() ~ NA) 

tbl
```

\newpage
### Economic Violence

- Economic IPV rates fall between those of physical and sexual violence, with overall prevalence of 4.45 percent in Tekavoul and 6.73 percent in the Productive Inclusion program. 
- Similar to the previous tables, intervention groups generally show higher reported rates compared to control groups:
  * In Tekavoul: control shows 3.17 percent while Cash Assignment shows 5.18 percent,
  * In productive inclusion: control shows 5.38 percent while intervention arms range from 5.37 percent to 8.76 percent.
- The Capital and Full intervention groups show the highest rates of economic IPV (8.76 percent and 8.72 percent respectively).
- Interestingly, the Psychosocial group, which had the highest sexual IPV rate, shows the lowest economic IPV rate among intervention groups (5.37 percent) with values similar to the recipients of the Tekavoul program (5.18 percent).
- This type of IPV contains questions on :
  * ipv22: taking money earned by the wife against her will,
  * ipv23: refusing to provide money for household necessities despite having funds available,
  * ipv24: forcing the wife to give all or part of her earnings to his family (in-laws).


```{r}


# For the productive inclusion program
tbl_pi <- followup_MRT_hh_pi %>% 
  select(treatment_pi, all_of(c(economic_ipv_vars_fac, economic_ipv_vars_num))) %>% 
  mutate(across(all_of(economic_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_pi = unlabelled(treatment_pi)) %>% 
  tbl_summary(by = treatment_pi,
           label = list(
                        eco_ipv_sev_index ~ "Eco. IPV severity index z-score",
                        eco_ipv_sev_12m ~ "Binary for eco. IPV in the last 12 months"), # Label for the eco violence variable.
           type = list(all_of(economic_ipv_vars_fac) ~ "continuous", all_of(economic_ipv_vars_num) ~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(economic_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Economic violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 

tbl_pi_pool <- followup_MRT_hh_pi %>% 
  select(treatment_pi_pool, all_of(c(economic_ipv_vars_fac, economic_ipv_vars_num))) %>% 
  mutate(across(all_of(economic_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_pi_pool = unlabelled(treatment_pi_pool)) %>% 
  tbl_summary(by = treatment_pi_pool,
           label = list(
                        eco_ipv_sev_index ~ "Eco. IPV severity index z-score",
                        eco_ipv_sev_12m ~ "Binary for eco. IPV in the last 12 months"), # Label for the eco violence variable.
           type = list(all_of(economic_ipv_vars_fac) ~ "continuous", all_of(economic_ipv_vars_num) ~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(economic_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Economic violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 

# For the Tekavoul program
tbl_csh_trnsfr <- followup_MRT_hh_csh_trnsfr %>% 
  select(treatment_csh_trnsfr, all_of(c(economic_ipv_vars_fac, economic_ipv_vars_num))) %>% 
  mutate(across(all_of(economic_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_csh_trnsfr = unlabelled(treatment_csh_trnsfr)) %>% 
  tbl_summary(by = treatment_csh_trnsfr,
           label = list(
                        eco_ipv_sev_index ~ "Eco. IPV severity index z-score",
                        eco_ipv_sev_12m ~ "Binary for eco. IPV in the last 12 months"), # Label for the eco violence variable.
           type = list(all_of(economic_ipv_vars_fac) ~ "continuous", all_of(economic_ipv_vars_num) ~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(economic_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Economic violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 


## Creating the final table
tbl <- tbl_merge(
  tbls = list(
              tbl_csh_trnsfr, # Tekavoul
              tbl_pi, # Productive inclusion
              tbl_pi_pool), # Pool inclusion

  tab_spanner = c("Tekavoul", "Productive inclusion", "Productive inclusion (Pool)")
)  %>%
  modify_footnote(everything() ~ NA) 

tbl
```


\newpage 

### Any IPV Violence

In this table we consider the emotional violence, the physical, sexual and economic violence.
  

```{r}


# For the productive inclusion program
tbl_pi <- followup_MRT_hh_pi %>% 
  select(treatment_pi, all_of(other_ipv_vars_fac), all_of(other_ipv_vars_num)) %>% 
  mutate(across(all_of(other_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_pi = unlabelled(treatment_pi)) %>% 
  tbl_summary(by = treatment_pi,
           label = list(
                        all_ipv_sev_12m ~ "Binary for at least one type of IPV (excl. eco. and control)in the last 12 months", 
                        all_ipv_sev_index ~ "Any IPV index z-score"), # Label for all type of violence.
           type = list(all_of(other_ipv_vars_fac) ~ "continuous", all_of(other_ipv_vars_num)~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(other_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Any IPV index violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 

tbl_pi_pool <- followup_MRT_hh_pi %>% 
  select(treatment_pi_pool, all_of(other_ipv_vars_fac), all_of(other_ipv_vars_num)) %>% 
  mutate(across(all_of(other_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_pi_pool = unlabelled(treatment_pi_pool)) %>% 
  tbl_summary(by = treatment_pi_pool,
           label = list(
                        all_ipv_sev_12m ~ "Binary for at least one type of IPV (excl. eco. and control)in the last 12 months", 
                        all_ipv_sev_index ~ "Any IPV index z-score"), # Label for all type of violence.
                    type = list(all_of(other_ipv_vars_fac) ~ "continuous", all_of(other_ipv_vars_num)~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(other_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Any IPV index violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 

# For the Tekavoul program
tbl_csh_trnsfr <- followup_MRT_hh_csh_trnsfr %>% 
  select(treatment_csh_trnsfr, all_of(other_ipv_vars_fac), all_of(other_ipv_vars_num)) %>% 
  mutate(across(all_of(other_ipv_vars_fac), ~as.numeric(.))) %>% 
  mutate(treatment_csh_trnsfr = unlabelled(treatment_csh_trnsfr)) %>% 
  tbl_summary(by = treatment_csh_trnsfr,
           label = list(
                        all_ipv_sev_12m ~ "Binary for at least one type of IPV (excl. eco.)in the last 12 months", 
                        all_ipv_sev_index ~ "All IPV  index z-score"), # Label for all type of violence.
           type = list(all_of(other_ipv_vars_fac) ~ "continuous", all_of(other_ipv_vars_num)~ "continuous"), # Specify the variable as continuous.
             value = list(all_of(other_ipv_vars_fac) ~ "1"),  # Explicitly set the reference category
           statistic = list(
                     all_categorical() ~ "{p}",
                     all_continuous() ~ "{mean} ({sd})"
                     ),
            missing_text = "(Missing)",
            digits = list(everything() ~c(2,2)),
            missing = "ifany" # Include missing values in the table.
          ) %>% 
    modify_header(label ~ "Any IPV index violence") %>% # Modify the table header to provide a descriptive label
    add_overall() 


## Creating the final table
tbl <- tbl_merge(
  tbls = list(
              tbl_csh_trnsfr, # Tekavoul
              tbl_pi, # Productive inclusion
              tbl_pi_pool), # Pool inclusion

  tab_spanner = c("Tekavoul", "Productive inclusion", "Productive inclusion (Pool)")
)  %>%
  modify_footnote(everything() ~ NA) 

tbl
```

\newpage

### Cross tables

```{r}
# Create vectors of variable names and their corresponding labels
# var_vec = c(
#             "treatment_csh_trnsfr_bin", 
#             "treatment_capital_bin",
#             "treatment_psychosocial_bin", 
#             "treatment_full_bin",
#             "same_cb_bl",
#             "het_married_ben",
#             "pben_relation_bl_Head of household",
#             "pben_relation_bl_Spouse",
#             "pben_relation_bl_Co-wife",
#             "pben_relation_bl_Son, Daughter",
#             "pben_relation_bl_Son, Daughter of co-wife",
#             "pben_relation_bl_Father, Mother",
#             "pben_relation_bl_Little child",
#             "pben_relation_bl_Grandparents",
#             "pben_relation_bl_Sibling",
#             "pben_relation_bl_Cousin",
#             "pben_relation_bl_Nephew/Niece",
#             "pben_relation_bl_Spouse of son/daughter (or in-laws')",
#             "pben_relation_bl_Spouse of brother/sister (or in-law)",
#             "pben_relation_bl_Parent in law",
#             "pben_relation_bl_Other Parents of chef/spouse",
#             "pben_relation_bl_Unrelated",
#             "pben_relation_bl_Servant/their relative",
#             "pben_relation_bl_1st wife",
#             "pben_relation_bl_2nd wife",
#             "pben_relation_bl_3rd wife",
#             "pben_relation_bl_4th wife",
#             "pben_relation_bl_Aunt/uncle",
#             "pben_relation_bl_Spouse's brother/sister",
#             "pben_relation_bl_Other to be specified",
#             "pben_relation_bl_to update!",
#             "pben_handicap_bl",
#             "hhh_fem_bl",
#             "pben_fem_bl",
#             "hhh_poly_bl",
#             "pben_poly_bl",
#             "hhh_age_bl",
#             "pben_age_bl",
#             "age_gap",
#             "het_age_gap",
#             "age_at_mrrg",
#             "age_at_mrrg_above18",
#             "het_age_at_mrrg",
#             'nbr_adult_mal', 
#             "het_nbr_adult_mal", 
#             "shr_adult_mal", 
#             "het_shr_adult_mal", 
#             "nbr_adult_mal_tot",
#             "het_nbr_adult_mal_tot",
#             "nbr_adult_fem", 
#             "het_nbr_adult_fem", 
#             "shr_adult_fem", 
#             "het_shr_adult_fem", 
#             "nbr_adult_fem_tot",
#             "het_nbr_adult_fem_tot",            
#             "shr_adult_fem_mal",
#             "het_shr_adult_fem_mal",
#             "het_wtht_adult_mal",
#             "het_wtht_adult_mal_tot",
#             "nbr_adult", 
#             "het_nbr_adult", 
#             "shr_adult", 
#             "het_shr_adult", 
#             "nbr_adult_tot",
#             "het_nbr_adult_tot", 
#             "nbr_elder",
#             "het_nbr_elder",
#             "shr_elder",
#             "het_shr_elder",
#             "hh_has_kid", 
#             "nbr_kid", 
#             "het_nbr_kid", 
#             "nbr_hh_number",
#             "het_nbr_hh_number",
#             "hhh_edu_bl",
#             "pben_edu_bl",
#             "hhh_prim_bl",
#             "pben_prim_bl",
#             "hhh_lit_bl",
#             "pben_lit_bl",
#             "ctrl_earn_index_tr_bl", #B.10.5 Control Earnings Z-index at bl, 
#             "ctrl_hh_index_tr_bl", # B.10.6 Control HH Z-index at bl
#             "intrahh_vars_index_tr_bl", # C.2.3.A Intra-HH Dynamics Z-index at Baseline
#             "gse_index_tr_bl",
#             "soc_cohsn_index_tr_bl",
#             "soc_stand_index_bl", 
#             "los1_bl", 
#             "los2_bl", 
#             "rev_sum_bohh",     # Revenue/income sum for household
#             "region", # Region
#             "tot_hh_rev", # Baseline revenu
#             "consum",
#             "dec_pow_earn_d_bl", 
#             "dec_could_earn_d_bl",      # Power/capacity to earn
#             "dec_pow_ag_d_bl", 
#             "dec_pow_liv_d_bl", 
#             "dec_pow_bus_d_bl",  # Power in productive sectors
#             "dec_pow_spend_d_bl", 
#             "dec_could_spend_d_bl", 
#             "dec_pow_large_d_bl", 
#             "dec_could_large_d_bl",
#             "dec_pow_fert_d_bl", 
#             "dec_could_fert_d_bl", 
#             "dec_pow_edu_d_bl",
#             "tot_emp_2rev12_ben_98_ppp_bl", 		#"Wage\n earnings\n (yearly, USD)"
#           	"crop_ctrl_dum_bl", 	#"Benef. controls\n crop\n revenue \{0,1\}"
#             "na_bus2_op_wn_12_ben_bl", # No. of\n beneficiary\n businesses
#             "bus2_ben_dum_bl",	 	#"Beneficiary\n has a\n business \{0,1\}"
#             "tot_busmths_uniq_ben_bl", #No. of months benef worked last year
#             "div_n_na_12_ben_bl", # Entrepreneurial\n business types\n (yearly)
#             "bus2_within_12_dum_ben_bl",	#Beneficiary\n launched a\n business \{0,1\}				
#             "tot_ben_rev12_98_ppp_bl", # Business\n revenues\n (yearly, USD)    	
#           	"tot_ben_pro12_98_ppp_bl", # Business\n profits\n (yearly, USD)
#             "bus_assval_98_ppp_bl", # Business\n asset\n value (USD)
#             'tot_ben_rev30_98_ppp_bl',	#"Business revenue\n (beneficiary,\n monthly, USD)" 
#             "ani_ben_dum_bl", 		#"Benef. owns\n livestock\n \{0,1\}"
#             "sleep_prod_dum_bl"	#"Benef. traveled\n for work\n \{0,1\}"
# 
#             )
# 
# 
# # Create corresponding human-readable labels for each variable
# label_vec = c(
#               "Benef. of cash transfert only (0,1)", 
#               "Benef. of capital (0,1)",
#               "Benef. of psychosocial package (0,1)",
#               "Benef. of full package (0,1)",
#               "Benef. is HH head",
#               "Benef. is married (0,1)",
#               "- Head of household",
#               "- Spouse",
#               "- Co-wife",
#               "- Son or Daughter",
#               "- Son/Daughter of co-wife",
#               "- Father or Mother",
#               "- Little child",
#               "- Grandparents",
#               "- Sibling",
#               "- Cousin",
#               "- Nephew/Niece",
#               "- Spouse of child / In-laws",
#               "- Spouse of sibling / In-law",
#               "- Parent-in-law",
#               "- Other parents of head/spouse",
#               "- Unrelated",
#               "- Servant or their relative",
#               "- 1st wife",
#               "- 2nd wife",
#               "- 3rd wife",
#               "- 4th wife",
#               "- Aunt or Uncle",
#               "- Spouse's brother/sister",
#               "- Other to be specified",
#               "- To update",
#               "Benef. is handicapped",
#               "Female (hh. head)",
#               "Female (benef.)",
#               "Polygamy (hh. head)",
#               "Polygamy (benef.)",
#               "Age (Hh. head)",
#               "Age (benef.)",
#               "Age gap (hh. head - benef.)",
#               "Age gap (hh. head - benef.) above med. (0,1)",
#               "Ben. age at marriage",
#               "Ben. married after 18 (0,1)",
#               "Ben. married aged above med. (0,1)",              
#               'Nbr adults males (age 25-65)', 
#               "Nbr adults males (age 25-65) above med. (0,1)", 
#               "Shr adults males (age 25-65)", 
#               "Shr adults males (age 25-65) above med. (0,1)", 
#               'Nbr males (age 15+)', 
#               "Nbr males (age 15+) above med. (0,1)", 
#               'Nbr adults females (age 25-65)', 
#               "Nbr adults females (age 25-65) above med. (0,1)", 
#               "Shr adults females (age 25-65)", 
#               "Shr adults females (age 25-65) above med. (0,1)", 
#               'Nbr females (age 15+)', 
#               "Nbr females (age 15+) above med. (0,1)", 
#               "Shr females (age 15+) in adults",
#               "Shr females (age 15+) in adults above med. (0,1)",
#               "Shr of hh. without males (age 25-65)",
#               "Shr of hh. without males (age 15+)",
#               'Nbr adults tot (age 25-65)', 
#               "Nbr adults tot (age 25-65) above med. (0,1)", 
#               "Shr adults tot (age 25-65)", 
#               "Shr adults tot (age 25-65) above med. (0,1)", 
#               "Nbr members (age 15+) in hh.",
#               "Nbr members (age 15+) in hh. above med. (0,1)",
#               "Nbr of elders (age 66+)",
#               "Nbr of elders (age 66+) above med. (0,1)",
#               "Shr of elders (age 66+)",
#               "Shr of elders (age 66+) above med. (0,1)",
#               "Hh. has a kid (age 0-30 mnth)", 
#               'Nbr kid (age 0-30 mnth)', 
#               "Nbr kid (age 0-30 mnth) above med. (0,1)", 
#               "Nbr hh. members",
#               "Nbr hh. members above med. (0,1)",
#               "Education (years, HH head)",
#               "Education (years, benef.)",
#               "Primary education (0/1, H-hh. head)",
#               "Primary education (0/1, benef.)",
#               "Literate (hh. head)",
#               "Literate (benef.)",
#               "Control over earnings", #B.10.5 Control Earnings Z-index at bl, 
#               "Control over hh. resources", # B.10.6 Control HH Z-index at bl
#               "Intra hh. dynamics index", # C.2.3.A Intra-HH Dynamics Z-index at Baseline
#               "Self efficacy",
#               "Social cohesion and closeness to community",
#               "Social standing",
#               "Partner inclusiveness (1-4)", 
#               "Community inclusiveness (1-4)", 
#               "Ben. revenue tot.",     # Revenue/income sum for household
#               "Household in Sélibaby (0,1)", # Region
#               "Tot. hh. revenue", # Baseline revenu
#               "Consumption eq ppp",
#               "Own earnings influence (0,1)",
#               "Can Decide to Earn Alone (0,1)",
#               "Agriculture influence (0,1)",
#               "Livestock influence (0,1)",
#               "Off-farm business influence (0,1)",
#               "Daily spending influence (0,1)",
#               "Can Decide to Spend Alone (0,1)",
#               "Large purchases influence (0,1)",
#               "Can Decide to Spend Large Amounts Alone (0,1)",
#               "Family planning influence (0,1)",
#               "Can Make Fertility Choices Alone (0,1)",
#               "Child education influence (0,1)",
#               "Wage earnings (yearly, USD)",
#               "Benef. controls crop revenue (0,1)",
#               "No. of beneficiary businesses",
#               "Beneficiary has a business (0,1)",
#               "No. of months benef worked last year",
#               "Entrepreneurial business types (yearly)",
#               "Beneficiary launched a business (0,1)",
#               "Business revenues (yearly, USD)",
#               "Business profits (yearly, USD)",
#               "Business asset value hh. (USD)",
#               "Business revenue (beneficiary, monthly, USD)",
#               "Benef. owns livestock (0,1)",
#               "Benef. traveled for work (0,1)"
#             )
var_vec <- c(
  "pben_fem_bl",               # 1 = Female beneficiary
  "age_prtnr",                 # Age of partner / household head (in years)
  "pben_age_bl",               # Age of beneficiary (in years)
  "age_gap",                   # Age gap between partner and beneficiary (in years)
  "het_age_gap",               # 1 = Age gap above median
  
  "age_at_mrrg",               # Age at marriage (in years)
  "age_at_mrrg_above18",       # 1 = Married after age 18
  "het_age_at_mrrg",           # 1 = Married after median age at marriage
  
  "prtnr_edu",                 # Partner education (in completed years)
  "het_prtnr_edu",             # 1 = Partner education above median
  "pben_edu_bl",               # Beneficiary education (in completed years)
    
  "prtnr_lit",              # 1 = Partner is literate
  "pben_lit_bl",               # 1 = Beneficiary is literate
  "tot_hh_rev",                # Total household revenue (continuous, local currency)
  "het_rev_sum_bohh",          # 1 = Household revenue above median
  "consum",                    # Household consumption (eq. per capita, PPP-adjusted)
  
  "ctrl_earn_index",           # Index: control over earnings (std. z-score)
  "het_ctrl_earn_index",       # 1 = Above median control over earnings index
  "ctrl_hh_index",             # Index: control over household resources (z-score)
  "het_ctrl_hh_index",         # 1 = Above median control over household resources
  "intrahh_index",             # Index: intra-household dynamics (baseline, z-score)
  "het_intrahh_index"
)

label_vec <- c(
  "Female (benef.)",
  "Age (partner)",
  "Age (beneficiary)",
  "Age gap (partner - benef.)",
  "Age gap above median (0,1)",
  
  "Age at marriage",
  "Married after 18 (0,1)",
  "Married after median age (0,1)",
  
  "Partner education (years)",
  "Partner education above median (0,1)",
  "Beneficiary education (years)",
  
  "Partner is literate (0,1)",
  "Beneficiary is literate (0,1)",
  "Total household revenue",
  "Total household revenue above median (0,1)",
  "Household consumption (eq. PPP)",
  
  "Control over earnings (index)",
  "Control over earnings above median (0,1)",
  "Control over household resources (index)",
  "Control over household resources above median (0,1)",
  "Intra-household dynamics index",
  "Intra-household dynamics above median (0,1)"
)

label_var = c("Balance test")

var_lab = c("Balance")

```


#### Tekavoul
##### Control over earnings 

<!-- ```{r} -->


<!-- df_curr1 <- followup_MRT_hh %>% -->
<!--   filter(reg_hh_csh_mrt == 1) %>%  -->
<!--   mutate(treatment_pool_bin = 0, -->
<!--       treatment_csh_trnsfr_bin = as.numeric(ifelse(treatment_csh_trnsfr == "Cash Assignment" & reg_hh_csh_mrt==1, 1, 0)), -->
<!--       treatment_capital_bin = 0, -->
<!--       treatment_psychosocial_bin = 0, -->
<!--       treatment_full_bin = 0)  %>%  -->
<!--   mutate(pben_relation_bin = labelled::unlabelled(pben_relation)) -->





<!-- df_curr1 <- df_curr1 %>%  -->
<!--   mutate(region = ifelse(region_bl==2, 0, 1), -->
<!--          rev_sum_bohh = as.numeric(rev_sum_ben_wemp_98_tr_bl), -->
<!--          tot_hh_rev = as.numeric(tot_hh_rev12_98_ppp_bl), -->
<!--          consum = as.numeric(consum_2_day_eq_ppp_tr_bl), -->
<!--          het_ctrl_earn_index = as.numeric(het_ctrl_earn_index), -->
<!--          het_ctrl_hh_index = as.numeric(het_ctrl_hh_index), -->
<!--          het_intrahh_index = as.numeric(het_intrahh_index), -->
<!--          het_age_gap = as.numeric(het_age_gap)) %>%  -->
<!--   mutate(het_ctrl_earn_index = ifelse(het_ctrl_earn_index==1, 0, 1), -->
<!--          het_ctrl_hh_index = ifelse(het_ctrl_hh_index==1, 0, 1), -->
<!--          het_intrahh_index = ifelse(het_intrahh_index==1, 0, 1), -->
<!--          het_age_gap = ifelse(het_age_gap==1, 0, 1)) -->


<!-- # Convert cash transfer treatment to factor -->
<!-- df_curr1$het_ctrl_earn_index <- factor(df_curr1$het_ctrl_earn_index, levels = c("0", "1"), labels = c("(1) \n Below Med.", "(2) \n Above Med."))  -->
<!-- df_curr1$het_ctrl_earn_index <- relevel(df_curr1$het_ctrl_earn_index, ref = "(1) \n Below Med.") # Set the reference var. -->


<!-- # Convert all variables in var_vec to numeric type -->
<!-- df_curr1 <- df_curr1  %>%  -->
<!--   dplyr::mutate(across(var_vec, as.numeric))  -->
<!-- # Create a tibble mapping variable names to their labels -->
<!-- description = tibble( -->
<!--   name = var_vec, -->
<!--   label = label_vec -->
<!-- ) -->

<!-- # Create a named list of variable labels -->
<!-- var_labels <- setNames(as.list(description$label), description$name) -->

<!-- # Apply the variable labels to the dataset -->
<!-- df_curr1 <- df_curr1 %>% -->
<!--   set_variable_labels(.labels = var_labels, .strict = FALSE) -->

<!-- # Create summary statistics table grouped by treatment -->
<!-- balance_tab_1 = df_curr1 %>%  -->
<!--   dplyr::select(het_ctrl_earn_index,var_vec) %>%   -->
<!--   tbl_summary(by = het_ctrl_earn_index, -->
<!--               type = list(var_vec ~ "continuous"), -->
<!--               statistic = list(all_continuous() ~ "{mean}({sd})"), -->
<!--               digits = everything() ~ c(2,2),  -->
<!--               missing = "no") %>%  -->
<!--   modify_header(label = 'Variable') -->

<!-- # Create vector of treatment binary comparison variables -->
<!-- lst_treatment_bin=paste("het_ctrl_earn_index") -->

<!-- # Calculate p-values for each treatment comparison and variable -->
<!-- balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) { -->
<!--   df_coef_value <- data.frame(variable = character(),  -->
<!--                        treatment = character(),  -->
<!--                        coef_val = character(),  -->
<!--                        stringsAsFactors = FALSE) -->

<!--   # Loop through each variable and run logistic regression -->
<!--   for (v_name in var_vec) { -->
<!--     # Fit logistic regression with clustered standard errors -->
<!--     reg <- glm(as.formula(paste0(treat_var, " ~ ", "`", v_name,"`" ," + strata")),  -->
<!--                family = binomial,  -->
<!--                data = df_curr1) -->

<!--     # Calculate p-value and add significance stars -->
<!--     coef_val <- round(coeftest(reg, vcovCL(reg, cluster = df_curr1$hhid))[2, 1], 3) -->
<!--     pval <- round(coeftest(reg, vcovCL(reg, cluster = df_curr1$hhid))[2, 4], 3) -->

<!--     # Add significance stars based on p-value thresholds -->
<!--     if (pval < 0.01) { -->
<!--       coef_val <- paste0(as.character(pval), "***") -->
<!--     } else if (pval < 0.05) { -->
<!--       coef_val <- paste0(as.character(pval), "**") -->
<!--     } else if (pval < 0.1) { -->
<!--       coef_val <- paste0(as.character(pval), "*") -->
<!--     }else { -->
<!--        coef_val <- as.character(pval) -->
<!--     } -->

<!--     df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name,  -->
<!--                                         treatment = treat_var,  -->
<!--                                         coef_val = coef_val,  -->
<!--                                         stringsAsFactors = FALSE)) -->
<!--   } -->

<!--   return(df_coef_value) -->
<!-- }) -->

<!-- # Reshape p-value table to wide format with treatment comparisons as columns -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   pivot_wider(id_cols = "variable",  -->
<!--               names_from = "treatment",  -->
<!--               values_from = "coef_val")  -->

<!-- # Rename columns to show treatment group comparisons -->
<!-- names(balance_tab_2) <- c("variable","(1)-(2)") -->

<!-- #Keep the variables of interest -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   select("(1)-(2)") -->

<!-- # Create table for joint F-tests -->

<!-- # For each variable, run joint F-test of treatment effects -->


<!-- myfooter <- df_curr1 %>%  -->
<!--   dplyr::select(het_ctrl_earn_index,cluster, strata) %>%   -->
<!--   group_by(het_ctrl_earn_index) %>%  -->
<!--   summarise(nbr_cluster = n_distinct(cluster), -->
<!--             nbr_strata = n_distinct(strata)) %>%  -->
<!--   column_to_rownames(var="het_ctrl_earn_index") -->

<!-- #transpose data frame -->
<!-- myfooter_t <- as.data.frame(t(myfooter)) -->

<!-- #redefine row and column names -->
<!-- rownames(myfooter_t) <- colnames(myfooter) -->
<!-- colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[seq(6,7,1)] -->

<!-- myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>% -->
<!--   mutate(Variable=dplyr::recode(Variable, nbr_cluster = "N cluster", nbr_strata = "N strata")) -->


<!-- balance_tab = cbind( -->
<!--   balance_tab_1, -->
<!--   balance_tab_2)  -->

<!-- # Adding the row on the nbr of cluster and strata -->
<!-- balance_tab_all <- plyr::rbind.fill(balance_tab,myfooter_t) -->

<!-- header <- str_squish(str_remove("Table : Balance Table ", "\n")) -->
<!-- # Set Table footer -->
<!-- footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level level. Fixed effects using randomization strata are included in all estimation regressions. The joint F-test shows the p-value from a test of equality of treatment arms. While the pooled F-test shows the p-value from a test of pooled treatment (i.e., a regression with a dummy for any treatment arm). *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n")) -->
<!-- # Set custom_tab() defaults -->
<!-- customtab_defaults() -->
<!-- custom_tab(balance_tab_all, header, footer) -->


<!-- ``` -->

<!-- ###### With ben. is hh. head -->

<!-- ```{r} -->


<!-- df_curr1 <- followup_MRT_hh %>% -->
<!--   filter(reg_hh_csh_mrt == 1) %>%  -->
<!--   mutate(treatment_pool_bin = 0, -->
<!--       treatment_csh_trnsfr_bin = as.numeric(ifelse(treatment_csh_trnsfr == "Cash Assignment" & reg_hh_csh_mrt==1, 1, 0)), -->
<!--       treatment_capital_bin = 0, -->
<!--       treatment_psychosocial_bin = 0, -->
<!--       treatment_full_bin = 0)  %>%  -->
<!--   mutate(pben_relation_bin = labelled::unlabelled(pben_relation)) %>%  -->
<!--   filter(same_cb_bl==1) -->





<!-- df_curr1 <- df_curr1 %>%  -->
<!--   mutate(region = ifelse(region_bl==2, 0, 1), -->
<!--          rev_sum_bohh = as.numeric(rev_sum_ben_wemp_98_tr_bl), -->
<!--          tot_hh_rev = as.numeric(tot_hh_rev12_98_ppp_bl), -->
<!--          consum = as.numeric(consum_2_day_eq_ppp_tr_bl), -->
<!--          het_ctrl_earn_index = as.numeric(het_ctrl_earn_index), -->
<!--          het_ctrl_hh_index = as.numeric(het_ctrl_hh_index), -->
<!--          het_intrahh_index = as.numeric(het_intrahh_index), -->
<!--          het_age_gap = as.numeric(het_age_gap)) %>%  -->
<!--   mutate(het_ctrl_earn_index = ifelse(het_ctrl_earn_index==1, 0, 1), -->
<!--          het_ctrl_hh_index = ifelse(het_ctrl_hh_index==1, 0, 1), -->
<!--          het_intrahh_index = ifelse(het_intrahh_index==1, 0, 1), -->
<!--          het_age_gap = ifelse(het_age_gap==1, 0, 1)) -->


<!-- # Convert cash transfer treatment to factor -->
<!-- df_curr1$het_ctrl_earn_index <- factor(df_curr1$het_ctrl_earn_index, levels = c("0", "1"), labels = c("(1) \n Below Med.", "(2) \n Above Med."))  -->
<!-- df_curr1$het_ctrl_earn_index <- relevel(df_curr1$het_ctrl_earn_index, ref = "(1) \n Below Med.") # Set the reference var. -->


<!-- # Convert all variables in var_vec to numeric type -->
<!-- df_curr1 <- df_curr1  %>%  -->
<!--   dplyr::mutate(across(var_vec, as.numeric))  -->
<!-- # Create a tibble mapping variable names to their labels -->
<!-- description = tibble( -->
<!--   name = var_vec, -->
<!--   label = label_vec -->
<!-- ) -->

<!-- # Create a named list of variable labels -->
<!-- var_labels <- setNames(as.list(description$label), description$name) -->

<!-- # Apply the variable labels to the dataset -->
<!-- df_curr1 <- df_curr1 %>% -->
<!--   set_variable_labels(.labels = var_labels, .strict = FALSE) -->

<!-- # Create summary statistics table grouped by treatment -->
<!-- balance_tab_1 = df_curr1 %>%  -->
<!--   dplyr::select(het_ctrl_earn_index,var_vec) %>%   -->
<!--   tbl_summary(by = het_ctrl_earn_index, -->
<!--               type = list(var_vec ~ "continuous"), -->
<!--               statistic = list(all_continuous() ~ "{mean}({sd})"), -->
<!--               digits = everything() ~ c(2,2),  -->
<!--               missing = "no") %>%  -->
<!--   modify_header(label = 'Variable') -->

<!-- # Create vector of treatment binary comparison variables -->
<!-- lst_treatment_bin=paste("het_ctrl_earn_index") -->

<!-- # Calculate p-values for each treatment comparison and variable -->
<!-- balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) { -->
<!--   df_coef_value <- data.frame(variable = character(),  -->
<!--                        treatment = character(),  -->
<!--                        coef_val = character(),  -->
<!--                        stringsAsFactors = FALSE) -->

<!--   # Loop through each variable and run logistic regression -->
<!--   for (v_name in var_vec) { -->
<!--     # Fit logistic regression with clustered standard errors -->
<!--     reg <- glm(as.formula(paste0(treat_var, " ~ ", "`", v_name,"`" ," + strata")),  -->
<!--                family = binomial,  -->
<!--                data = df_curr1) -->

<!--     # Calculate p-value and add significance stars -->
<!--     coef_val <- round(coeftest(reg, vcovCL(reg, cluster = df_curr1$hhid))[2, 1], 3) -->
<!--     pval <- round(coeftest(reg, vcovCL(reg, cluster = df_curr1$hhid))[2, 4], 3) -->

<!--     # Add significance stars based on p-value thresholds -->
<!--     if (pval < 0.01) { -->
<!--       coef_val <- paste0(as.character(pval), "***") -->
<!--     } else if (pval < 0.05) { -->
<!--       coef_val <- paste0(as.character(pval), "**") -->
<!--     } else if (pval < 0.1) { -->
<!--       coef_val <- paste0(as.character(pval), "*") -->
<!--     }else { -->
<!--        coef_val <- as.character(pval) -->
<!--     } -->

<!--     df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name,  -->
<!--                                         treatment = treat_var,  -->
<!--                                         coef_val = coef_val,  -->
<!--                                         stringsAsFactors = FALSE)) -->
<!--   } -->

<!--   return(df_coef_value) -->
<!-- }) -->

<!-- # Reshape p-value table to wide format with treatment comparisons as columns -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   pivot_wider(id_cols = "variable",  -->
<!--               names_from = "treatment",  -->
<!--               values_from = "coef_val")  -->

<!-- # Rename columns to show treatment group comparisons -->
<!-- names(balance_tab_2) <- c("variable","(1)-(2)") -->

<!-- #Keep the variables of interest -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   select("(1)-(2)") -->

<!-- # Create table for joint F-tests -->

<!-- # For each variable, run joint F-test of treatment effects -->


<!-- myfooter <- df_curr1 %>%  -->
<!--   dplyr::select(het_ctrl_earn_index,cluster, strata) %>%   -->
<!--   group_by(het_ctrl_earn_index) %>%  -->
<!--   summarise(nbr_cluster = n_distinct(cluster), -->
<!--             nbr_strata = n_distinct(strata)) %>%  -->
<!--   column_to_rownames(var="het_ctrl_earn_index") -->

<!-- #transpose data frame -->
<!-- myfooter_t <- as.data.frame(t(myfooter)) -->

<!-- #redefine row and column names -->
<!-- rownames(myfooter_t) <- colnames(myfooter) -->
<!-- colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[seq(6,7,1)] -->

<!-- myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>% -->
<!--   mutate(Variable=dplyr::recode(Variable, nbr_cluster = "N cluster", nbr_strata = "N strata")) -->


<!-- balance_tab = cbind( -->
<!--   balance_tab_1, -->
<!--   balance_tab_2)  -->

<!-- # Adding the row on the nbr of cluster and strata -->
<!-- balance_tab_hhh_ben <- plyr::rbind.fill(balance_tab,myfooter_t) -->

<!-- header <- str_squish(str_remove("Table : Balance Table ", "\n")) -->
<!-- # Set Table footer -->
<!-- footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level level. Fixed effects using randomization strata are included in all estimation regressions. The joint F-test shows the p-value from a test of equality of treatment arms. While the pooled F-test shows the p-value from a test of pooled treatment (i.e., a regression with a dummy for any treatment arm). *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n")) -->
<!-- # Set custom_tab() defaults -->
<!-- customtab_defaults() -->
<!-- custom_tab(balance_tab_hhh_ben, header, footer) -->


<!-- ``` -->

<!-- ##### Control over hh. resources -->

<!-- ###### All -->

<!-- ```{r} -->


<!-- df_curr1 <- followup_MRT_hh %>% -->
<!--   filter(reg_hh_csh_mrt == 1) %>% -->
<!--   mutate(treatment_pool_bin = 0, -->
<!--       treatment_csh_trnsfr_bin = as.numeric(ifelse(treatment_csh_trnsfr == "Cash Assignment" & reg_hh_csh_mrt==1, 1, 0)), -->
<!--       treatment_capital_bin = 0, -->
<!--       treatment_psychosocial_bin = 0, -->
<!--       treatment_full_bin = 0) %>%  -->
<!--     mutate(pben_relation_bin = labelled::unlabelled(pben_relation)) -->





<!-- df_curr1 <- df_curr1 %>% -->
<!--   mutate(region = ifelse(region_bl==2, 0, 1), -->
<!--          rev_sum_bohh = as.numeric(rev_sum_ben_wemp_98_tr_bl), -->
<!--          tot_hh_rev = as.numeric(tot_hh_rev12_98_ppp_bl), -->
<!--          consum = as.numeric(consum_2_day_eq_ppp_tr_bl), -->
<!--          het_ctrl_earn_index = as.numeric(het_ctrl_earn_index), -->
<!--          het_ctrl_hh_index = as.numeric(het_ctrl_hh_index), -->
<!--          het_intrahh_index = as.numeric(het_intrahh_index), -->
<!--          het_age_gap = as.numeric(het_age_gap)) %>% -->
<!--   mutate(het_ctrl_earn_index = ifelse(het_ctrl_earn_index==1, 0, 1), -->
<!--          het_ctrl_hh_index = ifelse(het_ctrl_hh_index==1, 0, 1), -->
<!--          het_intrahh_index = ifelse(het_intrahh_index==1, 0, 1), -->
<!--          het_age_gap = ifelse(het_age_gap==1, 0, 1)) -->


<!-- # Convert cash transfer treatment to factor -->
<!-- df_curr1$het_ctrl_hh_index <- factor(df_curr1$het_ctrl_hh_index, levels = c("0", "1"), labels = c("(1) \n Below Med.", "(2) \n Above Med."))  -->
<!-- df_curr1$het_ctrl_hh_index <- relevel(df_curr1$het_ctrl_hh_index, ref = "(1) \n Below Med.") # Set the reference var. -->


<!-- # Convert all variables in var_vec to numeric type -->
<!-- df_curr1 <- df_curr1  %>%  -->
<!--   dplyr::mutate(across(var_vec, as.numeric))  -->

<!-- # Create a tibble mapping variable names to their labels -->
<!-- description = tibble( -->
<!--   name = var_vec, -->
<!--   label = label_vec -->
<!-- ) -->

<!-- # Create a named list of variable labels -->
<!-- var_labels <- setNames(as.list(description$label), description$name) -->

<!-- # Apply the variable labels to the dataset -->
<!-- df_curr1 <- df_curr1 %>% -->
<!--   set_variable_labels(.labels = var_labels, .strict = FALSE) -->

<!-- # Create summary statistics table grouped by treatment -->
<!-- balance_tab_1 = df_curr1 %>%  -->
<!--   dplyr::select(het_ctrl_hh_index,var_vec) %>%   -->
<!--   tbl_summary(by = het_ctrl_hh_index, -->
<!--               type = (list=var_vec ~ "continuous"), -->
<!--               statistic = list(all_continuous() ~ "{mean}({sd})"), -->
<!--               digits = everything() ~ c(2,2),  -->
<!--               missing = "no") %>%  -->
<!--   modify_header(label = 'Variable') -->

<!-- # Create vector of treatment binary comparison variables -->
<!-- lst_treatment_bin=paste("het_ctrl_hh_index") -->

<!-- # Calculate p-values for each treatment comparison and variable -->
<!-- balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) { -->
<!--   df_coef_value <- data.frame(variable = character(),  -->
<!--                        treatment = character(),  -->
<!--                        coef_val = character(),  -->
<!--                        stringsAsFactors = FALSE) -->

<!--   # Loop through each variable and run logistic regression -->
<!--   for (v_name in var_vec) { -->
<!--     # Fit logistic regression with clustered standard errors -->
<!--     reg <- glm(as.formula(paste0(treat_var, " ~ ", "`", v_name,"`" ," + strata")),  -->
<!--                family = binomial,  -->
<!--                data = df_curr1) -->

<!--     # Calculate p-value and add significance stars -->
<!--     coef_val <- round(coeftest(reg, vcovCL(reg, cluster = df_curr1$hhid))[2, 1], 3) -->
<!--     pval <- round(coeftest(reg, vcovCL(reg, cluster = df_curr1$hhid))[2, 4], 3) -->

<!--     # Add significance stars based on p-value thresholds -->
<!--     if (pval < 0.01) { -->
<!--       coef_val <- paste0(as.character(pval), "***") -->
<!--     } else if (pval < 0.05) { -->
<!--       coef_val <- paste0(as.character(pval), "**") -->
<!--     } else if (pval < 0.1) { -->
<!--       coef_val <- paste0(as.character(pval), "*") -->
<!--     }else { -->
<!--        coef_val <- as.character(pval) -->
<!--     } -->

<!--     df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name,  -->
<!--                                         treatment = treat_var,  -->
<!--                                         coef_val = coef_val,  -->
<!--                                         stringsAsFactors = FALSE)) -->
<!--   } -->

<!--   return(df_coef_value) -->
<!-- }) -->

<!-- # Reshape p-value table to wide format with treatment comparisons as columns -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   pivot_wider(id_cols = "variable",  -->
<!--               names_from = "treatment",  -->
<!--               values_from = "coef_val")  -->

<!-- # Rename columns to show treatment group comparisons -->
<!-- names(balance_tab_2) <- c("variable","(1)-(2)") -->

<!-- #Keep the variables of interest -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   select("(1)-(2)") -->

<!-- # Create table for joint F-tests -->

<!-- # For each variable, run joint F-test of treatment effects -->


<!-- myfooter <- df_curr1 %>%  -->
<!--   dplyr::select(het_ctrl_hh_index,cluster, strata) %>%   -->
<!--   group_by(het_ctrl_hh_index) %>%  -->
<!--   summarise(nbr_cluster = n_distinct(cluster), -->
<!--             nbr_strata = n_distinct(strata)) %>%  -->
<!--   drop_na() %>%  -->
<!--   column_to_rownames(var="het_ctrl_hh_index") -->

<!-- #transpose data frame -->
<!-- myfooter_t <- as.data.frame(t(myfooter)) -->

<!-- #redefine row and column names -->
<!-- rownames(myfooter_t) <- colnames(myfooter) -->
<!-- colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[seq(6,7,1)] -->

<!-- myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>% -->
<!--   mutate(Variable=dplyr::recode(Variable, nbr_cluster = "N cluster", nbr_strata = "N strata")) -->


<!-- balance_tab = cbind( -->
<!--   balance_tab_1, -->
<!--   balance_tab_2)  -->

<!-- # Adding the row on the nbr of cluster and strata -->
<!-- balance_tab <- plyr::rbind.fill(balance_tab,myfooter_t) -->

<!-- header <- str_squish(str_remove("Table : Balance Table ", "\n")) -->
<!-- # Set Table footer -->
<!-- footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level level. Fixed effects using randomization strata are included in all estimation regressions. The joint F-test shows the p-value from a test of equality of treatment arms. While the pooled F-test shows the p-value from a test of pooled treatment (i.e., a regression with a dummy for any treatment arm). *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n")) -->
<!-- # Set custom_tab() defaults -->
<!-- customtab_defaults() -->
<!-- custom_tab(balance_tab, header, footer) -->


<!-- ``` -->


<!-- ###### With ben. is hh. head -->

<!-- ```{r} -->


<!-- df_curr1 <- followup_MRT_hh %>% -->
<!--   filter(reg_hh_csh_mrt == 1) %>% -->
<!--   mutate(treatment_pool_bin = 0, -->
<!--       treatment_csh_trnsfr_bin = as.numeric(ifelse(treatment_csh_trnsfr == "Cash Assignment" & reg_hh_csh_mrt==1, 1, 0)), -->
<!--       treatment_capital_bin = 0, -->
<!--       treatment_psychosocial_bin = 0, -->
<!--       treatment_full_bin = 0) %>%  -->
<!--     mutate(pben_relation_bin = labelled::unlabelled(pben_relation))%>%  -->
<!--     filter(same_cb_bl==1) -->





<!-- df_curr1 <- df_curr1 %>% -->
<!--   mutate(region = ifelse(region_bl==2, 0, 1), -->
<!--          rev_sum_bohh = as.numeric(rev_sum_ben_wemp_98_tr_bl), -->
<!--          tot_hh_rev = as.numeric(tot_hh_rev12_98_ppp_bl), -->
<!--          consum = as.numeric(consum_2_day_eq_ppp_tr_bl), -->
<!--          het_ctrl_earn_index = as.numeric(het_ctrl_earn_index), -->
<!--          het_ctrl_hh_index = as.numeric(het_ctrl_hh_index), -->
<!--          het_intrahh_index = as.numeric(het_intrahh_index), -->
<!--          het_age_gap = as.numeric(het_age_gap)) %>% -->
<!--   mutate(het_ctrl_earn_index = ifelse(het_ctrl_earn_index==1, 0, 1), -->
<!--          het_ctrl_hh_index = ifelse(het_ctrl_hh_index==1, 0, 1), -->
<!--          het_intrahh_index = ifelse(het_intrahh_index==1, 0, 1), -->
<!--          het_age_gap = ifelse(het_age_gap==1, 0, 1)) -->


<!-- # Convert cash transfer treatment to factor -->
<!-- df_curr1$het_ctrl_hh_index <- factor(df_curr1$het_ctrl_hh_index, levels = c("0", "1"), labels = c("(1) \n Below Med.", "(2) \n Above Med."))  -->
<!-- df_curr1$het_ctrl_hh_index <- relevel(df_curr1$het_ctrl_hh_index, ref = "(1) \n Below Med.") # Set the reference var. -->


<!-- # Convert all variables in var_vec to numeric type -->
<!-- df_curr1 <- df_curr1  %>%  -->
<!--   dplyr::mutate(across(var_vec, as.numeric))  -->

<!-- # Create a tibble mapping variable names to their labels -->
<!-- description = tibble( -->
<!--   name = var_vec, -->
<!--   label = label_vec -->
<!-- ) -->

<!-- # Create a named list of variable labels -->
<!-- var_labels <- setNames(as.list(description$label), description$name) -->

<!-- # Apply the variable labels to the dataset -->
<!-- df_curr1 <- df_curr1 %>% -->
<!--   set_variable_labels(.labels = var_labels, .strict = FALSE) -->

<!-- # Create summary statistics table grouped by treatment -->
<!-- balance_tab_1 = df_curr1 %>%  -->
<!--   dplyr::select(het_ctrl_hh_index,var_vec) %>%   -->
<!--   tbl_summary(by = het_ctrl_hh_index, -->
<!--               type = (list=var_vec ~ "continuous"), -->
<!--               statistic = list(all_continuous() ~ "{mean}({sd})"), -->
<!--               digits = everything() ~ c(2,2),  -->
<!--               missing = "no") %>%  -->
<!--   modify_header(label = 'Variable') -->

<!-- # Create vector of treatment binary comparison variables -->
<!-- lst_treatment_bin=paste("het_ctrl_hh_index") -->

<!-- # Calculate p-values for each treatment comparison and variable -->
<!-- balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) { -->
<!--   df_coef_value <- data.frame(variable = character(),  -->
<!--                        treatment = character(),  -->
<!--                        coef_val = character(),  -->
<!--                        stringsAsFactors = FALSE) -->

<!--   # Loop through each variable and run logistic regression -->
<!--   for (v_name in var_vec) { -->
<!--     # Fit logistic regression with clustered standard errors -->
<!--     reg <- glm(as.formula(paste0(treat_var, " ~ ", "`", v_name,"`" ," + strata")),  -->
<!--                family = binomial,  -->
<!--                data = df_curr1) -->

<!--     # Calculate p-value and add significance stars -->
<!--     coef_val <- round(coeftest(reg, vcovCL(reg, cluster = df_curr1$hhid))[2, 1], 3) -->
<!--     pval <- round(coeftest(reg, vcovCL(reg, cluster = df_curr1$hhid))[2, 4], 3) -->

<!--     # Add significance stars based on p-value thresholds -->
<!--     if (pval < 0.01) { -->
<!--       coef_val <- paste0(as.character(pval), "***") -->
<!--     } else if (pval < 0.05) { -->
<!--       coef_val <- paste0(as.character(pval), "**") -->
<!--     } else if (pval < 0.1) { -->
<!--       coef_val <- paste0(as.character(pval), "*") -->
<!--     }else { -->
<!--        coef_val <- as.character(pval) -->
<!--     } -->

<!--     df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name,  -->
<!--                                         treatment = treat_var,  -->
<!--                                         coef_val = coef_val,  -->
<!--                                         stringsAsFactors = FALSE)) -->
<!--   } -->

<!--   return(df_coef_value) -->
<!-- }) -->

<!-- # Reshape p-value table to wide format with treatment comparisons as columns -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   pivot_wider(id_cols = "variable",  -->
<!--               names_from = "treatment",  -->
<!--               values_from = "coef_val")  -->

<!-- # Rename columns to show treatment group comparisons -->
<!-- names(balance_tab_2) <- c("variable","(1)-(2)") -->

<!-- #Keep the variables of interest -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   select("(1)-(2)") -->

<!-- # Create table for joint F-tests -->

<!-- # For each variable, run joint F-test of treatment effects -->


<!-- myfooter <- df_curr1 %>%  -->
<!--   dplyr::select(het_ctrl_hh_index,cluster, strata) %>%   -->
<!--   group_by(het_ctrl_hh_index) %>%  -->
<!--   summarise(nbr_cluster = n_distinct(cluster), -->
<!--             nbr_strata = n_distinct(strata)) %>%  -->
<!--   drop_na() %>%  -->
<!--   column_to_rownames(var="het_ctrl_hh_index") -->

<!-- #transpose data frame -->
<!-- myfooter_t <- as.data.frame(t(myfooter)) -->

<!-- #redefine row and column names -->
<!-- rownames(myfooter_t) <- colnames(myfooter) -->
<!-- colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[seq(6,7,1)] -->

<!-- myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>% -->
<!--   mutate(Variable=dplyr::recode(Variable, nbr_cluster = "N cluster", nbr_strata = "N strata")) -->


<!-- balance_tab = cbind( -->
<!--   balance_tab_1, -->
<!--   balance_tab_2)  -->

<!-- # Adding the row on the nbr of cluster and strata -->
<!-- balance_tab <- plyr::rbind.fill(balance_tab,myfooter_t) -->

<!-- header <- str_squish(str_remove("Table : Balance Table ", "\n")) -->
<!-- # Set Table footer -->
<!-- footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level level. Fixed effects using randomization strata are included in all estimation regressions. The joint F-test shows the p-value from a test of equality of treatment arms. While the pooled F-test shows the p-value from a test of pooled treatment (i.e., a regression with a dummy for any treatment arm). *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n")) -->
<!-- # Set custom_tab() defaults -->
<!-- customtab_defaults() -->
<!-- custom_tab(balance_tab, header, footer) -->


<!-- ``` -->

<!-- ##### Intra-household dynamics   -->

<!-- ###### All -->

<!-- ```{r} -->


<!-- df_curr1 <- followup_MRT_hh %>% -->
<!--   filter(reg_hh_csh_mrt == 1) %>% -->
<!--   mutate(treatment_pool_bin = 0, -->
<!--       treatment_csh_trnsfr_bin = as.numeric(ifelse(treatment_csh_trnsfr == "Cash Assignment" & reg_hh_csh_mrt==1, 1, 0)), -->
<!--       treatment_capital_bin = 0, -->
<!--       treatment_psychosocial_bin = 0, -->
<!--       treatment_full_bin = 0)  %>%  -->
<!--   mutate(pben_relation_bin = labelled::unlabelled(pben_relation)) -->





<!-- df_curr1 <- df_curr1 %>% -->
<!--   mutate(region = ifelse(region_bl==2, 0, 1), -->
<!--          rev_sum_bohh = as.numeric(rev_sum_ben_wemp_98_tr_bl), -->
<!--          tot_hh_rev = as.numeric(tot_hh_rev12_98_ppp_bl), -->
<!--          consum = as.numeric(consum_2_day_eq_ppp_tr_bl), -->
<!--          het_ctrl_earn_index = as.numeric(het_ctrl_earn_index), -->
<!--          het_ctrl_hh_index = as.numeric(het_ctrl_hh_index), -->
<!--          het_intrahh_index = as.numeric(het_intrahh_index), -->
<!--          het_age_gap = as.numeric(het_age_gap)) %>% -->
<!--   mutate(het_ctrl_earn_index = ifelse(het_ctrl_earn_index==1, 0, 1), -->
<!--          het_ctrl_hh_index = ifelse(het_ctrl_hh_index==1, 0, 1), -->
<!--          het_intrahh_index = ifelse(het_intrahh_index==1, 0, 1), -->
<!--          het_age_gap = ifelse(het_age_gap==1, 0, 1)) -->


<!-- # Convert cash transfer treatment to factor -->
<!-- df_curr1$het_intrahh_index <- factor(df_curr1$het_intrahh_index, levels = c("0", "1"), labels = c("(1) \n Below Med.", "(2) \n Above Med."))  -->
<!-- df_curr1$het_intrahh_index <- relevel(df_curr1$het_intrahh_index, ref = "(1) \n Below Med.") # Set the reference var. -->


<!-- # Convert all variables in var_vec to numeric type -->
<!-- df_curr1 <- df_curr1  %>%  -->
<!--   dplyr::mutate(across(var_vec, as.numeric))  -->

<!-- # Create a tibble mapping variable names to their labels -->
<!-- description = tibble( -->
<!--   name = var_vec, -->
<!--   label = label_vec -->
<!-- ) -->

<!-- # Create a named list of variable labels -->
<!-- var_labels <- setNames(as.list(description$label), description$name) -->

<!-- # Apply the variable labels to the dataset -->
<!-- df_curr1 <- df_curr1 %>% -->
<!--   set_variable_labels(.labels = var_labels, .strict = FALSE) -->

<!-- # Create summary statistics table grouped by treatment -->
<!-- balance_tab_1 = df_curr1 %>%  -->
<!--   dplyr::select(het_intrahh_index,var_vec) %>%   -->
<!--   tbl_summary(by = het_intrahh_index, -->
<!--               type = (list=var_vec ~ "continuous"), -->
<!--               statistic = list(all_continuous() ~ "{mean}({sd})"), -->
<!--               digits = everything() ~ c(2,2),  -->
<!--               missing = "no") %>%  -->
<!--   modify_header(label = 'Variable') -->

<!-- # Create vector of treatment binary comparison variables -->
<!-- lst_treatment_bin=paste("het_intrahh_index") -->

<!-- # Calculate p-values for each treatment comparison and variable -->
<!-- balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) { -->
<!--   df_coef_value <- data.frame(variable = character(),  -->
<!--                        treatment = character(),  -->
<!--                        coef_val = character(),  -->
<!--                        stringsAsFactors = FALSE) -->

<!--   # Loop through each variable and run logistic regression -->
<!--   for (v_name in var_vec) { -->
<!--     # Fit logistic regression with clustered standard errors -->
<!--     reg <- glm(as.formula(paste0(treat_var, " ~ ", "`", v_name,"`" ," + strata")),  -->
<!--                family = binomial,  -->
<!--                data = df_curr1) -->

<!--     # Calculate p-value and add significance stars -->
<!--     coef_val <- round(coeftest(reg, vcovCL(reg, cluster = df_curr1$hhid))[2, 1], 3) -->
<!--     pval <- round(coeftest(reg, vcovCL(reg, cluster = df_curr1$hhid))[2, 4], 3) -->

<!--     # Add significance stars based on p-value thresholds -->
<!--     if (pval < 0.01) { -->
<!--       coef_val <- paste0(as.character(pval), "***") -->
<!--     } else if (pval < 0.05) { -->
<!--       coef_val <- paste0(as.character(pval), "**") -->
<!--     } else if (pval < 0.1) { -->
<!--       coef_val <- paste0(as.character(pval), "*") -->
<!--     }else { -->
<!--        coef_val <- as.character(pval) -->
<!--     } -->

<!--     df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name,  -->
<!--                                         treatment = treat_var,  -->
<!--                                         coef_val = coef_val,  -->
<!--                                         stringsAsFactors = FALSE)) -->
<!--   } -->

<!--   return(df_coef_value) -->
<!-- }) -->

<!-- # Reshape p-value table to wide format with treatment comparisons as columns -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   pivot_wider(id_cols = "variable",  -->
<!--               names_from = "treatment",  -->
<!--               values_from = "coef_val")  -->

<!-- # Rename columns to show treatment group comparisons -->
<!-- names(balance_tab_2) <- c("variable","(1)-(2)") -->

<!-- #Keep the variables of interest -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   select("(1)-(2)") -->

<!-- # Create table for joint F-tests -->

<!-- # For each variable, run joint F-test of treatment effects -->


<!-- myfooter <- df_curr1 %>%  -->
<!--   dplyr::select(het_intrahh_index,cluster, strata) %>%   -->
<!--   group_by(het_intrahh_index) %>%  -->
<!--   summarise(nbr_cluster = n_distinct(cluster), -->
<!--             nbr_strata = n_distinct(strata)) %>%  -->
<!--   drop_na() %>%  -->
<!--   column_to_rownames(var="het_intrahh_index") -->

<!-- #transpose data frame -->
<!-- myfooter_t <- as.data.frame(t(myfooter)) -->

<!-- #redefine row and column names -->
<!-- rownames(myfooter_t) <- colnames(myfooter) -->
<!-- colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[seq(6,7,1)] -->

<!-- myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>% -->
<!--   mutate(Variable=dplyr::recode(Variable, nbr_cluster = "N cluster", nbr_strata = "N strata")) -->


<!-- balance_tab = cbind( -->
<!--   balance_tab_1, -->
<!--   balance_tab_2)  -->

<!-- # Adding the row on the nbr of cluster and strata -->
<!-- balance_tab <- plyr::rbind.fill(balance_tab,myfooter_t) -->

<!-- header <- str_squish(str_remove("Table : Balance Table ", "\n")) -->
<!-- # Set Table footer -->
<!-- footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level level. Fixed effects using randomization strata are included in all estimation regressions. The joint F-test shows the p-value from a test of equality of treatment arms. While the pooled F-test shows the p-value from a test of pooled treatment (i.e., a regression with a dummy for any treatment arm). *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n")) -->
<!-- # Set custom_tab() defaults -->
<!-- customtab_defaults() -->
<!-- custom_tab(balance_tab, header, footer) -->


<!-- ``` -->

<!-- ###### With ben. is hh. head -->


<!-- ```{r} -->


<!-- df_curr1 <- followup_MRT_hh %>% -->
<!--   filter(reg_hh_csh_mrt == 1) %>% -->
<!--   mutate(treatment_pool_bin = 0, -->
<!--       treatment_csh_trnsfr_bin = as.numeric(ifelse(treatment_csh_trnsfr == "Cash Assignment" & reg_hh_csh_mrt==1, 1, 0)), -->
<!--       treatment_capital_bin = 0, -->
<!--       treatment_psychosocial_bin = 0, -->
<!--       treatment_full_bin = 0) %>%  -->
<!--     mutate(pben_relation_bin = labelled::unlabelled(pben_relation))%>%  -->
<!--   filter(same_cb_bl==1)  -->




<!-- df_curr1 <- df_curr1 %>% -->
<!--   mutate(region = ifelse(region_bl==2, 0, 1), -->
<!--          rev_sum_bohh = as.numeric(rev_sum_ben_wemp_98_tr_bl), -->
<!--          tot_hh_rev = as.numeric(tot_hh_rev12_98_ppp_bl), -->
<!--          consum = as.numeric(consum_2_day_eq_ppp_tr_bl), -->
<!--          het_ctrl_earn_index = as.numeric(het_ctrl_earn_index), -->
<!--          het_ctrl_hh_index = as.numeric(het_ctrl_hh_index), -->
<!--          het_intrahh_index = as.numeric(het_intrahh_index), -->
<!--          het_age_gap = as.numeric(het_age_gap)) %>% -->
<!--   mutate(het_ctrl_earn_index = ifelse(het_ctrl_earn_index==1, 0, 1), -->
<!--          het_ctrl_hh_index = ifelse(het_ctrl_hh_index==1, 0, 1), -->
<!--          het_intrahh_index = ifelse(het_intrahh_index==1, 0, 1), -->
<!--          het_age_gap = ifelse(het_age_gap==1, 0, 1)) -->


<!-- # Convert cash transfer treatment to factor -->
<!-- df_curr1$het_intrahh_index <- factor(df_curr1$het_intrahh_index, levels = c("0", "1"), labels = c("(1) \n Below Med.", "(2) \n Above Med."))  -->
<!-- df_curr1$het_intrahh_index <- relevel(df_curr1$het_intrahh_index, ref = "(1) \n Below Med.") # Set the reference var. -->


<!-- # Convert all variables in var_vec to numeric type -->
<!-- df_curr1 <- df_curr1  %>%  -->
<!--   dplyr::mutate(across(var_vec, as.numeric))  -->

<!-- # Create a tibble mapping variable names to their labels -->
<!-- description = tibble( -->
<!--   name = var_vec, -->
<!--   label = label_vec -->
<!-- ) -->

<!-- # Create a named list of variable labels -->
<!-- var_labels <- setNames(as.list(description$label), description$name) -->

<!-- # Apply the variable labels to the dataset -->
<!-- df_curr1 <- df_curr1 %>% -->
<!--   set_variable_labels(.labels = var_labels, .strict = FALSE) -->

<!-- # Create summary statistics table grouped by treatment -->
<!-- balance_tab_1 = df_curr1 %>%  -->
<!--   dplyr::select(het_intrahh_index,var_vec) %>%   -->
<!--   tbl_summary(by = het_intrahh_index, -->
<!--               type = (list=var_vec ~ "continuous"), -->
<!--               statistic = list(all_continuous() ~ "{mean}({sd})"), -->
<!--               digits = everything() ~ c(2,2),  -->
<!--               missing = "no") %>%  -->
<!--   modify_header(label = 'Variable') -->

<!-- # Create vector of treatment binary comparison variables -->
<!-- lst_treatment_bin=paste("het_intrahh_index") -->

<!-- # Calculate p-values for each treatment comparison and variable -->
<!-- balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) { -->
<!--   df_coef_value <- data.frame(variable = character(),  -->
<!--                        treatment = character(),  -->
<!--                        coef_val = character(),  -->
<!--                        stringsAsFactors = FALSE) -->

<!--   # Loop through each variable and run logistic regression -->
<!--   for (v_name in var_vec) { -->
<!--     # Fit logistic regression with clustered standard errors -->
<!--     reg <- glm(as.formula(paste0(treat_var, " ~ ", "`", v_name,"`" ," + strata")),  -->
<!--                family = binomial,  -->
<!--                data = df_curr1) -->

<!--     # Calculate p-value and add significance stars -->
<!--     coef_val <- round(coeftest(reg, vcovCL(reg, cluster = df_curr1$hhid))[2, 1], 3) -->
<!--     pval <- round(coeftest(reg, vcovCL(reg, cluster = df_curr1$hhid))[2, 4], 3) -->

<!--     # Add significance stars based on p-value thresholds -->
<!--     if (pval < 0.01) { -->
<!--       coef_val <- paste0(as.character(pval), "***") -->
<!--     } else if (pval < 0.05) { -->
<!--       coef_val <- paste0(as.character(pval), "**") -->
<!--     } else if (pval < 0.1) { -->
<!--       coef_val <- paste0(as.character(pval), "*") -->
<!--     }else { -->
<!--        coef_val <- as.character(pval) -->
<!--     } -->

<!--     df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name,  -->
<!--                                         treatment = treat_var,  -->
<!--                                         coef_val = coef_val,  -->
<!--                                         stringsAsFactors = FALSE)) -->
<!--   } -->

<!--   return(df_coef_value) -->
<!-- }) -->

<!-- # Reshape p-value table to wide format with treatment comparisons as columns -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   pivot_wider(id_cols = "variable",  -->
<!--               names_from = "treatment",  -->
<!--               values_from = "coef_val")  -->

<!-- # Rename columns to show treatment group comparisons -->
<!-- names(balance_tab_2) <- c("variable","(1)-(2)") -->

<!-- #Keep the variables of interest -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   select("(1)-(2)") -->

<!-- # Create table for joint F-tests -->

<!-- # For each variable, run joint F-test of treatment effects -->


<!-- myfooter <- df_curr1 %>%  -->
<!--   dplyr::select(het_intrahh_index,cluster, strata) %>%   -->
<!--   group_by(het_intrahh_index) %>%  -->
<!--   summarise(nbr_cluster = n_distinct(cluster), -->
<!--             nbr_strata = n_distinct(strata)) %>%  -->
<!--   drop_na() %>%  -->
<!--   column_to_rownames(var="het_intrahh_index") -->

<!-- #transpose data frame -->
<!-- myfooter_t <- as.data.frame(t(myfooter)) -->

<!-- #redefine row and column names -->
<!-- rownames(myfooter_t) <- colnames(myfooter) -->
<!-- colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[seq(6,7,1)] -->

<!-- myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>% -->
<!--   mutate(Variable=dplyr::recode(Variable, nbr_cluster = "N cluster", nbr_strata = "N strata")) -->


<!-- balance_tab = cbind( -->
<!--   balance_tab_1, -->
<!--   balance_tab_2)  -->

<!-- # Adding the row on the nbr of cluster and strata -->
<!-- balance_tab <- plyr::rbind.fill(balance_tab,myfooter_t) -->

<!-- header <- str_squish(str_remove("Table : Balance Table ", "\n")) -->
<!-- # Set Table footer -->
<!-- footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level level. Fixed effects using randomization strata are included in all estimation regressions. The joint F-test shows the p-value from a test of equality of treatment arms. While the pooled F-test shows the p-value from a test of pooled treatment (i.e., a regression with a dummy for any treatment arm). *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n")) -->
<!-- # Set custom_tab() defaults -->
<!-- customtab_defaults() -->
<!-- custom_tab(balance_tab, header, footer) -->


<!-- ``` -->

<!-- ##### Ben. is hh. head -->

<!-- ```{r} -->


<!-- df_curr1 <- followup_MRT_hh %>% -->
<!--   filter(reg_hh_csh_mrt == 1) %>% -->
<!--   mutate(treatment_pool_bin = 0, -->
<!--       treatment_csh_trnsfr_bin = as.numeric(ifelse(treatment_csh_trnsfr == "Cash Assignment" & reg_hh_csh_mrt==1, 1, 0)), -->
<!--       treatment_capital_bin = 0, -->
<!--       treatment_psychosocial_bin = 0, -->
<!--       treatment_full_bin = 0) -->


<!-- df_curr1 <- df_curr1 %>% -->
<!--   mutate(region = ifelse(region_bl==2, 0, 1), -->
<!--          rev_sum_bohh = as.numeric(rev_sum_ben_wemp_98_tr_bl), -->
<!--          tot_hh_rev = as.numeric(tot_hh_rev12_98_ppp_bl), -->
<!--          consum = as.numeric(consum_2_day_eq_ppp_tr_bl), -->
<!--          het_ctrl_earn_index = as.numeric(het_ctrl_earn_index), -->
<!--          het_ctrl_hh_index = as.numeric(het_ctrl_hh_index), -->
<!--          het_intrahh_index = as.numeric(het_intrahh_index), -->
<!--          het_age_gap = as.numeric(het_age_gap)) %>% -->
<!--   mutate(het_ctrl_earn_index = ifelse(het_ctrl_earn_index==1, 0, 1), -->
<!--          het_ctrl_hh_index = ifelse(het_ctrl_hh_index==1, 0, 1), -->
<!--          het_intrahh_index = ifelse(het_intrahh_index==1, 0, 1), -->
<!--          het_age_gap = ifelse(het_age_gap==1, 0, 1)) -->


<!-- # Convert cash transfer treatment to factor -->
<!-- df_curr1$same_cb_bl_bin <- factor(df_curr1$same_cb_bl, levels = c("0", "1"), labels = c("(1) \n Ben. is not hh. head", "(2) \n Ben. is hh. head"))  -->
<!-- df_curr1$same_cb_bl_bin <- relevel(df_curr1$same_cb_bl_bin, ref = "(1) \n Ben. is not hh. head") # Set the reference var. -->


<!-- # Convert all variables in var_vec to numeric type -->
<!-- df_curr1 <- df_curr1  %>%  -->
<!--   dplyr::mutate(across(var_vec, as.numeric))  -->

<!-- # Create a tibble mapping variable names to their labels -->
<!-- description = tibble( -->
<!--   name = var_vec, -->
<!--   label = label_vec -->
<!-- ) -->

<!-- # Create a named list of variable labels -->
<!-- var_labels <- setNames(as.list(description$label), description$name) -->

<!-- # Apply the variable labels to the dataset -->
<!-- df_curr1 <- df_curr1 %>% -->
<!--   set_variable_labels(.labels = var_labels, .strict = FALSE) -->

<!-- # Create summary statistics table grouped by treatment -->
<!-- balance_tab_1 = df_curr1 %>%  -->
<!--   dplyr::select(same_cb_bl_bin,var_vec) %>%   -->
<!--   tbl_summary(by = same_cb_bl_bin, -->
<!--               type = (list=var_vec ~ "continuous"), -->
<!--               statistic = list(all_continuous() ~ "{mean}({sd})"), -->
<!--               digits = everything() ~ c(2,2),  -->
<!--               missing = "no") %>%  -->
<!--   modify_header(label = 'Variable') -->

<!-- # Create vector of treatment binary comparison variables -->
<!-- lst_treatment_bin=paste("same_cb_bl_bin") -->

<!-- # Calculate p-values for each treatment comparison and variable -->
<!-- balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) { -->
<!--   df_coef_value <- data.frame(variable = character(),  -->
<!--                        treatment = character(),  -->
<!--                        coef_val = character(),  -->
<!--                        stringsAsFactors = FALSE) -->

<!--   # Loop through each variable and run logistic regression -->
<!--   for (v_name in var_vec) { -->
<!--     # Fit logistic regression with clustered standard errors -->
<!--     reg <- glm(as.formula(paste0(treat_var, " ~ ", "`", v_name,"`" ," + strata")),  -->
<!--                family = binomial,  -->
<!--                data = df_curr1) -->

<!--     # Calculate p-value and add significance stars -->
<!--     coef_val <- round(coeftest(reg, vcovCL(reg, cluster = df_curr1$hhid))[2, 1], 3) -->
<!--     pval <- round(coeftest(reg, vcovCL(reg, cluster = df_curr1$hhid))[2, 4], 3) -->

<!--     # Add significance stars based on p-value thresholds -->
<!--     if (pval < 0.01) { -->
<!--       coef_val <- paste0(as.character(pval), "***") -->
<!--     } else if (pval < 0.05) { -->
<!--       coef_val <- paste0(as.character(pval), "**") -->
<!--     } else if (pval < 0.1) { -->
<!--       coef_val <- paste0(as.character(pval), "*") -->
<!--     }else { -->
<!--        coef_val <- as.character(pval) -->
<!--     } -->

<!--     df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name,  -->
<!--                                         treatment = treat_var,  -->
<!--                                         coef_val = coef_val,  -->
<!--                                         stringsAsFactors = FALSE)) -->
<!--   } -->

<!--   return(df_coef_value) -->
<!-- }) -->

<!-- # Reshape p-value table to wide format with treatment comparisons as columns -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   pivot_wider(id_cols = "variable",  -->
<!--               names_from = "treatment",  -->
<!--               values_from = "coef_val")  -->

<!-- # Rename columns to show treatment group comparisons -->
<!-- names(balance_tab_2) <- c("variable","(1)-(2)") -->

<!-- #Keep the variables of interest -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   select("(1)-(2)") -->

<!-- # Create table for joint F-tests -->

<!-- # For each variable, run joint F-test of treatment effects -->


<!-- myfooter <- df_curr1 %>%  -->
<!--   dplyr::select(same_cb_bl_bin,cluster, strata) %>%   -->
<!--   group_by(same_cb_bl_bin) %>%  -->
<!--   summarise(nbr_cluster = n_distinct(cluster), -->
<!--             nbr_strata = n_distinct(strata)) %>%  -->
<!--   drop_na() %>%  -->
<!--   column_to_rownames(var="same_cb_bl_bin") -->

<!-- #transpose data frame -->
<!-- myfooter_t <- as.data.frame(t(myfooter)) -->

<!-- #redefine row and column names -->
<!-- rownames(myfooter_t) <- colnames(myfooter) -->
<!-- colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[seq(6,7,1)] -->

<!-- myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>% -->
<!--   mutate(Variable=dplyr::recode(Variable, nbr_cluster = "N cluster", nbr_strata = "N strata")) -->


<!-- balance_tab = cbind( -->
<!--   balance_tab_1, -->
<!--   balance_tab_2)  -->

<!-- # Adding the row on the nbr of cluster and strata -->
<!-- balance_tab <- plyr::rbind.fill(balance_tab,myfooter_t) -->

<!-- header <- str_squish(str_remove("Table : Balance Table ", "\n")) -->
<!-- # Set Table footer -->
<!-- footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level level. Fixed effects using randomization strata are included in all estimation regressions. The joint F-test shows the p-value from a test of equality of treatment arms. While the pooled F-test shows the p-value from a test of pooled treatment (i.e., a regression with a dummy for any treatment arm). *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n")) -->
<!-- # Set custom_tab() defaults -->
<!-- customtab_defaults() -->
<!-- custom_tab(balance_tab, header, footer) -->


<!-- ``` -->

<!-- #### Productive inclusion -->

<!-- ##### Control over earnings -->

<!-- ###### All -->

<!-- ```{r} -->


<!-- df_curr2 <- followup_MRT_hh  %>% -->
<!--   filter(reg_hh_pi_mrt == 1) %>%  -->
<!--       mutate(treatment_pool_bin = as.numeric(ifelse(treatment_pi_pool=="Pool" & reg_hh_pi_mrt==1, 1, 0)), -->

<!--       treatment_csh_trnsfr_bin = as.numeric(ifelse(treatment_pi_pool =="Control" & reg_hh_pi_mrt==1, 1,0)), -->

<!--       treatment_capital_bin = as.numeric(ifelse(treatment_pi=="Capital" & reg_hh_pi_mrt==1, 1, 0)), -->

<!--       treatment_psychosocial_bin = as.numeric(ifelse(treatment_pi=="Psychosocial" & reg_hh_pi_mrt==1, 1, 0)), -->

<!--       treatment_full_bin = as.numeric(ifelse(treatment_pi=="Full" & reg_hh_pi_mrt==1, 1, 0))) -->


<!-- df_curr2 <- df_curr2 %>%  -->
<!--   mutate(region = ifelse(region_bl==2, 0, 1), -->
<!--          rev_sum_bohh = as.numeric(rev_sum_ben_wemp_98_tr_bl), -->
<!--          tot_hh_rev = as.numeric(tot_hh_rev12_98_ppp_bl), -->
<!--          consum = as.numeric(consum_2_day_eq_ppp_tr_bl), -->
<!--          het_ctrl_earn_index = as.numeric(het_ctrl_earn_index), -->
<!--          het_ctrl_hh_index = as.numeric(het_ctrl_hh_index), -->
<!--          het_intrahh_index = as.numeric(het_intrahh_index), -->
<!--          het_age_gap = as.numeric(het_age_gap)) %>%  -->
<!--   mutate(het_ctrl_earn_index = ifelse(het_ctrl_earn_index==1, 0, 1), -->
<!--          het_ctrl_hh_index = ifelse(het_ctrl_hh_index==1, 0, 1), -->
<!--          het_intrahh_index = ifelse(het_intrahh_index==1, 0, 1), -->
<!--          het_age_gap = ifelse(het_age_gap==1, 0, 1)) -->


<!-- # Convert cash transfer treatment to factor -->
<!-- df_curr2$het_ctrl_earn_index <- factor(df_curr2$het_ctrl_earn_index, levels = c("0", "1"), labels = c("(1) \n Below Med.", "(2) \n Above Med."))  -->
<!-- df_curr2$het_ctrl_earn_index <- relevel(df_curr2$het_ctrl_earn_index, ref = "(1) \n Below Med.") # Set the reference var. -->


<!-- # Convert all variables in var_vec to numeric type -->
<!-- df_curr2 <- df_curr2  %>%  -->
<!--   dplyr::mutate(across(var_vec, as.numeric))  -->
<!-- # Create a tibble mapping variable names to their labels -->
<!-- description = tibble( -->
<!--   name = var_vec, -->
<!--   label = label_vec -->
<!-- ) -->

<!-- # Create a named list of variable labels -->
<!-- var_labels <- setNames(as.list(description$label), description$name) -->

<!-- # Apply the variable labels to the dataset -->
<!-- df_curr2 <- df_curr2 %>% -->
<!--   set_variable_labels(.labels = var_labels, .strict = FALSE) -->

<!-- # Create summary statistics table grouped by treatment -->
<!-- balance_tab_1 = df_curr2 %>%  -->
<!--   dplyr::select(het_ctrl_earn_index,var_vec) %>%   -->
<!--   tbl_summary(by = het_ctrl_earn_index, -->
<!--               type = (list=var_vec ~ "continuous"), -->
<!--               statistic = list(all_continuous() ~ "{mean}({sd})"), -->
<!--               digits = everything() ~ c(2,2),  -->
<!--               missing = "no") %>%  -->
<!--   modify_header(label = 'Variable') -->

<!-- # Create vector of treatment binary comparison variables -->
<!-- lst_treatment_bin=paste("het_ctrl_earn_index") -->

<!-- # Calculate p-values for each treatment comparison and variable -->
<!-- balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) { -->
<!--   df_coef_value <- data.frame(variable = character(),  -->
<!--                        treatment = character(),  -->
<!--                        coef_val = character(),  -->
<!--                        stringsAsFactors = FALSE) -->

<!--   # Loop through each variable and run logistic regression -->
<!--   for (v_name in var_vec) { -->
<!--     # Fit logistic regression with clustered standard errors -->
<!--     reg <- glm(as.formula(paste0(treat_var, " ~ ", "`", v_name,"`" ," + strata")),  -->
<!--                family = binomial,  -->
<!--                data = df_curr2) -->

<!--     # Calculate p-value and add significance stars -->
<!--     coef_val <- round(coeftest(reg, vcovCL(reg, cluster = df_curr2$village))[2, 1], 3) -->
<!--     pval <- round(coeftest(reg, vcovCL(reg, cluster = df_curr2$village))[2, 4], 3) -->

<!--     # Add significance stars based on p-value thresholds -->
<!--     if (pval < 0.01) { -->
<!--       coef_val <- paste0(as.character(pval), "***") -->
<!--     } else if (pval < 0.05) { -->
<!--       coef_val <- paste0(as.character(pval), "**") -->
<!--     } else if (pval < 0.1) { -->
<!--       coef_val <- paste0(as.character(pval), "*") -->
<!--     }else { -->
<!--        coef_val <- as.character(pval) -->
<!--     } -->

<!--     df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name,  -->
<!--                                         treatment = treat_var,  -->
<!--                                         coef_val = coef_val,  -->
<!--                                         stringsAsFactors = FALSE)) -->
<!--   } -->

<!--   return(df_coef_value) -->
<!-- }) -->

<!-- # Reshape p-value table to wide format with treatment comparisons as columns -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   pivot_wider(id_cols = "variable",  -->
<!--               names_from = "treatment",  -->
<!--               values_from = "coef_val")  -->

<!-- # Rename columns to show treatment group comparisons -->
<!-- names(balance_tab_2) <- c("variable","(1)-(2)") -->

<!-- #Keep the variables of interest -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   select("(1)-(2)") -->

<!-- # Create table for joint F-tests -->

<!-- # For each variable, run joint F-test of treatment effects -->


<!-- myfooter <- df_curr2 %>%  -->
<!--   dplyr::select(het_ctrl_earn_index,cluster, strata) %>%   -->
<!--   group_by(het_ctrl_earn_index) %>%  -->
<!--   summarise(nbr_cluster = n_distinct(cluster), -->
<!--             nbr_strata = n_distinct(strata)) %>%  -->
<!--   column_to_rownames(var="het_ctrl_earn_index") -->

<!-- #transpose data frame -->
<!-- myfooter_t <- as.data.frame(t(myfooter)) -->

<!-- #redefine row and column names -->
<!-- rownames(myfooter_t) <- colnames(myfooter) -->
<!-- colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[seq(6,7,1)] -->

<!-- myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>% -->
<!--   mutate(Variable=dplyr::recode(Variable, nbr_cluster = "N cluster", nbr_strata = "N strata")) -->


<!-- balance_tab = cbind( -->
<!--   balance_tab_1, -->
<!--   balance_tab_2)  -->

<!-- # Adding the row on the nbr of cluster and strata -->
<!-- balance_tab <- plyr::rbind.fill(balance_tab,myfooter_t) -->

<!-- header <- str_squish(str_remove("Table : Balance Table ", "\n")) -->
<!-- # Set Table footer -->
<!-- footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level level. Fixed effects using randomization strata are included in all estimation regressions. The joint F-test shows the p-value from a test of equality of treatment arms. While the pooled F-test shows the p-value from a test of pooled treatment (i.e., a regression with a dummy for any treatment arm). *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n")) -->
<!-- # Set custom_tab() defaults -->
<!-- customtab_defaults() -->
<!-- custom_tab(balance_tab, header, footer) -->

<!-- ``` -->

<!-- ###### With ben. is hh. head -->

<!-- ```{r} -->


<!-- df_curr2 <- followup_MRT_hh  %>% -->
<!--   filter(reg_hh_pi_mrt == 1) %>%  -->
<!--       mutate(treatment_pool_bin = as.numeric(ifelse(treatment_pi_pool=="Pool" & reg_hh_pi_mrt==1, 1, 0)), -->
<!--       treatment_csh_trnsfr_bin = as.numeric(ifelse(treatment_pi_pool =="Control" & reg_hh_pi_mrt==1, 1,0)), -->
<!--       treatment_capital_bin = as.numeric(ifelse(treatment_pi=="Capital" & reg_hh_pi_mrt==1, 1, 0)), -->
<!--       treatment_psychosocial_bin = as.numeric(ifelse(treatment_pi=="Psychosocial" & reg_hh_pi_mrt==1, 1, 0)), -->
<!--       treatment_full_bin = as.numeric(ifelse(treatment_pi=="Full" & reg_hh_pi_mrt==1, 1, 0))) %>%  -->
<!--   filter(same_cb_bl==1) -->


<!-- df_curr2 <- df_curr2 %>%  -->
<!--   mutate(region = ifelse(region_bl==2, 0, 1), -->
<!--          rev_sum_bohh = as.numeric(rev_sum_ben_wemp_98_tr_bl), -->
<!--          tot_hh_rev = as.numeric(tot_hh_rev12_98_ppp_bl), -->
<!--          consum = as.numeric(consum_2_day_eq_ppp_tr_bl), -->
<!--          het_ctrl_earn_index = as.numeric(het_ctrl_earn_index), -->
<!--          het_ctrl_hh_index = as.numeric(het_ctrl_hh_index), -->
<!--          het_intrahh_index = as.numeric(het_intrahh_index), -->
<!--          het_age_gap = as.numeric(het_age_gap)) %>%  -->
<!--   mutate(het_ctrl_earn_index = ifelse(het_ctrl_earn_index==1, 0, 1), -->
<!--          het_ctrl_hh_index = ifelse(het_ctrl_hh_index==1, 0, 1), -->
<!--          het_intrahh_index = ifelse(het_intrahh_index==1, 0, 1), -->
<!--          het_age_gap = ifelse(het_age_gap==1, 0, 1)) -->


<!-- # Convert cash transfer treatment to factor -->
<!-- df_curr2$het_ctrl_earn_index <- factor(df_curr2$het_ctrl_earn_index, levels = c("0", "1"), labels = c("(1) \n Below Med.", "(2) \n Above Med."))  -->
<!-- df_curr2$het_ctrl_earn_index <- relevel(df_curr2$het_ctrl_earn_index, ref = "(1) \n Below Med.") # Set the reference var. -->


<!-- # Convert all variables in var_vec to numeric type -->
<!-- df_curr2 <- df_curr2  %>%  -->
<!--   dplyr::mutate(across(var_vec, as.numeric))  -->
<!-- # Create a tibble mapping variable names to their labels -->
<!-- description = tibble( -->
<!--   name = var_vec, -->
<!--   label = label_vec -->
<!-- ) -->

<!-- # Create a named list of variable labels -->
<!-- var_labels <- setNames(as.list(description$label), description$name) -->

<!-- # Apply the variable labels to the dataset -->
<!-- df_curr2 <- df_curr2 %>% -->
<!--   set_variable_labels(.labels = var_labels, .strict = FALSE) -->

<!-- # Create summary statistics table grouped by treatment -->
<!-- balance_tab_1 = df_curr2 %>%  -->
<!--   dplyr::select(het_ctrl_earn_index,var_vec) %>%   -->
<!--   tbl_summary(by = het_ctrl_earn_index, -->
<!--               type = (list=var_vec ~ "continuous"), -->
<!--               statistic = list(all_continuous() ~ "{mean}({sd})"), -->
<!--               digits = everything() ~ c(2,2),  -->
<!--               missing = "no") %>%  -->
<!--   modify_header(label = 'Variable') -->

<!-- # Create vector of treatment binary comparison variables -->
<!-- lst_treatment_bin=paste("het_ctrl_earn_index") -->

<!-- # Calculate p-values for each treatment comparison and variable -->
<!-- balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) { -->
<!--   df_coef_value <- data.frame(variable = character(),  -->
<!--                        treatment = character(),  -->
<!--                        coef_val = character(),  -->
<!--                        stringsAsFactors = FALSE) -->

<!--   # Loop through each variable and run logistic regression -->
<!--   for (v_name in var_vec) { -->
<!--     # Fit logistic regression with clustered standard errors -->
<!--     reg <- glm(as.formula(paste0(treat_var, " ~ ", "`", v_name,"`" ," + strata")),  -->
<!--                family = binomial,  -->
<!--                data = df_curr2) -->

<!--     # Calculate p-value and add significance stars -->
<!--     coef_val <- round(coeftest(reg, vcovCL(reg, cluster = df_curr2$village))[2, 1], 3) -->
<!--     pval <- round(coeftest(reg, vcovCL(reg, cluster = df_curr2$village))[2, 4], 3) -->

<!--     # Add significance stars based on p-value thresholds -->
<!--     if (pval < 0.01) { -->
<!--       coef_val <- paste0(as.character(pval), "***") -->
<!--     } else if (pval < 0.05) { -->
<!--       coef_val <- paste0(as.character(pval), "**") -->
<!--     } else if (pval < 0.1) { -->
<!--       coef_val <- paste0(as.character(pval), "*") -->
<!--     }else { -->
<!--        coef_val <- as.character(pval) -->
<!--     } -->

<!--     df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name,  -->
<!--                                         treatment = treat_var,  -->
<!--                                         coef_val = coef_val,  -->
<!--                                         stringsAsFactors = FALSE)) -->
<!--   } -->

<!--   return(df_coef_value) -->
<!-- }) -->

<!-- # Reshape p-value table to wide format with treatment comparisons as columns -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   pivot_wider(id_cols = "variable",  -->
<!--               names_from = "treatment",  -->
<!--               values_from = "coef_val")  -->

<!-- # Rename columns to show treatment group comparisons -->
<!-- names(balance_tab_2) <- c("variable","(1)-(2)") -->

<!-- #Keep the variables of interest -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   select("(1)-(2)") -->

<!-- # Create table for joint F-tests -->

<!-- # For each variable, run joint F-test of treatment effects -->


<!-- myfooter <- df_curr2 %>%  -->
<!--   dplyr::select(het_ctrl_earn_index,cluster, strata) %>%   -->
<!--   group_by(het_ctrl_earn_index) %>%  -->
<!--   summarise(nbr_cluster = n_distinct(cluster), -->
<!--             nbr_strata = n_distinct(strata)) %>%  -->
<!--   column_to_rownames(var="het_ctrl_earn_index") -->

<!-- #transpose data frame -->
<!-- myfooter_t <- as.data.frame(t(myfooter)) -->

<!-- #redefine row and column names -->
<!-- rownames(myfooter_t) <- colnames(myfooter) -->
<!-- colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[seq(6,7,1)] -->

<!-- myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>% -->
<!--   mutate(Variable=dplyr::recode(Variable, nbr_cluster = "N cluster", nbr_strata = "N strata")) -->


<!-- balance_tab = cbind( -->
<!--   balance_tab_1, -->
<!--   balance_tab_2)  -->

<!-- # Adding the row on the nbr of cluster and strata -->
<!-- balance_tab <- plyr::rbind.fill(balance_tab,myfooter_t) -->

<!-- header <- str_squish(str_remove("Table : Balance Table ", "\n")) -->
<!-- # Set Table footer -->
<!-- footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level level. Fixed effects using randomization strata are included in all estimation regressions. The joint F-test shows the p-value from a test of equality of treatment arms. While the pooled F-test shows the p-value from a test of pooled treatment (i.e., a regression with a dummy for any treatment arm). *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n")) -->
<!-- # Set custom_tab() defaults -->
<!-- customtab_defaults() -->
<!-- custom_tab(balance_tab, header, footer) -->

<!-- ``` -->

<!-- ##### Control over hh. ressources -->
<!-- ###### All -->
<!-- ```{r} -->


<!-- df_curr2 <- followup_MRT_hh  %>% -->
<!--   filter(reg_hh_pi_mrt == 1) %>%  -->
<!--       mutate(treatment_pool_bin = as.numeric(ifelse(treatment_pi_pool=="Pool" & reg_hh_pi_mrt==1, 1, 0)), -->
<!--       treatment_csh_trnsfr_bin = as.numeric(ifelse(treatment_pi_pool =="Control" & reg_hh_pi_mrt==1, 1,0)), -->
<!--       treatment_capital_bin = as.numeric(ifelse(treatment_pi=="Capital" & reg_hh_pi_mrt==1, 1, 0)), -->
<!--       treatment_psychosocial_bin = as.numeric(ifelse(treatment_pi=="Psychosocial" & reg_hh_pi_mrt==1, 1, 0)), -->
<!--       treatment_full_bin = as.numeric(ifelse(treatment_pi=="Full" & reg_hh_pi_mrt==1, 1, 0))) -->


<!-- df_curr2 <- df_curr2 %>%  -->
<!--   mutate(region = ifelse(region_bl==2, 0, 1), -->
<!--          rev_sum_bohh = as.numeric(rev_sum_ben_wemp_98_tr_bl), -->
<!--          tot_hh_rev = as.numeric(tot_hh_rev12_98_ppp_bl), -->
<!--          consum = as.numeric(consum_2_day_eq_ppp_tr_bl), -->
<!--          het_ctrl_earn_index = as.numeric(het_ctrl_earn_index), -->
<!--          het_ctrl_hh_index = as.numeric(het_ctrl_hh_index), -->
<!--          het_intrahh_index = as.numeric(het_intrahh_index), -->
<!--          het_age_gap = as.numeric(het_age_gap)) %>%  -->
<!--   mutate(het_ctrl_earn_index = ifelse(het_ctrl_earn_index==1, 0, 1), -->
<!--          het_ctrl_hh_index = ifelse(het_ctrl_hh_index==1, 0, 1), -->
<!--          het_intrahh_index = ifelse(het_intrahh_index==1, 0, 1), -->
<!--          het_age_gap = ifelse(het_age_gap==1, 0, 1)) -->


<!-- # Convert cash transfer treatment to factor -->
<!-- df_curr2$het_ctrl_hh_index <- factor(df_curr2$het_ctrl_hh_index, levels = c("0", "1"), labels = c("(1) \n Below Med.", "(2) \n Above Med."))  -->
<!-- df_curr2$het_ctrl_hh_index <- relevel(df_curr2$het_ctrl_hh_index, ref = "(1) \n Below Med.") # Set the reference var. -->


<!-- # Convert all variables in var_vec to numeric type -->
<!-- df_curr2 <- df_curr2  %>%  -->
<!--   dplyr::mutate(across(var_vec, as.numeric))  -->
<!-- # Create a tibble mapping variable names to their labels -->
<!-- description = tibble( -->
<!--   name = var_vec, -->
<!--   label = label_vec -->
<!-- ) -->

<!-- # Create a named list of variable labels -->
<!-- var_labels <- setNames(as.list(description$label), description$name) -->

<!-- # Apply the variable labels to the dataset -->
<!-- df_curr2 <- df_curr2 %>% -->
<!--   set_variable_labels(.labels = var_labels, .strict = FALSE) -->

<!-- # Create summary statistics table grouped by treatment -->
<!-- balance_tab_1 = df_curr2 %>%  -->
<!--   dplyr::select(het_ctrl_hh_index,var_vec) %>%   -->
<!--   tbl_summary(by = het_ctrl_hh_index, -->
<!--               type = (list=var_vec ~ "continuous"), -->
<!--               statistic = list(all_continuous() ~ "{mean}({sd})"), -->
<!--               digits = everything() ~ c(2,2),  -->
<!--               missing = "no") %>%  -->
<!--   modify_header(label = 'Variable') -->

<!-- # Create vector of treatment binary comparison variables -->
<!-- lst_treatment_bin=paste("het_ctrl_hh_index") -->

<!-- # Calculate p-values for each treatment comparison and variable -->
<!-- balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) { -->
<!--   df_coef_value <- data.frame(variable = character(),  -->
<!--                        treatment = character(),  -->
<!--                        coef_val = character(),  -->
<!--                        stringsAsFactors = FALSE) -->

<!--   # Loop through each variable and run logistic regression -->
<!--   for (v_name in var_vec) { -->
<!--     # Fit logistic regression with clustered standard errors -->
<!--     reg <- glm(as.formula(paste0(treat_var, " ~ ", "`", v_name,"`" ," + strata")),  -->
<!--                family = binomial,  -->
<!--                data = df_curr2) -->

<!--     # Calculate p-value and add significance stars -->
<!--     coef_val <- round(coeftest(reg, vcovCL(reg, cluster = df_curr2$village))[2, 1], 3) -->
<!--     pval <- round(coeftest(reg, vcovCL(reg, cluster = df_curr2$village))[2, 4], 3) -->

<!--     # Add significance stars based on p-value thresholds -->
<!--     if (pval < 0.01) { -->
<!--       coef_val <- paste0(as.character(coef_val), "***") -->
<!--     } else if (pval < 0.05) { -->
<!--       coef_val <- paste0(as.character(coef_val), "**") -->
<!--     } else if (pval < 0.1) { -->
<!--       coef_val <- paste0(as.character(coef_val), "*") -->
<!--     }else { -->
<!--        coef_val <- as.character(coef_val) -->
<!--     } -->

<!--     df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name,  -->
<!--                                         treatment = treat_var,  -->
<!--                                         coef_val = coef_val,  -->
<!--                                         stringsAsFactors = FALSE)) -->
<!--   } -->

<!--   return(df_coef_value) -->
<!-- }) -->

<!-- # Reshape p-value table to wide format with treatment comparisons as columns -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   pivot_wider(id_cols = "variable",  -->
<!--               names_from = "treatment",  -->
<!--               values_from = "coef_val")  -->

<!-- # Rename columns to show treatment group comparisons -->
<!-- names(balance_tab_2) <- c("variable","(1)-(2)") -->

<!-- #Keep the variables of interest -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   select("(1)-(2)") -->

<!-- # Create table for joint F-tests -->

<!-- # For each variable, run joint F-test of treatment effects -->


<!-- myfooter <- df_curr2 %>%  -->
<!--   dplyr::select(het_ctrl_hh_index,cluster, strata) %>%   -->
<!--   group_by(het_ctrl_hh_index) %>%  -->
<!--   summarise(nbr_cluster = n_distinct(cluster), -->
<!--             nbr_strata = n_distinct(strata)) %>%  -->
<!--   drop_na() %>%  -->
<!--   column_to_rownames(var="het_ctrl_hh_index") -->

<!-- #transpose data frame -->
<!-- myfooter_t <- as.data.frame(t(myfooter)) -->

<!-- #redefine row and column names -->
<!-- rownames(myfooter_t) <- colnames(myfooter) -->
<!-- colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[seq(6,7,1)] -->

<!-- myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>% -->
<!--   mutate(Variable=dplyr::recode(Variable, nbr_cluster = "N cluster", nbr_strata = "N strata")) -->


<!-- balance_tab = cbind( -->
<!--   balance_tab_1, -->
<!--   balance_tab_2)  -->

<!-- # Adding the row on the nbr of cluster and strata -->
<!-- balance_tab <- plyr::rbind.fill(balance_tab,myfooter_t) -->

<!-- header <- str_squish(str_remove("Table : Balance Table ", "\n")) -->
<!-- # Set Table footer -->
<!-- footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level level. Fixed effects using randomization strata are included in all estimation regressions. The joint F-test shows the p-value from a test of equality of treatment arms. While the pooled F-test shows the p-value from a test of pooled treatment (i.e., a regression with a dummy for any treatment arm). *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n")) -->
<!-- # Set custom_tab() defaults -->
<!-- customtab_defaults() -->
<!-- custom_tab(balance_tab, header, footer) -->

<!-- ``` -->

<!-- ###### With ben. is hh. head -->

<!-- ```{r} -->


<!-- df_curr2 <- followup_MRT_hh  %>% -->
<!--   filter(reg_hh_pi_mrt == 1) %>%  -->
<!--       mutate(treatment_pool_bin = as.numeric(ifelse(treatment_pi_pool=="Pool" & reg_hh_pi_mrt==1, 1, 0)), -->
<!--       treatment_csh_trnsfr_bin = as.numeric(ifelse(treatment_pi_pool =="Control" & reg_hh_pi_mrt==1, 1,0)), -->
<!--       treatment_capital_bin = as.numeric(ifelse(treatment_pi=="Capital" & reg_hh_pi_mrt==1, 1, 0)), -->
<!--       treatment_psychosocial_bin = as.numeric(ifelse(treatment_pi=="Psychosocial" & reg_hh_pi_mrt==1, 1, 0)), -->
<!--       treatment_full_bin = as.numeric(ifelse(treatment_pi=="Full" & reg_hh_pi_mrt==1, 1, 0)))%>%  -->
<!--   filter(same_cb_bl==1) -->


<!-- df_curr2 <- df_curr2 %>%  -->
<!--   mutate(region = ifelse(region_bl==2, 0, 1), -->
<!--          rev_sum_bohh = as.numeric(rev_sum_ben_wemp_98_tr_bl), -->
<!--          tot_hh_rev = as.numeric(tot_hh_rev12_98_ppp_bl), -->
<!--          consum = as.numeric(consum_2_day_eq_ppp_tr_bl), -->
<!--          het_ctrl_earn_index = as.numeric(het_ctrl_earn_index), -->
<!--          het_ctrl_hh_index = as.numeric(het_ctrl_hh_index), -->
<!--          het_intrahh_index = as.numeric(het_intrahh_index), -->
<!--          het_age_gap = as.numeric(het_age_gap)) %>%  -->
<!--   mutate(het_ctrl_earn_index = ifelse(het_ctrl_earn_index==1, 0, 1), -->
<!--          het_ctrl_hh_index = ifelse(het_ctrl_hh_index==1, 0, 1), -->
<!--          het_intrahh_index = ifelse(het_intrahh_index==1, 0, 1), -->
<!--          het_age_gap = ifelse(het_age_gap==1, 0, 1)) -->


<!-- # Convert cash transfer treatment to factor -->
<!-- df_curr2$het_ctrl_hh_index <- factor(df_curr2$het_ctrl_hh_index, levels = c("0", "1"), labels = c("(1) \n Below Med.", "(2) \n Above Med."))  -->
<!-- df_curr2$het_ctrl_hh_index <- relevel(df_curr2$het_ctrl_hh_index, ref = "(1) \n Below Med.") # Set the reference var. -->


<!-- # Convert all variables in var_vec to numeric type -->
<!-- df_curr2 <- df_curr2  %>%  -->
<!--   dplyr::mutate(across(var_vec, as.numeric))  -->
<!-- # Create a tibble mapping variable names to their labels -->
<!-- description = tibble( -->
<!--   name = var_vec, -->
<!--   label = label_vec -->
<!-- ) -->

<!-- # Create a named list of variable labels -->
<!-- var_labels <- setNames(as.list(description$label), description$name) -->

<!-- # Apply the variable labels to the dataset -->
<!-- df_curr2 <- df_curr2 %>% -->
<!--   set_variable_labels(.labels = var_labels, .strict = FALSE) -->

<!-- # Create summary statistics table grouped by treatment -->
<!-- balance_tab_1 = df_curr2 %>%  -->
<!--   dplyr::select(het_ctrl_hh_index,var_vec) %>%   -->
<!--   tbl_summary(by = het_ctrl_hh_index, -->
<!--               type = (list=var_vec ~ "continuous"), -->
<!--               statistic = list(all_continuous() ~ "{mean}({sd})"), -->
<!--               digits = everything() ~ c(2,2),  -->
<!--               missing = "no") %>%  -->
<!--   modify_header(label = 'Variable') -->

<!-- # Create vector of treatment binary comparison variables -->
<!-- lst_treatment_bin=paste("het_ctrl_hh_index") -->

<!-- # Calculate p-values for each treatment comparison and variable -->
<!-- balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) { -->
<!--   df_coef_value <- data.frame(variable = character(),  -->
<!--                        treatment = character(),  -->
<!--                        coef_val = character(),  -->
<!--                        stringsAsFactors = FALSE) -->

<!--   # Loop through each variable and run logistic regression -->
<!--   for (v_name in var_vec) { -->
<!--     # Fit logistic regression with clustered standard errors -->
<!--     reg <- glm(as.formula(paste0(treat_var, " ~ ", "`", v_name,"`" ," + strata")),  -->
<!--                family = binomial,  -->
<!--                data = df_curr2) -->

<!--     # Calculate p-value and add significance stars -->
<!--     coef_val <- round(coeftest(reg, vcovCL(reg, cluster = df_curr2$village))[2, 1], 3) -->
<!--     pval <- round(coeftest(reg, vcovCL(reg, cluster = df_curr2$village))[2, 4], 3) -->

<!--     # Add significance stars based on p-value thresholds -->
<!--     if (pval < 0.01) { -->
<!--       coef_val <- paste0(as.character(pval), "***") -->
<!--     } else if (pval < 0.05) { -->
<!--       coef_val <- paste0(as.character(pval), "**") -->
<!--     } else if (pval < 0.1) { -->
<!--       coef_val <- paste0(as.character(pval), "*") -->
<!--     }else { -->
<!--        coef_val <- as.character(pval) -->
<!--     } -->

<!--     df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name,  -->
<!--                                         treatment = treat_var,  -->
<!--                                         coef_val = coef_val,  -->
<!--                                         stringsAsFactors = FALSE)) -->
<!--   } -->

<!--   return(df_coef_value) -->
<!-- }) -->

<!-- # Reshape p-value table to wide format with treatment comparisons as columns -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   pivot_wider(id_cols = "variable",  -->
<!--               names_from = "treatment",  -->
<!--               values_from = "coef_val")  -->

<!-- # Rename columns to show treatment group comparisons -->
<!-- names(balance_tab_2) <- c("variable","(1)-(2)") -->

<!-- #Keep the variables of interest -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   select("(1)-(2)") -->

<!-- # Create table for joint F-tests -->

<!-- # For each variable, run joint F-test of treatment effects -->


<!-- myfooter <- df_curr2 %>%  -->
<!--   dplyr::select(het_ctrl_hh_index,cluster, strata) %>%   -->
<!--   group_by(het_ctrl_hh_index) %>%  -->
<!--   summarise(nbr_cluster = n_distinct(cluster), -->
<!--             nbr_strata = n_distinct(strata)) %>%  -->
<!--   drop_na() %>%  -->
<!--   column_to_rownames(var="het_ctrl_hh_index") -->

<!-- #transpose data frame -->
<!-- myfooter_t <- as.data.frame(t(myfooter)) -->

<!-- #redefine row and column names -->
<!-- rownames(myfooter_t) <- colnames(myfooter) -->
<!-- colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[seq(6,7,1)] -->

<!-- myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>% -->
<!--   mutate(Variable=dplyr::recode(Variable, nbr_cluster = "N cluster", nbr_strata = "N strata")) -->


<!-- balance_tab = cbind( -->
<!--   balance_tab_1, -->
<!--   balance_tab_2)  -->

<!-- # Adding the row on the nbr of cluster and strata -->
<!-- balance_tab <- plyr::rbind.fill(balance_tab,myfooter_t) -->

<!-- header <- str_squish(str_remove("Table : Balance Table ", "\n")) -->
<!-- # Set Table footer -->
<!-- footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level level. Fixed effects using randomization strata are included in all estimation regressions. The joint F-test shows the p-value from a test of equality of treatment arms. While the pooled F-test shows the p-value from a test of pooled treatment (i.e., a regression with a dummy for any treatment arm). *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n")) -->
<!-- # Set custom_tab() defaults -->
<!-- customtab_defaults() -->
<!-- custom_tab(balance_tab, header, footer) -->

<!-- ``` -->
<!-- ##### Intrahh dynamics -->

<!-- ###### All -->


<!-- ```{r} -->


<!-- df_curr2 <- followup_MRT_hh  %>% -->
<!--   filter(reg_hh_pi_mrt == 1) %>%  -->
<!--       mutate(treatment_pool_bin = as.numeric(ifelse(treatment_pi_pool=="Pool" & reg_hh_pi_mrt==1, 1, 0)), -->
<!--       treatment_csh_trnsfr_bin = as.numeric(ifelse(treatment_pi_pool =="Control" & reg_hh_pi_mrt==1, 1,0)), -->
<!--       treatment_capital_bin = as.numeric(ifelse(treatment_pi=="Capital" & reg_hh_pi_mrt==1, 1, 0)), -->
<!--       treatment_psychosocial_bin = as.numeric(ifelse(treatment_pi=="Psychosocial" & reg_hh_pi_mrt==1, 1, 0)), -->
<!--       treatment_full_bin = as.numeric(ifelse(treatment_pi=="Full" & reg_hh_pi_mrt==1, 1, 0))) -->


<!-- df_curr2 <- df_curr2 %>%  -->
<!--   mutate(region = ifelse(region_bl==2, 0, 1), -->
<!--          rev_sum_bohh = as.numeric(rev_sum_ben_wemp_98_tr_bl), -->
<!--          tot_hh_rev = as.numeric(tot_hh_rev12_98_ppp_bl), -->
<!--          consum = as.numeric(consum_2_day_eq_ppp_tr_bl), -->
<!--          het_ctrl_earn_index = as.numeric(het_ctrl_earn_index), -->
<!--          het_ctrl_hh_index = as.numeric(het_ctrl_hh_index), -->
<!--          het_intrahh_index = as.numeric(het_intrahh_index), -->
<!--          het_age_gap = as.numeric(het_age_gap)) %>%  -->
<!--   mutate(het_ctrl_earn_index = ifelse(het_ctrl_earn_index==1, 0, 1), -->
<!--          het_ctrl_hh_index = ifelse(het_ctrl_hh_index==1, 0, 1), -->
<!--          het_intrahh_index = ifelse(het_intrahh_index==1, 0, 1), -->
<!--          het_age_gap = ifelse(het_age_gap==1, 0, 1)) -->


<!-- # Convert cash transfer treatment to factor -->
<!-- df_curr2$het_intrahh_index <- factor(df_curr2$het_intrahh_index, levels = c("0", "1"), labels = c("(1) \n Below Med.", "(2) \n Above Med."))  -->
<!-- df_curr2$het_intrahh_index <- relevel(df_curr2$het_intrahh_index, ref = "(1) \n Below Med.") # Set the reference var. -->


<!-- # Convert all variables in var_vec to numeric type -->
<!-- df_curr2 <- df_curr2  %>%  -->
<!--   dplyr::mutate(across(var_vec, as.numeric))  -->
<!-- # Create a tibble mapping variable names to their labels -->
<!-- description = tibble( -->
<!--   name = var_vec, -->
<!--   label = label_vec -->
<!-- ) -->

<!-- # Create a named list of variable labels -->
<!-- var_labels <- setNames(as.list(description$label), description$name) -->

<!-- # Apply the variable labels to the dataset -->
<!-- df_curr2 <- df_curr2 %>% -->
<!--   set_variable_labels(.labels = var_labels, .strict = FALSE) -->

<!-- # Create summary statistics table grouped by treatment -->
<!-- balance_tab_1 = df_curr2 %>%  -->
<!--   dplyr::select(het_intrahh_index,var_vec) %>%   -->
<!--   tbl_summary(by = het_intrahh_index, -->
<!--               type = (list=var_vec ~ "continuous"), -->
<!--               statistic = list(all_continuous() ~ "{mean}({sd})"), -->
<!--               digits = everything() ~ c(2,2),  -->
<!--               missing = "no") %>%  -->
<!--   modify_header(label = 'Variable') -->

<!-- # Create vector of treatment binary comparison variables -->
<!-- lst_treatment_bin=paste("het_intrahh_index") -->

<!-- # Calculate p-values for each treatment comparison and variable -->
<!-- balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) { -->
<!--   df_coef_value <- data.frame(variable = character(),  -->
<!--                        treatment = character(),  -->
<!--                        coef_val = character(),  -->
<!--                        stringsAsFactors = FALSE) -->

<!--   # Loop through each variable and run logistic regression -->
<!--   for (v_name in var_vec) { -->
<!--     # Fit logistic regression with clustered standard errors -->
<!--     reg <- glm(as.formula(paste0(treat_var, " ~ ", "`", v_name,"`" ," + strata")),  -->
<!--                family = binomial,  -->
<!--                data = df_curr2) -->

<!--     # Calculate p-value and add significance stars -->
<!--     coef_val <- round(coeftest(reg, vcovCL(reg, cluster = df_curr2$village))[2, 1], 3) -->
<!--     pval <- round(coeftest(reg, vcovCL(reg, cluster = df_curr2$village))[2, 4], 3) -->

<!--     # Add significance stars based on p-value thresholds -->
<!--     if (pval < 0.01) { -->
<!--       coef_val <- paste0(as.character(pval), "***") -->
<!--     } else if (pval < 0.05) { -->
<!--       coef_val <- paste0(as.character(pval), "**") -->
<!--     } else if (pval < 0.1) { -->
<!--       coef_val <- paste0(as.character(pval), "*") -->
<!--     }else { -->
<!--        coef_val <- as.character(pval) -->
<!--     } -->

<!--     df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name,  -->
<!--                                         treatment = treat_var,  -->
<!--                                         coef_val = coef_val,  -->
<!--                                         stringsAsFactors = FALSE)) -->
<!--   } -->

<!--   return(df_coef_value) -->
<!-- }) -->

<!-- # Reshape p-value table to wide format with treatment comparisons as columns -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   pivot_wider(id_cols = "variable",  -->
<!--               names_from = "treatment",  -->
<!--               values_from = "coef_val")  -->

<!-- # Rename columns to show treatment group comparisons -->
<!-- names(balance_tab_2) <- c("variable","(1)-(2)") -->

<!-- #Keep the variables of interest -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   select("(1)-(2)") -->

<!-- # Create table for joint F-tests -->

<!-- # For each variable, run joint F-test of treatment effects -->


<!-- myfooter <- df_curr2 %>%  -->
<!--   dplyr::select(het_intrahh_index,cluster, strata) %>%   -->
<!--   group_by(het_intrahh_index) %>%  -->
<!--   summarise(nbr_cluster = n_distinct(cluster), -->
<!--             nbr_strata = n_distinct(strata)) %>%  -->
<!--   column_to_rownames(var="het_intrahh_index") -->

<!-- #transpose data frame -->
<!-- myfooter_t <- as.data.frame(t(myfooter)) -->

<!-- #redefine row and column names -->
<!-- rownames(myfooter_t) <- colnames(myfooter) -->
<!-- colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[seq(6,7,1)] -->

<!-- myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>% -->
<!--   mutate(Variable=dplyr::recode(Variable, nbr_cluster = "N cluster", nbr_strata = "N strata")) -->


<!-- balance_tab = cbind( -->
<!--   balance_tab_1, -->
<!--   balance_tab_2)  -->

<!-- # Adding the row on the nbr of cluster and strata -->
<!-- balance_tab <- plyr::rbind.fill(balance_tab,myfooter_t) -->

<!-- header <- str_squish(str_remove("Table : Balance Table ", "\n")) -->
<!-- # Set Table footer -->
<!-- footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level level. Fixed effects using randomization strata are included in all estimation regressions. The joint F-test shows the p-value from a test of equality of treatment arms. While the pooled F-test shows the p-value from a test of pooled treatment (i.e., a regression with a dummy for any treatment arm). *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n")) -->
<!-- # Set custom_tab() defaults -->
<!-- customtab_defaults() -->
<!-- custom_tab(balance_tab, header, footer) -->

<!-- ``` -->


<!-- ###### With ben. is hh. head -->


<!-- ```{r} -->


<!-- df_curr2 <- followup_MRT_hh  %>% -->
<!--   filter(reg_hh_pi_mrt == 1) %>%  -->
<!--       mutate(treatment_pool_bin = as.numeric(ifelse(treatment_pi_pool=="Pool" & reg_hh_pi_mrt==1, 1, 0)), -->
<!--       treatment_csh_trnsfr_bin = as.numeric(ifelse(treatment_pi_pool =="Control" & reg_hh_pi_mrt==1, 1,0)), -->
<!--       treatment_capital_bin = as.numeric(ifelse(treatment_pi=="Capital" & reg_hh_pi_mrt==1, 1, 0)), -->
<!--       treatment_psychosocial_bin = as.numeric(ifelse(treatment_pi=="Psychosocial" & reg_hh_pi_mrt==1, 1, 0)), -->
<!--       treatment_full_bin = as.numeric(ifelse(treatment_pi=="Full" & reg_hh_pi_mrt==1, 1, 0)))%>%  -->
<!--   filter(same_cb_bl==1) -->


<!-- df_curr2 <- df_curr2 %>%  -->
<!--   mutate(region = ifelse(region_bl==2, 0, 1), -->
<!--          rev_sum_bohh = as.numeric(rev_sum_ben_wemp_98_tr_bl), -->
<!--          tot_hh_rev = as.numeric(tot_hh_rev12_98_ppp_bl), -->
<!--          consum = as.numeric(consum_2_day_eq_ppp_tr_bl), -->
<!--          het_ctrl_earn_index = as.numeric(het_ctrl_earn_index), -->
<!--          het_ctrl_hh_index = as.numeric(het_ctrl_hh_index), -->
<!--          het_intrahh_index = as.numeric(het_intrahh_index), -->
<!--          het_age_gap = as.numeric(het_age_gap)) %>%  -->
<!--   mutate(het_ctrl_earn_index = ifelse(het_ctrl_earn_index==1, 0, 1), -->
<!--          het_ctrl_hh_index = ifelse(het_ctrl_hh_index==1, 0, 1), -->
<!--          het_intrahh_index = ifelse(het_intrahh_index==1, 0, 1), -->
<!--          het_age_gap = ifelse(het_age_gap==1, 0, 1)) -->


<!-- # Convert cash transfer treatment to factor -->
<!-- df_curr2$het_intrahh_index <- factor(df_curr2$het_intrahh_index, levels = c("0", "1"), labels = c("(1) \n Below Med.", "(2) \n Above Med."))  -->
<!-- df_curr2$het_intrahh_index <- relevel(df_curr2$het_intrahh_index, ref = "(1) \n Below Med.") # Set the reference var. -->


<!-- # Convert all variables in var_vec to numeric type -->
<!-- df_curr2 <- df_curr2  %>%  -->
<!--   dplyr::mutate(across(var_vec, as.numeric))  -->
<!-- # Create a tibble mapping variable names to their labels -->
<!-- description = tibble( -->
<!--   name = var_vec, -->
<!--   label = label_vec -->
<!-- ) -->

<!-- # Create a named list of variable labels -->
<!-- var_labels <- setNames(as.list(description$label), description$name) -->

<!-- # Apply the variable labels to the dataset -->
<!-- df_curr2 <- df_curr2 %>% -->
<!--   set_variable_labels(.labels = var_labels, .strict = FALSE) -->

<!-- # Create summary statistics table grouped by treatment -->
<!-- balance_tab_1 = df_curr2 %>%  -->
<!--   dplyr::select(het_intrahh_index,var_vec) %>%   -->
<!--   tbl_summary(by = het_intrahh_index, -->
<!--               type = (list=var_vec ~ "continuous"), -->
<!--               statistic = list(all_continuous() ~ "{mean}({sd})"), -->
<!--               digits = everything() ~ c(2,2),  -->
<!--               missing = "no") %>%  -->
<!--   modify_header(label = 'Variable') -->

<!-- # Create vector of treatment binary comparison variables -->
<!-- lst_treatment_bin=paste("het_intrahh_index") -->

<!-- # Calculate p-values for each treatment comparison and variable -->
<!-- balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) { -->
<!--   df_coef_value <- data.frame(variable = character(),  -->
<!--                        treatment = character(),  -->
<!--                        coef_val = character(),  -->
<!--                        stringsAsFactors = FALSE) -->

<!--   # Loop through each variable and run logistic regression -->
<!--   for (v_name in var_vec) { -->
<!--     # Fit logistic regression with clustered standard errors -->
<!--     reg <- glm(as.formula(paste0(treat_var, " ~ ", "`", v_name,"`" ," + strata")),  -->
<!--                family = binomial,  -->
<!--                data = df_curr2) -->

<!--     # Calculate p-value and add significance stars -->
<!--     coef_val <- round(coeftest(reg, vcovCL(reg, cluster = df_curr2$village))[2, 1], 3) -->
<!--     pval <- round(coeftest(reg, vcovCL(reg, cluster = df_curr2$village))[2, 4], 3) -->

<!--     # Add significance stars based on p-value thresholds -->
<!--     if (pval < 0.01) { -->
<!--       coef_val <- paste0(as.character(pval), "***") -->
<!--     } else if (pval < 0.05) { -->
<!--       coef_val <- paste0(as.character(pval), "**") -->
<!--     } else if (pval < 0.1) { -->
<!--       coef_val <- paste0(as.character(pval), "*") -->
<!--     }else { -->
<!--        coef_val <- as.character(pval) -->
<!--     } -->

<!--     df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name,  -->
<!--                                         treatment = treat_var,  -->
<!--                                         coef_val = coef_val,  -->
<!--                                         stringsAsFactors = FALSE)) -->
<!--   } -->

<!--   return(df_coef_value) -->
<!-- }) -->

<!-- # Reshape p-value table to wide format with treatment comparisons as columns -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   pivot_wider(id_cols = "variable",  -->
<!--               names_from = "treatment",  -->
<!--               values_from = "coef_val")  -->

<!-- # Rename columns to show treatment group comparisons -->
<!-- names(balance_tab_2) <- c("variable","(1)-(2)") -->

<!-- #Keep the variables of interest -->
<!-- balance_tab_2 <- balance_tab_2 %>%  -->
<!--   select("(1)-(2)") -->

<!-- # Create table for joint F-tests -->

<!-- # For each variable, run joint F-test of treatment effects -->


<!-- myfooter <- df_curr2 %>%  -->
<!--   dplyr::select(het_intrahh_index,cluster, strata) %>%   -->
<!--   group_by(het_intrahh_index) %>%  -->
<!--   summarise(nbr_cluster = n_distinct(cluster), -->
<!--             nbr_strata = n_distinct(strata)) %>%  -->
<!--   column_to_rownames(var="het_intrahh_index") -->

<!-- #transpose data frame -->
<!-- myfooter_t <- as.data.frame(t(myfooter)) -->

<!-- #redefine row and column names -->
<!-- rownames(myfooter_t) <- colnames(myfooter) -->
<!-- colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[seq(6,7,1)] -->

<!-- myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>% -->
<!--   mutate(Variable=dplyr::recode(Variable, nbr_cluster = "N cluster", nbr_strata = "N strata")) -->


<!-- balance_tab = cbind( -->
<!--   balance_tab_1, -->
<!--   balance_tab_2)  -->

<!-- # Adding the row on the nbr of cluster and strata -->
<!-- balance_tab <- plyr::rbind.fill(balance_tab,myfooter_t) -->

<!-- header <- str_squish(str_remove("Table : Balance Table ", "\n")) -->
<!-- # Set Table footer -->
<!-- footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level level. Fixed effects using randomization strata are included in all estimation regressions. The joint F-test shows the p-value from a test of equality of treatment arms. While the pooled F-test shows the p-value from a test of pooled treatment (i.e., a regression with a dummy for any treatment arm). *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n")) -->
<!-- # Set custom_tab() defaults -->
<!-- customtab_defaults() -->
<!-- custom_tab(balance_tab, header, footer) -->

<!-- ``` -->

\newpage

## Other household characteristics


### Beneficiary relationship to Partner

```{r}
followup_MRT_hh %>% 
  # Convert labeled factor to plain factor (remove value labels)
  mutate(pben_relation_bin = labelled::unlabelled(pben_relation_bl)) %>% 
  
  # Group data by beneficiary's relationship to Partner
  group_by(pben_relation_bin) %>% 
  
  # Count the number of observations per category
  summarise(Freq = n()) %>%
  
  # Calculate the proportion for each relationship category
  mutate(Prop = Freq / sum(Freq)) %>% 
  
  # Begin creating the bar plot
  ggplot(aes(x = pben_relation_bin, y = Prop, label = scales::percent(Prop))) +
  
  # Create bars with grey fill, black outline, and some transparency
  geom_col(fill = c("grey69"), color = "black", alpha = 0.7) +
  
  # Add plot labels and title
  labs(title = "Beneficiary relationship to partner", 
       x = "Relationship to partner", 
       y = "Density") +
  
  # Apply a light theme and customize text/legend appearance
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', 
        text = element_text(size = 8), 
        legend.direction = "horizontal",
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

# ------------------------------------------------------------------------------
# Save the plot as a PDF
# ------------------------------------------------------------------------------
ggsave("output/img/beneficiary relation with hhh.pdf", 
       width = 18, height = 10, units = "cm")
```

### Partner literacy

```{r}
followup_MRT_hh %>% 
  # Convert binary variable for Partner literacy into labeled factor
  mutate(hhh_lit_bin = factor(hhh_lit, levels = c("0", "1"),
                              labels = c("No", "Yes"))) %>% 
  
  # Group data by literacy status
  group_by(hhh_lit_bin) %>% 
  
  # Count observations per literacy group
  summarise(Freq = n()) %>%
  
  # Compute the proportion for each group
  mutate(Prop = Freq / sum(Freq)) %>% 
  
  # Start building the bar plot
  ggplot(aes(x = hhh_lit_bin, y = Prop, fill = hhh_lit_bin, 
             label = scales::percent(Prop))) +
  
  # Create bar chart using geom_col (manual proportions) with customized color
  geom_col(fill = c("grey69", "grey25"), color = "black", alpha = 0.7) +
  
  # Add proportion labels to bars
  geom_text(aes(label = scales::percent(Prop)), 
            position = position_stack(0.5)) +
  
  # Add chart title and axis/legend labels
  labs(title = "Partner literacy", 
       x = "", 
       y = "Proportion", 
       fill = "Partner is literate") +
  
  # Apply a light theme with smaller base font size
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', 
        text = element_text(size = 8), 
        legend.direction = "horizontal")

# ------------------------------------------------------------------------------
# Save the plot as a PDF
# ------------------------------------------------------------------------------
ggsave("output/img/Partner literacy.pdf", 
       width = 18, height = 10, units = "cm")

```


### Beneficiary literacy

```{r}
followup_MRT_hh %>% 
  # Convert binary indicator of beneficiary literacy into a labeled factor
  mutate(pben_lit_bin = factor(pben_lit, levels = c("0", "1"),
                               labels = c("No", "Yes"))) %>%
  
  # Group data by literacy status
  group_by(pben_lit_bin) %>%
  
  # Count the number of observations in each group
  summarise(Freq = n()) %>%
  
  # Calculate proportion for each group
  mutate(Prop = Freq / sum(Freq)) %>%
  
  # Begin creating the bar plot
  ggplot(aes(x = pben_lit_bin, y = Prop, fill = pben_lit_bin, 
             label = scales::percent(Prop))) +
  
  # Draw the bars with specified fill and appearance
  geom_col(fill = c("grey69", "grey25"), 
           color = "black", alpha = 0.7) +
  
  # Add percentage labels to the center of each bar
  geom_text(aes(label = scales::percent(Prop)), 
            position = position_stack(0.5)) +
  
  # Add plot title and axis/legend labels
  labs(title = "Beneficiary literacy", 
       x = "", 
       y = "Proportion", 
       fill = "Beneficiary is literate") +
  
  # Apply a clean, light theme
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', 
        text = element_text(size = 8), 
        legend.direction = "horizontal")

# ------------------------------------------------------------------------------
# Save the plot as a PDF
# ------------------------------------------------------------------------------
ggsave("output/img/Beneficiary literacy.pdf", 
       width = 18, height = 10, units = "cm")



```


### Partner nbr. of years of education


```{r}
followup_MRT_hh %>% 
  # Prepare education variable for plotting
  mutate(hhh_edu_bin = hhh_edu) %>% 
  
  # Group data by number of years of education
  group_by(hhh_edu_bin) %>% 
  
  # Count frequency of each unique education value
  summarise(Freq = n()) %>%
  
  # Compute proportion of each group
  mutate(Prop = Freq / sum(Freq)) %>% 
  
  # Begin plotting
  ggplot(aes(x = hhh_edu_bin, y = Prop, label = scales::percent(Prop))) +
  
  # Create bar chart (one bar per unique value of education years)
  geom_col(fill = "grey69", color = "black", alpha = 0.7) +

  # Add a vertical dashed red line for the mean value
  geom_vline(aes(xintercept = mean(followup_MRT_hh$hhh_edu, na.rm = TRUE)), 
             color = "red", linetype = "dashed", size = 0.5) +
  
  # Annotate the mean value on the plot
  annotate("text", 
           x = mean(followup_MRT_hh_csh_trnsfr$hhh_edu, na.rm = TRUE) + 0.25, 
           y = 0.5, 
           label = paste0("Mean = ", round(mean(followup_MRT_hh$hhh_edu, na.rm = TRUE), 2)), 
           angle = 90, size = 5, color = "red") +
  
  # Add a vertical dashed blue line for the median value
  geom_vline(aes(xintercept = median(followup_MRT_hh$hhh_edu, na.rm = TRUE)), 
             color = "blue", linetype = "dashed", size = 0.5) +
  
  # Annotate the median value on the plot
  annotate("text", 
           x = median(followup_MRT_hh$hhh_edu, na.rm = TRUE) + 0.25, 
           y = 0.5, 
           label = paste0("Median = ", round(median(followup_MRT_hh$hhh_edu, na.rm = TRUE), 2)), 
           angle = 90, size = 5, color = "blue") +
  
  # Add title and axis labels
  labs(title = "Partner's number of years of education", 
       x = "Number of years", 
       y = "Proportion") +
  
  # Apply a clean, light theme
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', 
        text = element_text(size = 8), 
        legend.direction = "horizontal")

# ------------------------------------------------------------------------------
# Save the plot
# ------------------------------------------------------------------------------
ggsave("output/img/Partner nbr. of years of education.pdf", 
       width = 18, height = 10, units = "cm")
```


### Beneficiary nbr. of years of education



```{r}
followup_MRT_hh %>% 
  # Prepare education variable for plotting (rename for clarity)
  mutate(pben_edu_bin = pben_edu) %>% 
  
  # Group data by number of years of education
  group_by(pben_edu_bin) %>% 
  
  # Count how many beneficiaries fall into each education group
  summarise(Freq = n()) %>%
  
  # Compute the proportion for each group
  mutate(Prop = Freq / sum(Freq)) %>% 
  
  # Begin ggplot
  ggplot(aes(x = pben_edu_bin, y = Prop, label = scales::percent(Prop))) +
  
  # Create a bar chart with grey fill and black borders
  geom_col(fill = "grey69", color = "black", alpha = 0.7) +

  # Add vertical dashed red line at the mean value of education
  geom_vline(aes(xintercept = mean(followup_MRT_hh$pben_edu, na.rm = TRUE)), 
             color = "red", linetype = "dashed", size = 0.5) +
  
  # Annotate the mean on the graph
  annotate("text", 
           x = mean(followup_MRT_hh$pben_edu, na.rm = TRUE) + 0.25, 
           y = 0.5, 
           label = paste0("Mean = ", round(mean(followup_MRT_hh$pben_edu, na.rm = TRUE), 2)), 
           angle = 90, size = 5, color = "red") +
  
  # Add vertical dashed blue line at the median value of education
  geom_vline(aes(xintercept = median(followup_MRT_hh$pben_edu, na.rm = TRUE)), 
             color = "blue", linetype = "dashed", size = 0.5) +
  
  # Annotate the median on the graph
  annotate("text", 
           x = median(followup_MRT_hh$pben_edu, na.rm = TRUE) + 0.25, 
           y = 0.5, 
           label = paste0("Median = ", round(median(followup_MRT_hh$pben_edu, na.rm = TRUE), 2)), 
           angle = 90, size = 5, color = "blue") +
  
  # Add plot title and axis labels
  labs(title = "Beneficiary's number of years of education", 
       x = "Number of years of education", 
       y = "Proportion") +
  
  # Apply a clean, readable theme
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', 
        text = element_text(size = 8), 
        legend.direction = "horizontal")

# ------------------------------------------------------------------------------
# Save the plot as a PDF
# ------------------------------------------------------------------------------
ggsave("output/img/beneficiary's nbr. of years of education.pdf", 
       width = 18, height = 10, units = "cm")
```




### Beneficiary is handicapped


```{r}
followup_MRT_hh %>% 
  # Convert binary indicator to labeled factor for better readability
  mutate(pben_handicap_bin = factor(pben_handicap, levels = c("0", "1"),
                                    labels = c("No", "Yes"))) %>% 
  
  # Group by disability status
  group_by(pben_handicap_bin) %>% 
  
  # Count how many beneficiaries fall into each group
  summarise(Freq = n()) %>%
  
  # Compute proportion of each group
  mutate(Prop = Freq / sum(Freq)) %>% 
  
  # Begin ggplot
  ggplot(aes(x = pben_handicap_bin, y = Prop, fill = pben_handicap_bin, label = scales::percent(Prop))) +
  
  # Create bar chart with custom grey shades and black borders
  geom_col(fill = c("grey69", "grey25"), color = "black", alpha = 0.7) +
  
  # Add text labels with proportions inside the bars
  geom_text(aes(label = scales::percent(Prop)), position = position_stack(0.5)) +
  
  # Add plot labels and legend title
  labs(title = "Beneficiary is handicapped", 
       x = "", 
       y = "Proportion", 
       fill = "Beneficiary is handicapped") +
  
  # Apply a clean and simple theme
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', 
        text = element_text(size = 8), 
        legend.direction = "horizontal")

# ------------------------------------------------------------------------------
# Save the plot to a PDF file
# ------------------------------------------------------------------------------
ggsave("output/img/Beneficiary is handicapped.pdf", 
       width = 18, height = 10, units = "cm")
```

### Beneficiary is in a polygamous union


```{r}
followup_MRT_hh %>% 
  # Convert binary variable to a labeled factor for readability
  mutate(pben_poly_bin = factor(pben_poly, levels = c("0", "1"),
                                labels = c("No", "Yes"))) %>% 
  
  # Group by polygamous union status
  group_by(pben_poly_bin) %>% 
  
  # Count number of beneficiaries in each group
  summarise(Freq = n()) %>%
  
  # Calculate the proportion of each group
  mutate(Prop = Freq / sum(Freq)) %>% 
  
  # Start plotting
  ggplot(aes(x = pben_poly_bin, y = Prop, fill = pben_poly_bin, label = scales::percent(Prop))) +
  
  # Create bar chart with grey fill, black borders, and transparency
  geom_col(fill = c("grey69", "grey25"), color = "black", alpha = 0.7) +
  
  # Add proportion labels inside bars
  geom_text(aes(label = scales::percent(Prop)), position = position_stack(0.5)) +
  
  # Add plot title and axis/legend labels
  labs(title = "Beneficiary is in a polygamous union", 
       x = "", 
       y = "Proportion", 
       fill = "Polygamous union") +  # <- Corrected legend label
  
  # Apply a clean, light theme
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', 
        text = element_text(size = 8), 
        legend.direction = "horizontal")

# ------------------------------------------------------------------------------
# Save the plot as a PDF
# ------------------------------------------------------------------------------
ggsave("output/img/Beneficiary is in a polygamous union.pdf", 
       width = 18, height = 10, units = "cm")
```

### Share of saving own by partner

```{r}
followup_MRT_hh %>% 
  # Convert binary variable to a labeled factor for clarity
  mutate(save_share_d_bin = factor(save_share_d, levels = c("0", "1"),
                                   labels = c("None (0)", "All (1)"))) %>% 
  
  # Group data by the new binary factor
  group_by(save_share_d_bin) %>% 
  
  # Count frequency for each group
  summarise(Freq = n()) %>%
  
  # Calculate proportion of each group
  mutate(Prop = Freq / sum(Freq)) %>% 
  
  # Begin plot creation
  ggplot(aes(x = save_share_d_bin, y = Prop, label = scales::percent(Prop))) +
  
  # Create bar chart with black border and transparency
  geom_col(color = "black", alpha = 0.7) +
  
  # Add proportion labels on bars
  geom_text(aes(label = scales::percent(Prop)), position = position_stack(0.5)) +
  
  # Add plot title and axis/legend labels
  labs(title = "Beneficiary share of saving owned by partner", 
       x = "", 
       y = "Proportion", 
       fill = "Share of saving owned by partner") +
  
  # Apply a clean, minimal theme
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', 
        text = element_text(size = 8), 
        legend.direction = "horizontal")

# ------------------------------------------------------------------------------
# Save the plot as a PDF file
# ------------------------------------------------------------------------------
ggsave("output/img/Beneficiary share of saving own by partner.pdf", 
       width = 18, height = 10, units = "cm")
```

### Control over earnings

```{r}
followup_MRT_hh %>% 
  # Begin creating the plot
  ggplot(aes(x = ctrl_earn_index_tr_bl, y = after_stat(density))) +
  
  # Create histogram of z-index values
  geom_histogram(aes(y = after_stat(density)), 
                 fill = "grey69", color = "black", alpha = 0.7, bins = 40) +
  
  # Add vertical line for the mean value of the index
  geom_vline(aes(xintercept = mean(ctrl_earn_index_tr_bl, na.rm = TRUE)), 
             color = "red", linetype = "dashed", size = 0.5) +
  
  # Annotate the mean value on the plot
  annotate("text", 
           x = mean(followup_MRT_hh$ctrl_earn_index_tr_bl, na.rm = TRUE) - 0.1, 
           y = 0.40, 
           label = paste0("Mean = ", round(mean(followup_MRT_hh$ctrl_earn_index_tr_bl, na.rm = TRUE), 2)), 
           angle = 90, size = 5, color = "red") +
  
  # Add vertical line for the median value
  geom_vline(aes(xintercept = median(ctrl_earn_index_tr_bl, na.rm = TRUE)), 
             color = "blue", linetype = "dashed", size = 0.5) +
  
  # Annotate the median value on the plot
  annotate("text", 
           x = median(followup_MRT_hh$ctrl_earn_index_tr_bl, na.rm = TRUE) + 0.1, 
           y = 0.40, 
           label = paste0("Median = ", round(median(followup_MRT_hh$ctrl_earn_index_tr_bl, na.rm = TRUE), 2)), 
           angle = 90, size = 5, color = "blue") +
  
  # Overlay a kernel density plot
  geom_density(color = "black", size = 0.4, alpha = 0.5) +
  
  # Set title and axis labels
  labs(title = "Control over earning (all female)", 
       x = "Control over earning z-index", 
       y = "Density", 1) +
  
  # Apply clean light theme
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', 
        text = element_text(size = 8), 
        legend.direction = "horizontal")

# ------------------------------------------------------------------------------
# Save the plot as a PDF file
# ------------------------------------------------------------------------------
ggsave("output/img/control over earnings z-index distribution_all.pdf", 
       width = 18, height = 10, units = "cm")
```

### Control over household resources


```{r}
#### Graph
followup_MRT_hh %>% 
  # Begin creating the plot
  ggplot(aes(x = ctrl_hh_index_tr_bl, y = after_stat(density))) +
  
  # Create a histogram with 40 bins, light blue fill, black outline, and slight transparency
  geom_histogram(aes(y = after_stat(density)), fill = "grey69", 
                 color = "black", alpha = 0.7) +
  
  # Add a vertical line for the mean value of control over household resources
  geom_vline(aes(xintercept = mean(ctrl_hh_index_tr_bl, na.rm = TRUE)), 
             color = "red", linetype = "dashed", size = .5) +
  
  # Annotate the mean value on the plot
  annotate("text", x=mean(followup_MRT_hh$ctrl_hh_index_tr_bl, na.rm = TRUE) - 0.05, y=0.40, 
           label=paste0("Mean = ",round(mean(followup_MRT_hh$ctrl_hh_index_tr_bl, na.rm = TRUE),2)), 
           angle=90, size=5, color="red") +
  
  # Add a vertical line for the median value of control over household resources
  geom_vline(aes(xintercept = median(ctrl_hh_index_tr_bl, na.rm = TRUE)), 
             color = "blue", linetype = "dashed", size = .5) +
  
  # Annotate the median value on the plot
  annotate("text", x=median(followup_MRT_hh$ctrl_hh_index_tr_bl, na.rm = TRUE) + 0.05, y=0.40, 
           label=paste0("Median = ", round(median(followup_MRT_hh$ctrl_hh_index_tr_bl, na.rm = TRUE),2)), 
           angle=90, size=5, color="blue") +
  
  # Add a density curve over the histogram for smoother visualization of distribution
  geom_density(color = "black", size = .4, alpha = 0.5) +
  
  # Set plot labels and title for clarity
  labs(title="Control over hh. resources (all female)", x="Control over resources z-index", y="Density", 1) +
  
  # Apply a minimal theme for clean appearance
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), legend.direction = "horizontal")

# Save the plot as a PDF image for output
ggsave("output/img/control over hh. resources z-index distribution_all.pdf", width = 18, height = 10, units = "cm")
```

### Intra-household dynamics 


```{r}
#### Graph
followup_MRT_hh %>% 
  # Begin creating the plot
  ggplot(aes(x = intrahh_vars_index_tr_bl, y = after_stat(density))) +
  
  # Create a histogram with 40 bins, light blue fill, black outline, and slight transparency
  geom_histogram(aes(y = after_stat(density)), bins = 40, fill = "grey69", 
                 color = "black", alpha = 0.7) +
  
  # Add a vertical line for the mean value of intra-household dynamics
  geom_vline(aes(xintercept = mean(intrahh_vars_index_tr_bl, na.rm = TRUE)), 
             color = "red", linetype = "dashed", size = .5) +
  
  # Annotate the mean value on the plot
  annotate("text", x=mean(followup_MRT_hh$intrahh_vars_index_tr_bl, na.rm = TRUE) - 0.1, y=0.20, 
           label=paste0("Mean = ",round(mean(followup_MRT_hh$intrahh_vars_index_tr_bl, na.rm = TRUE),2)), 
           angle=90, size=5, color="red") +
  
  # Add a vertical line for the median value of intra-household dynamics
  geom_vline(aes(xintercept = median(intrahh_vars_index_tr_bl, na.rm = TRUE)), 
             color = "blue", linetype = "dashed", size = .5) +
  
  # Annotate the median value on the plot
  annotate("text", x=median(followup_MRT_hh$intrahh_vars_index_tr_bl, na.rm = TRUE) + 0.1, y=0.20, 
           label=paste0("Median = ", round(median(followup_MRT_hh$intrahh_vars_index_tr_bl, na.rm = TRUE),2)), 
           angle=90, size=5, color="blue") +
  
  # Add a density curve over the histogram for smoother visualization of distribution
  geom_density(color = "black", size = .4, alpha = 0.5) +
  
  # Set plot labels and title for clarity
  labs(title="Intra-hh. dynamics (all female)", x="Intra-hh. dynamics z-index", y="Density", 1) +
  
  # Apply a minimal theme for clean appearance
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), legend.direction = "horizontal")

# Save the plot as a PDF image for output
ggsave("output/img/intra-hh. dynamics z-index distribution_all.pdf", width = 18, height = 10, units = "cm")
```

### Benef. share of total household revenues


```{r}
#### Graph
followup_MRT_hh %>% 
  # Begin creating the plot
  ggplot(aes(x = rev_sum_bohh_wemp_98_tr_bl, y = after_stat(density))) +
  
  # Create a histogram with 40 bins, light blue fill, black outline, and slight transparency
  geom_histogram(aes(y = after_stat(density)), fill = "grey69",
                 color = "black", alpha = 0.7) +
  
  # Add a vertical line for the mean value of the beneficiary share of total household revenues
  geom_vline(aes(xintercept = mean(rev_sum_bohh_wemp_98_tr_bl, na.rm = TRUE)), 
             color = "red", linetype = "dashed", size = .5) +
  
  # Annotate the mean value on the plot
  annotate("text", x=mean(followup_MRT_hh$rev_sum_bohh_wemp_98_tr_bl, na.rm = TRUE) - 0.015, y=2.5, 
           label=paste0("Mean = ",round(mean(followup_MRT_hh$rev_sum_bohh_wemp_98_tr_bl, na.rm = TRUE),2)), 
           angle=90, size=5, color="red") +
  
  # Add a vertical line for the median value of the beneficiary share of total household revenues
  geom_vline(aes(xintercept = median(rev_sum_bohh_wemp_98_tr_bl, na.rm = TRUE)), 
             color = "blue", linetype = "dashed", size = .5) +
  
  # Annotate the median value on the plot
  annotate("text", x=median(followup_MRT_hh$rev_sum_bohh_wemp_98_tr_bl, na.rm = TRUE) + 0.015, y=2.5, 
           label=paste0("Median = ", round(median(followup_MRT_hh$rev_sum_bohh_wemp_98_tr_bl, na.rm = TRUE),2)), 
           angle=90, size=5, color="blue") +
  
  # Add a density curve over the histogram for smoother visualization of distribution
  geom_density(color = "black", size = .4, alpha = 0.5) +
  
  # Set plot labels and title for clarity
  labs(title="Benef. share of total hh. rev.", x="Benef. share of total hh. rev.", y="Density", 1) +
  
  # Apply a minimal theme for clean appearance
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), legend.direction = "horizontal")

# Save the plot as a PDF image for output
ggsave("output/img/benef. share of total hh. rev. distribution_all.pdf", width = 18, height = 10, units = "cm")
```

### Age distribution


Around 55 percent of the hhh are female benef.
```{r}
# Filter the dataset to only include phase 2 data
followup_MRT_hh %>% 
  # Begin creating the plot
  ggplot(aes(x = age_gap, y = after_stat(density))) +
  
  # Create a histogram with 40 bins, light blue fill, black outline, and slight transparency
  geom_histogram(aes(y = after_stat(density)), bins = 40, fill = "grey69", 
                 color = "black", alpha = 0.7) +
  
  # Add a vertical line for the mean age gap
  geom_vline(aes(xintercept = mean(age_gap, na.rm = TRUE)), 
             color = "red", linetype = "dashed", size = .5) +
  
  # Annotate the mean value on the plot
  annotate("text", x=mean(followup_MRT_hh$age_gap, na.rm = TRUE) + 2, y=0.10, 
           label=paste0("Mean = ",round(mean(followup_MRT_hh$age_gap, na.rm = TRUE),2)), 
           angle=90, size=5, color="red") +
  
  # Add a vertical line for the median age gap
  geom_vline(aes(xintercept = median(age_gap, na.rm = TRUE)), 
             color = "blue", linetype = "dashed", size = .5) +
  
  # Annotate the median value on the plot
  annotate("text", x=median(followup_MRT_hh$age_gap, na.rm = TRUE) - 2, y=0.10, 
           label=paste0("Median = ", round(median(followup_MRT_hh$age_gap, na.rm = TRUE),2)), 
           angle=90, size=5, color="blue") +
  
  # Add a density curve over the histogram for smoother visualization of distribution
  geom_density(color = "black", size = .4, alpha = 0.5) +
  
  # Set plot labels and title for clarity
  labs(title="Age gap distribution (all)", subtitle = "hhh - benef. age" , x="Age gap", y="Density", 1) +
  
  # Apply a minimal theme for clean appearance
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), legend.direction = "horizontal")

# Save the plot as a PDF image for output
ggsave("output/img/age gap distribution_all.pdf", width = 18, height = 10, units = "cm")
```



### Enumerator
#### All

#### Tekavoul

```{r}
followup_MRT_hh_csh_trnsfr %>% 
  # Group data by treatment type and surveyor
  group_by(treatment_csh_trnsfr, surveyor) %>% 
  # Calculate frequency counts for each group
  summarise(Freq = n()) %>%
  
  # Compute proportions and adjust factor labels
  mutate(
    Prop = Freq / sum(Freq),  # Proportion of each group
    surveyor = as.factor(surveyor),  # Convert surveyor to factor for plotting
    treatment_csh_trnsfr = labelled::unlabelled(treatment_csh_trnsfr)  # Remove labels if present
  ) %>% 
  
  # Start the plot
  ggplot(aes(x = surveyor, y = Prop, fill = treatment_csh_trnsfr)) + 
  
  # Use `geom_col()` to create the bar plot with 70% transparency
  geom_col(color = "black", alpha = 0.7) +
  
  # Correctly define fill colors for treatment groups
  scale_fill_manual(values = c("Control" = "grey69", "Cash Assignment" = "black")) + 
  
  # Add labels for better readability
  labs(
    title = "Enumerator of the IPV module (Tekavoul)",
    x = "Enumerator ID",
    y = "Proportion",
    fill = "Type of treatment"
  ) +
  
  # Use a clean theme with light background and smaller text for better visualization
  theme_light(base_size = 8) +
  theme(
    legend.position = 'bottom',        # Position legend at the bottom
    text = element_text(size = 8),     # Reduce text size for readability
    legend.direction = "horizontal"    # Arrange legend items horizontally
  )

# Save the plot as a PDF with defined dimensions
ggsave("output/img/enumerator-ID-Tekavoul.pdf", width = 18, height = 10, units = "cm")
```


#### Productive inclusion

```{r}

followup_MRT_hh_pi %>% 
  group_by(treatment_pi, surveyor) %>% 
  summarise(Freq = n()) %>%
    mutate(Prop = Freq / sum(Freq),
           surveyor = as.factor(surveyor),
           treatment_pi=labelled::unlabelled(treatment_pi)) %>% 
    # Begin creating the plot
    ggplot(aes(x = surveyor, y=Prop, fill = treatment_pi, colour = treatment_pi)) +   geom_col( color = "black", alpha = 0.7) +
  # Add plot labels
  labs(title="Enumerator of the IPV module (Productive inclusion)", x="Enumerator ID", y="Proportion", fill="Type of treatment") +
    # Correctly define fill colors for treatment groups
  scale_fill_manual(values = c("Control" = "#FFFFFF", "Capital" = "#C8C8C8", "Psychosocial" = "#717171", "Full" = "black")) + 
  # Clean theme
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), legend.direction = "horizontal")

# Save the plot
ggsave("output/img/enumerator-ID-PI.pdf", width = 18, height = 10, units = "cm")
```

### Survey language

```{r}
# Survey language.
followup_MRT_hh %>% 
  select(language_1, language_2, language_3, language_4) %>% 
  tbl_summary(
    statistic = list(all_categorical() ~ "{n} ({p}%)"),
    type = (list=c("language_1", "language_2", "language_3", "language_4") ~ "dichotomous"),
    missing = "no",
    label = list(
      language_1 ~ "French (1=Yes, 0=No)",
      language_2 ~ "Hassanya (1=Yes, 0=No)",
      language_3 ~ "Poular (1=Yes, 0=No)",
      language_4 ~ "Soninké (1=Yes, 0=No)"
    )
  ) %>%
  bold_labels()
```

### Region

```{r}
# Survey language.
followup_MRT_hh %>% 
  mutate(region_bin = ifelse(region==2, 0, 1)) %>% 
  select(region_bin) %>% 
  tbl_summary(
    statistic = list(all_categorical() ~ "{n} ({p}%)"),
    type = (list=c("region_bin") ~ "dichotomous"),
    missing = "no",
    label = list(
      region_bin ~ "Selibaby (1=Yes, 0=No)"
    )
  ) %>%
  bold_labels()
```
## Tekavoul program



```{r}


# Create vectors of variable names and their corresponding labels
var_vec = c(
            "treatment_csh_trnsfr_bin", 
            "same_cb_bl",
            "het_married_ben",
            "pben_handicap_bl",
            "hhh_fem_bl",
            "pben_fem_bl",
            "hhh_poly_bl",
            "pben_poly_bl",
            "hhh_age_bl",
            "pben_age_bl",
            "age_gap",
            "het_age_gap",
            "age_at_mrrg",
            "age_at_mrrg_above18",
            "het_age_at_mrrg", 
            'nbr_adult_mal', 
            "het_nbr_adult_mal", 
            "shr_adult_mal", 
            "het_shr_adult_mal", 
            "nbr_adult_mal_tot",
            "het_nbr_adult_mal_tot",
            "nbr_adult_fem", 
            "het_nbr_adult_fem", 
            "shr_adult_fem", 
            "het_shr_adult_fem", 
            "nbr_adult_fem_tot",
            "het_nbr_adult_fem_tot",            
            "shr_adult_fem_mal",
            "het_shr_adult_fem_mal",
            "het_wtht_adult_mal",
            "het_wtht_adult_mal_tot",
            "nbr_adult", 
            "het_nbr_adult", 
            "shr_adult", 
            "het_shr_adult", 
            "nbr_adult_tot",
            "het_nbr_adult_tot", 
            "nbr_elder",
            "het_nbr_elder",
            "shr_elder",
            "het_shr_elder",
            "hh_has_kid", 
            "nbr_kid", 
            "het_nbr_kid", 
            "nbr_hh_number",
            "het_nbr_hh_number",
            "hhh_edu_bl",
            "pben_edu_bl",
            "hhh_prim_bl",
            "pben_prim_bl",
            "hhh_lit_bl",
            "pben_lit_bl",
            "ctrl_earn_index_tr_bl", #B.10.5 Control Earnings Z-index at bl, 
            "ctrl_hh_index_tr_bl", # B.10.6 Control HH Z-index at bl
            "intrahh_vars_index_tr_bl", # C.2.3.A Intra-HH Dynamics Z-index at Baseline
            "gse_index_tr_bl",
            "soc_cohsn_index_tr_bl",
            "soc_stand_index_bl", 
            "los1_bl", 
            "los2_bl", 
            "rev_sum_bohh",     # Revenue/income sum for household
            "het_region", # Region
            "tot_hh_rev", # Baseline revenu
            "consum",
            "dec_pow_earn_d_bl", 
            "dec_could_earn_d_bl",      # Power/capacity to earn
            "dec_pow_ag_d_bl", 
            "dec_pow_liv_d_bl", 
            "dec_pow_bus_d_bl",  # Power in productive sectors
            "dec_pow_spend_d_bl", 
            "dec_could_spend_d_bl", 
            "dec_pow_large_d_bl", 
            "dec_could_large_d_bl",
            "dec_pow_fert_d_bl", 
            "dec_could_fert_d_bl", 
            "dec_pow_edu_d_bl",
            "tot_emp_2rev12_ben_98_ppp_bl", 		#"Wage\n earnings\n (yearly, USD)"
          	"crop_ctrl_dum_bl", 	#"Benef. controls\n crop\n revenue \{0,1\}"
            "na_bus2_op_wn_12_ben_bl", # No. of\n beneficiary\n businesses
            "bus2_ben_dum_bl",	 	#"Beneficiary\n has a\n business \{0,1\}"
            "tot_busmths_uniq_ben_bl", #No. of months benef worked last year
            "div_n_na_12_ben_bl", # Entrepreneurial\n business types\n (yearly)
            "bus2_within_12_dum_ben_bl",	#Beneficiary\n launched a\n business \{0,1\}				
            "tot_ben_rev12_98_ppp_bl", # Business\n revenues\n (yearly, USD)    	
          	"tot_ben_pro12_98_ppp_bl", # Business\n profits\n (yearly, USD)
            "bus_assval_98_ppp_bl", # Business\n asset\n value (USD)
            'tot_ben_rev30_98_ppp_bl',	#"Business revenue\n (beneficiary,\n monthly, USD)" 
            "ani_ben_dum_bl", 		#"Benef. owns\n livestock\n \{0,1\}"
            "sleep_prod_dum_bl",	#"Benef. traveled\n for work\n \{0,1\}"
            "tot_time_in_house_chores",
            "tot_time_market_income",
            "tot_time_leisure",
            "tot_time_other",
            "male_expenditure",         # Total male expenditures
            "female_expenditure",       # Total female expenditures
            "other_expenditure"         # Other total expenditures
            )


# Create corresponding human-readable labels for each variable
label_vec = c(
              "Benef. of cash transfert only (0,1)", 
              "Benef. is HH head",
              "Benef. is married (0,1)",
              "Benef. is handicapped",
              "Female (hh. head)",
              "Female (benef.)",
              "Polygamy (hh. head)",
              "Polygamy (benef.)",
              "Age (Hh. head)",
              "Age (benef.)",
              "Age gap (hh. head - benef.)",
              "Age gap (hh. head - benef.) above med. (0,1)",
              "Ben. age at marriage",
              "Ben. married after 18 (0,1)",
              "Ben. married aged above med. (0,1)",  
              'Nbr adults males (age 25-65)', 
              "Nbr adults males (age 25-65) above med. (0,1)", 
              "Shr adults males (age 25-65)", 
              "Shr adults males (age 25-65) above med. (0,1)", 
              'Nbr males (age 15+)', 
              "Nbr males (age 15+) above med. (0,1)", 
              'Nbr adults females (age 25-65)', 
              "Nbr adults females (age 25-65) above med. (0,1)", 
              "Shr adults females (age 25-65)", 
              "Shr adults females (age 25-65) above med. (0,1)", 
              'Nbr females (age 15+)', 
              "Nbr females (age 15+) above med. (0,1)", 
              "Shr females (age 15+) in adults",
              "Shr females (age 15+) in adults above med. (0,1)",
              "Shr of hh. without males (age 25-65)",
              "Shr of hh. without males (age 15+)",
              'Nbr adults tot (age 25-65)', 
              "Nbr adults tot (age 25-65) above med. (0,1)", 
              "Shr adults tot (age 25-65)", 
              "Shr adults tot (age 25-65) above med. (0,1)", 
              "Nbr members (age 15+) in hh.",
              "Nbr members (age 15+) in hh. above med. (0,1)",
              "Nbr of elders (age 66+)",
              "Nbr of elders (age 66+) above med. (0,1)",
              "Shr of elders (age 66+)",
              "Shr of elders (age 66+) above med. (0,1)",
              "Hh. has a kid (age 0-30 mnth)", 
              'Nbr kid (age 0-30 mnth)', 
              "Nbr kid (age 0-30 mnth) above med. (0,1)", 
              "Nbr hh. members",
              "Nbr hh. members above med. (0,1)",
              "Education (years, HH head)",
              "Education (years, benef.)",
              "Primary education (0/1, H-hh. head)",
              "Primary education (0/1, benef.)",
              "Literate (hh. head)",
              "Literate (benef.)",
              "Control over earnings", #B.10.5 Control Earnings Z-index at bl, 
              "Control over hh. resources", # B.10.6 Control HH Z-index at bl
              "Intra hh. dynamics index", # C.2.3.A Intra-HH Dynamics Z-index at Baseline
              "Self efficacy",
              "Social cohesion and closeness to community",
              "Social standing",
              "Partner inclusiveness (1-4)", 
              "Community inclusiveness (1-4)", 
              "Ben. revenue tot.",     # Revenue/income sum for household
              "Household in Sélibaby (0,1)", # Region
              "Tot. hh. revenue", # Baseline revenu
              "Consumption eq ppp",
              "Own earnings influence (0,1)",
              "Can Decide to Earn Alone (0,1)",
              "Agriculture influence (0,1)",
              "Livestock influence (0,1)",
              "Off-farm business influence (0,1)",
              "Daily spending influence (0,1)",
              "Can Decide to Spend Alone (0,1)",
              "Large purchases influence (0,1)",
              "Can Decide to Spend Large Amounts Alone (0,1)",
              "Family planning influence (0,1)",
              "Can Make Fertility Choices Alone (0,1)",
              "Child education influence (0,1)",
              "Wage earnings (yearly, USD)",
              "Benef. controls crop revenue (0,1)",
              "No. of beneficiary businesses",
              "Beneficiary has a business (0,1)",
              "No. of months benef worked last year",
              "Entrepreneurial business types (yearly)",
              "Beneficiary launched a business (0,1)",
              "Business revenues (yearly, USD)",
              "Business profits (yearly, USD)",
              "Business asset value hh. (USD)",
              "Business revenue (beneficiary, monthly, USD)",
              "Benef. owns livestock (0,1)",
              "Benef. traveled for work (0,1)",
              "Tot Mins in household chores (last 7 days)",
              "Tot Mins in market income activities (last 7 days)",
              "Tot Mins in leisure activities (last 7 days)",
              "Tot Mins in other activities (last 7 days)",
              "Partner private goods consumption (yearly)",
              "Benef. private goods consumption (yearly)",
              "Other goods consumption (yearly)"
            )

label_var = c("Balance test")

var_lab = c("Balance")



in_house_chores <- c(
  "time_wk_ben_water",     # fetching water
  "time_wk_ben_cook",      # cooking
  "time_wk_ben_clean",     # cleaning
  "time_wk_ben_laundry",   # laundry
  "time_wk_ben_shop",      # shopping
  "time_wk_ben_child",        # childcare
  "time_wk_ben_firewood",  # collecting firewood
  "time_wk_ben_handicap"      # helping disabled relatives
)

market_income <- c(
  "time_wk_ben_nonag",     # non-agricultural business
  "time_wk_ben_ag",        # agriculture
  "time_wk_ben_liv"        # livestock
)


leisure_time <- c(
  "time_wk_ben_study_coran",  # studying Quran
  "time_wk_ben_study_trad",   # traditional study
  "time_wk_ben_family",          # time with friends/family
  "time_wk_ben_radio",           # listening to radio
  "time_wk_ben_rest",            # resting
  "time_wk_ben_pray"             # praying
)

time_use_group <- c("tot_time_in_house_chores","tot_time_market_income","tot_time_leisure","tot_time_other")

followup_MRT_hh <- followup_MRT_hh %>%
  mutate(tot_time_in_house_chores = apply(select(., in_house_chores), 1, sum, na.rm = TRUE)) %>% 
  mutate(tot_time_market_income = apply(select(., market_income), 1, sum, na.rm = TRUE)) %>% 
  mutate(tot_time_leisure = apply(select(., leisure_time), 1, sum, na.rm = TRUE))%>% 
  mutate(tot_time_other = 10080 - (tot_time_in_house_chores + tot_time_market_income + tot_time_leisure))

followup_MRT_hh_pi <- followup_MRT_hh %>% filter(reg_hh_pi_mrt == 1)
followup_MRT_hh_csh <- followup_MRT_hh %>% filter(reg_hh_csh_mrt == 1)

# Filter to get the cash recipient in the followup_MRT_hh that receive Tekavoul programt
# and is in the age transfert
followup_MRT_hh_csh <- followup_MRT_hh %>%
  filter(reg_hh_csh_mrt == 1)  %>% 
  mutate(treatment_pool_bin = 0,
  treatment_csh_trnsfr_bin = as.numeric(ifelse(treatment_csh_trnsfr == "Cash Assignment" & reg_hh_csh_mrt==1, 1, 0)),
      treatment_capital_bin = 0,
      treatment_psychosocial_bin = 0,
      treatment_full_bin = 0)  %>% 
  mutate(pben_relation_bin = labelled::unlabelled(pben_relation))

# Convert all variables in var_vec to numeric type
followup_MRT_hh_csh <- followup_MRT_hh_csh  %>% 
  dplyr::mutate(across(var_vec, as.numeric))

# Create a tibble mapping variable names to their labels
description = tibble(
  name = var_vec,
  label = label_vec
)

# Create a named list of variable labels
var_labels <- setNames(as.list(description$label), description$name)

# Apply the variable labels to the dataset
followup_MRT_hh_csh <- followup_MRT_hh_csh %>%
  set_variable_labels(.labels = var_labels, .strict = FALSE)


# Create summary statistics table grouped by treatment
balance_tab_1 = followup_MRT_hh_csh %>% 
  dplyr::select(treatment_csh_trnsfr,var_vec) %>%  
  tbl_summary(by = treatment_csh_trnsfr,
              type = (list=var_vec ~ "continuous"),
              statistic = list(all_continuous() ~ "{mean}({sd})"),
              digits = everything() ~ c(2,2), 
              missing = "no") %>% 
  modify_header(label = 'Variable')

# Create vector of treatment binary comparison variables
lst_treatment_bin="treatment_csh_trnsfr"

# Calculate p-values for each treatment comparison and variable
balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) {
  df_coef_value <- data.frame(variable = character(), 
                       treatment = character(), 
                       coef_val = character(), 
                       stringsAsFactors = FALSE)
  
  # Loop through each variable and run logistic regression
  for (v_name in var_vec) {
    # Fit logistic regression with clustered standard errors
    reg <- glm(as.formula(paste0(treat_var, " ~ ", v_name, " + strata")), 
               family = binomial, 
               data = followup_MRT_hh_csh)
    
    # Calculate p-value and add significance stars
    coef_val <- round(coeftest(reg, vcovCL(reg, cluster = followup_MRT_hh_csh$cluster))[2, 1], 3)
    pval <- round(coeftest(reg, vcovCL(reg, cluster = followup_MRT_hh_csh$cluster))[2, 4], 3)
    
    # Add significance stars based on p-value thresholds
    if (pval < 0.01) {
      coef_val <- paste0(as.character(pval), "***")
    } else if (pval < 0.05) {
      coef_val <- paste0(as.character(pval), "**")
    } else if (pval < 0.1) {
      coef_val <- paste0(as.character(pval), "*")
    }else {
       coef_val <- as.character(pval)
    }
    
    df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name, 
                                        treatment = treat_var, 
                                        coef_val = coef_val, 
                                        stringsAsFactors = FALSE))
  }
  
  return(df_coef_value)
})

# Reshape p-value table to wide format with treatment comparisons as columns
balance_tab_2 <- balance_tab_2 %>% 
  pivot_wider(id_cols = "variable", 
              names_from = "treatment", 
              values_from = "coef_val") 

# Rename columns to show treatment group comparisons
names(balance_tab_2) <- c("variable","(1)-(2)")

#Keep the variables of interest
balance_tab_2 <- balance_tab_2 %>% 
  select("(1)-(2)")

# Create table for joint F-tests
  

myfooter <- followup_MRT_hh_csh %>% 
  dplyr::select(treatment_csh_trnsfr,cluster, strata) %>%  
  group_by(treatment_csh_trnsfr) %>% 
  summarise(nbr_cluster = n_distinct(cluster),
            nbr_strata = n_distinct(strata)) %>% 
  column_to_rownames(var="treatment_csh_trnsfr")

#transpose data frame
myfooter_t <- transpose(myfooter)

#redefine row and column names
rownames(myfooter_t) <- colnames(myfooter)
colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[c(6,7)]

myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>%
  mutate(Variable=dplyr::recode(Variable, nbr_cluster = "N cluster", nbr_strata = "N strata"))


balance_tab = cbind(
  balance_tab_1,
  balance_tab_2)

# Adding the row on the nbr of cluster and strata
balance_tab <- plyr::rbind.fill(balance_tab,myfooter_t)

header <- str_squish(str_remove("Table : Balance Table ", "\n"))
# Set Table footer
footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level level. Fixed effects using randomization strata are included in all estimation regressions. The joint F-test shows the p-value from a test of equality of treatment arms. While the pooled F-test shows the p-value from a test of pooled treatment (i.e., a regression with a dummy for any treatment arm). *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n"))
# Set custom_tab() defaults
customtab_defaults()
custom_tab(balance_tab, header, footer)

```

## Productive inclusion program

This balance table was created by restricting the sample to recipients of cash transfers and productive measures. Specifically, the table includes all households that are among the poorest and are considered for Tekavoul program program, where the beneficiary in the household is aged between 18 and 49.

```{r}


# Create vectors of variable names and their corresponding labels
var_vec = c(
            "same_cb_bl",
            "pben_handicap_bl",
            "hhh_fem_bl",
            "pben_fem_bl",
            "hhh_poly_bl",
            "pben_poly_bl",
            "hhh_age_bl",
            "pben_age_bl",
            "age_gap",
            "het_age_gap",
            "age_at_mrrg",
            "age_at_mrrg_above18",
            "het_age_at_mrrg",  
            'nbr_adult_mal', 
            "het_nbr_adult_mal", 
            "shr_adult_mal", 
            "het_shr_adult_mal", 
            "nbr_adult_mal_tot",
            "het_nbr_adult_mal_tot",
            "nbr_adult_fem", 
            "het_nbr_adult_fem", 
            "shr_adult_fem", 
            "het_shr_adult_fem", 
            "nbr_adult_fem_tot",
            "het_nbr_adult_fem_tot",            
            "shr_adult_fem_mal",
            "het_shr_adult_fem_mal",
            "het_wtht_adult_mal",
            "het_wtht_adult_mal_tot",
            "nbr_adult", 
            "het_nbr_adult", 
            "shr_adult", 
            "het_shr_adult", 
            "nbr_adult_tot",
            "het_nbr_adult_tot", 
            "nbr_elder",
            "het_nbr_elder",
            "shr_elder",
            "het_shr_elder",
            "hh_has_kid", 
            "nbr_kid", 
            "het_nbr_kid", 
            "nbr_hh_number",
            "het_nbr_hh_number",
            "hhh_edu_bl",
            "pben_edu_bl",
            "hhh_prim_bl",
            "pben_prim_bl",
            "hhh_lit_bl",
            "pben_lit_bl",
            "ctrl_earn_index_tr_bl", #B.10.5 Control Earnings Z-index at bl, 
            "ctrl_hh_index_tr_bl", # B.10.6 Control HH Z-index at bl
            "intrahh_vars_index_tr_bl", # C.2.3.A Intra-HH Dynamics Z-index at Baseline
            "gse_index_tr_bl",
            "soc_cohsn_index_tr_bl",
            "soc_stand_index_bl", 
            "los1_bl", 
            "los2_bl", 
            "rev_sum_bohh",     # Revenue/income sum for household
            "het_region", # Region
            "tot_hh_rev", # Baseline revenu
            "consum",
            "dec_pow_earn_d_bl", 
            "dec_could_earn_d_bl",      # Power/capacity to earn
            "dec_pow_ag_d_bl", 
            "dec_pow_liv_d_bl", 
            "dec_pow_bus_d_bl",  # Power in productive sectors
            "dec_pow_spend_d_bl", 
            "dec_could_spend_d_bl", 
            "dec_pow_large_d_bl", 
            "dec_could_large_d_bl",
            "dec_pow_fert_d_bl", 
            "dec_could_fert_d_bl", 
            "dec_pow_edu_d_bl",
            "tot_emp_2rev12_ben_98_ppp_bl", 		#"Wage\n earnings\n (yearly, USD)"
          	"crop_ctrl_dum_bl", 	#"Benef. controls\n crop\n revenue \{0,1\}"
            "na_bus2_op_wn_12_ben_bl", # No. of\n beneficiary\n businesses
            "bus2_ben_dum_bl",	 	#"Beneficiary\n has a\n business \{0,1\}"
            "tot_busmths_uniq_ben_bl", #No. of months benef worked last year
            "div_n_na_12_ben_bl", # Entrepreneurial\n business types\n (yearly)
            "bus2_within_12_dum_ben_bl",	#Beneficiary\n launched a\n business \{0,1\}				
            "tot_ben_rev12_98_ppp_bl", # Business\n revenues\n (yearly, USD)    	
          	"tot_ben_pro12_98_ppp_bl", # Business\n profits\n (yearly, USD)
            "bus_assval_98_ppp_bl", # Business\n asset\n value (USD)
            'tot_ben_rev30_98_ppp_bl',	#"Business revenue\n (beneficiary,\n monthly, USD)" 
            "ani_ben_dum_bl", 		#"Benef. owns\n livestock\n \{0,1\}"
            "sleep_prod_dum_bl",	#"Benef. traveled\n for work\n \{0,1\}"
            "tot_time_in_house_chores",
            "tot_time_market_income",
            "tot_time_leisure",
            "tot_time_other",
            #"male_expenditure",         # Total male expenditures
            "female_expenditure",       # Total female expenditures
            "other_expenditure"         # Other total expenditures
            )

# Create corresponding human-readable labels for each variable
label_vec = c(
              "Benef. is HH head",
              "Benef. is handicapped",
              "Female (hh. head)",
              "Female (benef.)",
              "Polygamy (hh. head)",
              "Polygamy (benef.)",
              "Age (Hh. head)",
              "Age (benef.)",
              "Age gap (hh. head - benef.)",
              "Age gap (hh. head - benef.) above med. (0,1)",
              "Ben. age at marriage",
              "Ben. married after 18 (0,1)",
              "Ben. married aged above med. (0,1)",
              'Nbr adults males (age 25-65)', 
              "Nbr adults males (age 25-65) above med. (0,1)", 
              "Shr adults males (age 25-65)", 
              "Shr adults males (age 25-65) above med. (0,1)", 
              'Nbr males (age 15+)', 
              "Nbr males (age 15+) above med. (0,1)", 
              'Nbr adults females (age 25-65)', 
              "Nbr adults females (age 25-65) above med. (0,1)", 
              "Shr adults females (age 25-65)", 
              "Shr adults females (age 25-65) above med. (0,1)", 
              'Nbr females (age 15+)', 
              "Nbr females (age 15+) above med. (0,1)", 
              "Shr females (age 15+) in adults",
              "Shr females (age 15+) in adults above med. (0,1)",
              "Shr of hh. without males (age 25-65)",
              "Shr of hh. without males (age 15+)",
              'Nbr adults tot (age 25-65)', 
              "Nbr adults tot (age 25-65) above med. (0,1)", 
              "Shr adults tot (age 25-65)", 
              "Shr adults tot (age 25-65) above med. (0,1)", 
              "Nbr members (age 15+) in hh.",
              "Nbr members (age 15+) in hh. above med. (0,1)",
              "Nbr of elders (age 66+)",
              "Nbr of elders (age 66+) above med. (0,1)",
              "Shr of elders (age 66+)",
              "Shr of elders (age 66+) above med. (0,1)",
              "Hh. has a kid (age 0-30 mnth)", 
              'Nbr kid (age 0-30 mnth)', 
              "Nbr kid (age 0-30 mnth) above med. (0,1)", 
              "Nbr hh. members",
              "Nbr hh. members above med. (0,1)",
              "Education (years, HH head)",
              "Education (years, benef.)",
              "Primary education (0/1, H-hh. head)",
              "Primary education (0/1, benef.)",
              "Literate (hh. head)",
              "Literate (benef.)",
              "Control over earnings", #B.10.5 Control Earnings Z-index at bl, 
              "Control over hh. resources", # B.10.6 Control HH Z-index at bl
              "Intra hh. dynamics index", # C.2.3.A Intra-HH Dynamics Z-index at Baseline
              "Self efficacy",
              "Social cohesion and closeness to community",
              "Social standing",
              "Partner inclusiveness (1-4)", 
              "Community inclusiveness (1-4)", 
              "Ben. revenue tot.",     # Revenue/income sum for household
              "Household in Sélibaby (0,1)", # Region
              "Tot. hh. revenue", # Baseline revenu
              "Consumption eq ppp",
              "Own earnings influence (0,1)",
              "Can Decide to Earn Alone (0,1)",
              "Agriculture influence (0,1)",
              "Livestock influence (0,1)",
              "Off-farm business influence (0,1)",
              "Daily spending influence (0,1)",
              "Can Decide to Spend Alone (0,1)",
              "Large purchases influence (0,1)",
              "Can Decide to Spend Large Amounts Alone (0,1)",
              "Family planning influence (0,1)",
              "Can Make Fertility Choices Alone (0,1)",
              "Child education influence (0,1)",
              "Wage earnings (yearly, USD)",
              "Benef. controls crop revenue (0,1)",
              "No. of beneficiary businesses",
              "Beneficiary has a business (0,1)",
              "No. of months benef worked last year",
              "Entrepreneurial business types (yearly)",
              "Beneficiary launched a business (0,1)",
              "Business revenues (yearly, USD)",
              "Business profits (yearly, USD)",
              "Business asset value hh. (USD)",
              "Business revenue (beneficiary, monthly, USD)",
              "Benef. owns livestock (0,1)",
              "Benef. traveled for work (0,1)",
              "Tot Mins in household chores (last 7 days)",
              "Tot Mins in market income activities (last 7 days)",
              "Tot Mins in leisure activities (last 7 days)",
              "Tot Mins in other activities (last 7 days)",
              #"Partner private goods consumption (yearly)",
              "Benef. private goods consumption (yearly)",
              "Other goods consumption (yearly)"
            )

followup_MRT_hh_pi <- followup_MRT_hh_pi %>%
  filter(reg_hh_pi_mrt == 1) %>% 
        mutate(treatment_pool_bin = as.numeric(ifelse(treatment_pi_pool=="Pool" & reg_hh_pi_mrt==1, 1, 0)),
        treatment_csh_trnsfr_bin = as.numeric(ifelse(treatment_pi_pool =="Control" & reg_hh_pi_mrt==1, 1,0)),
        treatment_capital_bin = as.numeric(ifelse(treatment_pi=="Capital" & reg_hh_pi_mrt==1, 1, 0)),
        treatment_psychosocial_bin = as.numeric(ifelse(treatment_pi=="Psychosocial" & reg_hh_pi_mrt==1, 1, 0)),
        treatment_full_bin = as.numeric(ifelse(treatment_pi=="Full" & reg_hh_pi_mrt==1, 1, 0)))

# Convert all variables in var_vec to numeric type
followup_MRT_hh_pi <- followup_MRT_hh_pi  %>% 
  dplyr::mutate(across(var_vec, as.numeric))

# Create a tibble mapping variable names to their labels
description = tibble(
  name = var_vec,
  label = label_vec
)

# Create a named list of variable labels
var_labels <- setNames(as.list(description$label), description$name)

# Apply the variable labels to the dataset
followup_MRT_hh_pi <- followup_MRT_hh_pi %>%
  set_variable_labels(.labels = var_labels, .strict = FALSE)



# Create summary statistics table grouped by treatment
balance_tab_1 = followup_MRT_hh_pi %>% 
  dplyr::select(treatment_pi,var_vec) %>%  
  tbl_summary(by = treatment_pi,
              type = (list=var_vec ~ "continuous"),
              statistic = list(all_continuous() ~ "{mean}({sd})"),
              digits = everything() ~ c(2,2), 
              missing = "no") %>% 
  modify_header(label = 'Variable')

# Create vector of treatment binary comparison variables
lst_treatment_bin=paste("treatment_pi_", seq(1,6,1), sep="")

# Adding the variable for the pooled T-test
lst_treatment_bin <- append(lst_treatment_bin, "treat_dum_pi")

# Calculate p-values for each treatment comparison and variable
balance_tab_2 <- purrr::map_dfr(lst_treatment_bin, function(treat_var) {
  df_coef_value <- data.frame(variable = character(), 
                       treatment = character(), 
                       coef_val = character(), 
                       stringsAsFactors = FALSE)
  
  # Loop through each variable and run logistic regression
  for (v_name in var_vec) {
    # Fit logistic regression with clustered standard errors
    reg <- glm(as.formula(paste0(treat_var, " ~ ", v_name, " + strata")), 
               family = binomial, 
               data = followup_MRT_hh_pi)
    
    # Calculate p-value and add significance stars
    coef_val <- round(coeftest(reg, vcovCL(reg, cluster = followup_MRT_hh_pi$cluster))[2, 1], 3)
    pval <- round(coeftest(reg, vcovCL(reg, cluster = followup_MRT_hh_pi$cluster))[2, 4], 3)
    # Add significance stars based on p-value thresholds
    if (pval < 0.01) {
      coef_val <- paste0(as.character(coef_val), "***")
    } else if (pval < 0.05) {
      coef_val <- paste0(as.character(coef_val), "**")
    } else if (pval < 0.1) {
      coef_val <- paste0(as.character(coef_val), "*")
    }else {
       coef_val <- as.character(coef_val)
    }
    
    df_coef_value <- rbind(df_coef_value, data.frame(variable = v_name, 
                                        treatment = treat_var, 
                                        coef_val = coef_val, 
                                        stringsAsFactors = FALSE))
  }
  
  return(df_coef_value)
})

# Reshape p-value table to wide format with treatment comparisons as columns
balance_tab_2 <- balance_tab_2 %>% 
  pivot_wider(id_cols = "variable", 
              names_from = "treatment", 
              values_from = "coef_val") 

# Rename columns to show treatment group comparisons
names(balance_tab_2) <- c("variable","(1)-(2)","(1)-(3)","(1)-(4)",
                     "(2)-(3)","(2)-(4)","(3)-(4)", "Pooled F-test \n P-value")

#Keep the variables of interest
balance_tab_2 <- balance_tab_2 %>% 
  select("(1)-(2)","(1)-(3)","(1)-(4)",
         "(2)-(3)","(2)-(4)","(3)-(4)",
         "Pooled F-test \n P-value")

# Create table for joint F-tests
  
# For each variable, run joint F-test of treatment effects

balance_tab_3 <- purrr::map_dfr(var_vec, function(v_name) { 
  

    # Fit regression model
    model <- lm(as.formula(paste0(v_name, " ~ treatment_pi + strata")), 
                 #family = binomial,
                 data = followup_MRT_hh_pi)

    # Create hypotheses for joint test of treatment effects
    trtmnt_qult_hpthss <- c(
      paste0("treatment_pi",levels(followup_MRT_hh_pi$treatment_pi)[-1][1],
             "=","treatment_pi",levels(followup_MRT_hh_pi$treatment_pi)[-1][2]),
      paste0("treatment_pi",levels(followup_MRT_hh_pi$treatment_pi)[-1][1],
             "=","treatment_pi",levels(followup_MRT_hh_pi$treatment_pi)[-1][3]))

    # Perform joint F-test with clustered standard errors
    joint_f_test <- linearHypothesis(model, 
                                    trtmnt_qult_hpthss,
                                    test = "F", 
                                    vcov. = vcovCL(model, followup_MRT_hh_pi$cluster))

    # Get and format p-value with significance stars
    coef_val_ftest <- round(joint_f_test$`F`[2],3)
    pval <- round(joint_f_test$`Pr(>F)`[2],3)
    if (pval < 0.01) {
      coef_val_ftest <- paste0(as.character(coef_val_ftest), "***")
    } else if (pval < 0.05) {
      coef_val_ftest <- paste0(as.character(coef_val_ftest), "**")
    } else if (pval < 0.1) {
      coef_val_ftest <- paste0(as.character(coef_val_ftest), "*")
    }else {
       coef_val_ftest <- as.character(coef_val_ftest)
    }

    # Add results to balance table
    temp_balance <- tibble(
  "Joint F-test \n P-value" = coef_val_ftest)
    

})
  



myfooter <- followup_MRT_hh_pi %>% 
  dplyr::select(treatment_pi,cluster, strata) %>%  
  group_by(treatment_pi) %>% 
  summarise(nbr_cluster = n_distinct(cluster),
            nbr_strata = n_distinct(strata)) %>% 
  column_to_rownames(var="treatment_pi")

#transpose data frame
myfooter_t <- transpose(myfooter)

#redefine row and column names
rownames(myfooter_t) <- colnames(myfooter)
colnames(myfooter_t) <- balance_tab_1$table_styling$header$label[seq(6,9,1)]

myfooter_t <- tibble::rownames_to_column(myfooter_t, "Variable") %>%
  mutate(Variable=dplyr::recode(Variable, nbr_cluster = "N cluster", nbr_strata = "N strata"))


balance_tab = cbind(
  balance_tab_1,
  balance_tab_2,
  balance_tab_3) %>% 
  relocate("Pooled F-test \n P-value", .after = "Joint F-test \n P-value")

# Adding the row on the nbr of cluster and strata
balance_tab <- plyr::rbind.fill(balance_tab,myfooter_t)

header <- str_squish(str_remove("Table : Balance Table ", "\n"))
# Set Table footer
footer <- str_squish(str_remove("Notes: Standard errors for all tests are clustered at the Social Promotion Space level level. Fixed effects using randomization strata are included in all estimation regressions. The joint F-test shows the p-value from a test of equality of treatment arms. While the pooled F-test shows the p-value from a test of pooled treatment (i.e., a regression with a dummy for any treatment arm). *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n"))
# Set custom_tab() defaults
customtab_defaults()
custom_tab(balance_tab, header, footer)


```
```{r}
# remove data to free space
rm(list = ls())
```
