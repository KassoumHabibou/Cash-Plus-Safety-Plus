---
title: "Cash Plus, Safety Plus? Intimate Partner Violence and Productive Inclusion in Mauritania"
subtitle: "Empirical strategy \& Results"
author: "IBRAHIM KASSOUM Habibou"
date: '`r format (Sys.Date(), "%d %B %Y")`'
output: 
  officedown::rdocx_document:
    mapstyles:
      Normal: ['First Paragraph']
---


```{r setup, include=FALSE}
# Set random seed for reproducibility
set.seed(7654)

# Set number of decimal places to display
options(digits = 3)

# Configure knitr chunk options:
knitr::opts_chunk$set(
 echo = FALSE,          # Don't show R code in output
 message = FALSE,       # Don't show messages
 warning = FALSE,       # Don't show warnings
 cache = FALSE,         # Don't cache results
 fig.align = 'center',  # Center figures
 fig.width = 6.3,         # Figure width in inches
 fig.height= 7,          # Figure height in inches
 fig.asp = 0.8,       # Figure aspect ratio (golden ratio)
 fig.show = "hold"      # Hold multiple plots until end of chunk
)

# Set dplyr print options to show 6 rows max
options(dplyr.print_min = 6, dplyr.print_max = 6)


```


```{r, include=FALSE, results='hide', echo=FALSE}

######################## Importing library and external files ##################
### List of required packages
required_packages <- c("tidyverse", "dplyr","officedown", "officer", "gtsummary",
                       "stargazer", "lfe","labelled","car","broom","purrr",
                       "flextable")

### Check if packages are installed
missing_packages <- setdiff(required_packages, installed.packages()[,"Package"])

### Install missing packages
if (length(missing_packages) > 0) {
  install.packages(missing_packages)
}

### Load all packages
lapply(required_packages, library, character.only = TRUE)

# Remove all objects
rm(list = ls())

# Source functions from external file
source("functions.R")
```


```{r echo=F}

set_gtsummary_theme(theme_gtsummary_compact())

######### Create default BioAVR table from dataframe
#
# Dependencies : dplyr, flextable, officer
# source link : https://www.r-bloggers.com/2021/11/publication-ready-tables-with-flextable-and-own-theme-in-r/
customtab_defaults <- function(){
set_flextable_defaults(font.family = "Times New Roman",
font.size = 10,
border.color = "black")
}
FitFlextableToPage <- function(ft, pgwidth = 8){

  ft_out <- ft %>% autofit()

  ft_out <- width(ft_out, width = dim(ft_out)$widths*pgwidth /(flextable_dim(ft_out)$widths))
  return(ft_out)
}
custom_tab <- function(df, header, footer){
flextable(df) %>%
add_header_lines(header) %>%
add_footer_lines(footer) %>%
bold(i = 1, part = "header") %>%
hline_top(part = "header",
border = fp_border(color = "white",
width = 3,
style = "solid")) %>%
hline(i = 1,
part = "header",
border = fp_border(color = "black",
width = 0.25,
style = "solid")) %>%
hline_top(part = "body",
border = fp_border(color = "black",
width = 0.25,
style = "solid")) %>%
hline_bottom(part = "body",
border = fp_border(color = "black",
width = 0.25,
style = "solid")) %>%
hline_bottom(part = "footer",
border = fp_border(color = "black",
width = 0.25,
style = "solid")) %>%
border_inner_h(part = "body",
border = fp_border(color = "black",
width = 0.25,
style = "dotted")) %>%
autofit(part = "body") %>%
bg(part = "body", bg = "white") %>%
align(part = "all", align = "center") %>%
align(j = 1, part = "all", align = "left")
}
```


```{r}

######################## Loading the datasets ##################################
# Read the file containing the global dataframe into followup_MRT_hh

allrounds_MRT_hh <-  readRDS(paste0("~/Dropbox/PhD thesis/chapitre_5","/output/data/allrounds_MRT_hh.rds"))

baseline_MRT_hh <- readRDS(paste0("~/Dropbox/PhD thesis/chapitre_5","/output/data/baseline_MRT_hh.rds"))

followup_MRT_hh <- readRDS(paste0("~/Dropbox/PhD thesis/chapitre_5","/output/data/followup_MRT_hh_and_ipv_MRT_hh.rds"))

#ipv_df <- readRDS(paste0("~/Dropbox/PhD thesis/chapitre_5","/output/data/ipv_df.rds"))

# follow up_df <- allrounds_MRT_hh %>%  # Keep only relevant phases (the follow up)
#   filter(phase == 2)


# Convert treatment variables from numeric to factor variables for both datasets
# This is useful for regression analysis and plotting as factors are treated as categorical variables

 # Convert PM treatment to factor
baseline_MRT_hh$treatment_pi <- haven::as_factor(baseline_MRT_hh$treatment_pi)          
followup_MRT_hh$treatment_pi <- haven::as_factor(followup_MRT_hh$treatment_pi)
# Convert cash transfer treatment to factor
baseline_MRT_hh$treatment_csh_trnsfr <- haven::as_factor(baseline_MRT_hh$treatment_csh_trnsfr) 
followup_MRT_hh$treatment_csh_trnsfr <- haven::as_factor(followup_MRT_hh$treatment_csh_trnsfr)

```

<!---BLOCK_TOC--->




<!---BLOCK_LANDSCAPE_START--->
\newpage
# Summary


**Overall Effects**

* Most coefficients across all intervention types and IPV measures are statistically non-significant, suggesting that the interventions generally had limited measurable impact on reducing intimate partner violence.
* For some types of violence, especially physical violence and sexual violence, the baseline prevalence is quite low (approximately 1 percent and 4.5 percent respectively), which creates a "floor effect" making detection of significant effects statistically challenging.
* Comparisons between treatment arms (Full vs. Psychosocial, Full vs. Capital, Psychosocial vs. Capital) revealed no statistically significant differences, indicating no clear advantage of one intervention approach over others.


**Heterogeneity Analysis Findings**

The heterogeneity analysis revealed several important differential effects:

* Partner-Controlling Behavior: the Tekavoul cash transfer program increased the risk of partner-controlling behavior specifically for female-headed households. Conversely, partner-controlling behavior decreased for beneficiaries of the productive inclusion program among women with above-median baseline control over household resources.

* Emotional Violence: the productive inclusion program slightly increased the risk of emotional violence for women with low baseline control over household resources, while showing no significant effects for women with high control. Emotional violence increased among Tekavoul program beneficiaries with above-median years of education compared to the control group.

* Physical Violence: no significant effects were detected on physical violence risk, likely due to the low baseline prevalence limiting statistical power.

* Sexual Violence: sexual violence decreased for recipients of the capital and full packages with the highest share of resources owned by their partner. Sexual violence increased for Tekavoul program beneficiaries with above-median years of education compared to the control group.

* Economic Violence: the full package slightly increased the risk of economic violence for productive inclusion program beneficiaries with low baseline control over household resources.

* Other IPV Indicators: little to no effect was found on other IPV indicators across the intervention groups.

\newpage

# Empirical strategy 

**Productive inclusion Program**

We are interested in measuring the causal effect of the productive inclusion on IPV risk at the second follow up survey, which is three years after the start of the intervention. In our base estimation, we take into account the study design and control for the level of stratification by estimating the following model:


$$
Y_{ic} = \beta_0 + \beta_1 Capital_{c} + \beta_2 Psychosocial_{c} + \beta_3 Full_{c} + \beta_4 SP_{c} + \delta_{i} + \epsilon_{i} (1)
$$

$Y_{ic}$ is the IPV outcome of interest for woman *i* from cluster *c* at the second follow up survey, and $SP_{c}$ is a control for the social promotion space which is the level of stratification. $Capital_{c}$, $Phychosocial_{c}$ and $Full_{c}$ are indicators for the treatment group of the cluster *c*. We also include enumerator fixed effect $\delta_{i}$ to control for potential biases that might arise from differences in enumerators characteristics or how they conduct interviews and build rapport with respondents. This is particularly important when measuring sensitive outcomes such as IPV, as reports can vary depending on the interviewer's approach to the respondent. The error term $\epsilon_{i}$ captures unobserved factors affecting IPV outcomes. 
The coefficients $\beta_1$, $\beta_2$ and $\beta_3$ represent the intent-to-treat (ITT) effects of the *capital*, *psychosocial*, and *full* treatment respectively. These coefficients measure the average effect of being assigned to each treatment group compared to the control group. Given the randomized design, these estimates can be interpreted as causal effects as long as the randomization was properly implemented and there are no systematic differences in attrition across treatment arms. To account for the clustered nature of our data and potential correlation of outcomes within clusters, we compute standard errors clustered at the cluster level, which is the unit of randomization. 

**Additionally, we will present results both with and without baseline covariates and variables that are significantly different between treatment and control at baseline at the 10 percent level or lower to check the robustness of our findings and potentially improve precision.** (upcoming)



**Tekavoul Program** 

To estimate the impact of the national cash transfer program (Tekavoul) on IPV risk, the previous equation (1) is modified to the following equation:

$$
Y_{ic} = \theta_0 + \theta_1 CashAssignment_{c} + \theta_2 SP_{c} + \delta_{i} + \epsilon_{i} (2)
$$

Where \( \text{CashAssignment}_{c} \) is an indicator for the assignment to the Tekavoul cash transfer beneficiary of cluster \( c \). The coefficient \( \theta_1 \) represents the intent-to-treat (ITT) effect of the *cash assignment*.


# Results


```{r}

#####################################################################################
######################### Regression on the nbr of event ############################
#####################################################################################

# Define the list of outcomes variables
# control_ipv_vars <- c("control_ipv_12m","control_ipv_r0_12m", "control_ipv_r1_12m")
# emotional_ipv_vars <- c("emo_ipv_ever","emo_ipv_r0_ever","emo_ipv_r1_ever","emo_ipv_12m","emo_ipv_r0_12m","emo_ipv_r1_12m","emo_severity_12m", "emo_severity_12m_z")
# physical_ipv_vars <- c("phy_ipv_ever","phy_ipv_r0_ever","phy_ipv_r1_ever","phy_ipv_12m","phy_ipv_r0_12m","phy_ipv_r1_12m","phy_severity_12m", "phy_severity_12m_z")
# sexual_ipv_vars <- c("sex_ipv_ever", "sex_ipv_r0_ever","sex_ipv_r1_ever","sex_ipv_12m","sex_ipv_r0_12m","sex_ipv_r1_12m","sex_severity_12m", "sex_severity_12m_z")
# economic_ipv_vars <- c("eco_ipv_ever","eco_ipv_r0_ever","eco_ipv_r1_ever","eco_ipv_12m","eco_ipv_r0_12m","eco_ipv_r1_12m","eco_severity_12m", "eco_severity_12m_z")
# other_ipv_vars <- c("ipv_all_12m","ipv_all2_12m","ipv_all_r0_12m","ipv_all_r1_12m")


control_ipv_vars <- c("control_ipv_12m","control_ipv_inten_index")
emotional_ipv_vars <- c("emo_ipv_12m","emo_ipv_inten_index","emo_severity_12m", "emo_severity_12m_z")
physical_ipv_vars <- c("phy_ipv_12m","phy_ipv_inten_index","phy_severity_12m", "phy_severity_12m_z")
sexual_ipv_vars <- c("sex_ipv_12m","sex_ipv_inten_index","sex_severity_12m", "sex_severity_12m_z")
economic_ipv_vars <- c("eco_ipv_12m","eco_ipv_inten_index","eco_severity_12m", "eco_severity_12m_z")
other_ipv_vars <- c("ipv_all_12m","ipv_all2_12m","all_ipv_inten_index")

# All outcomes variables
listOutcomes=c(control_ipv_vars, emotional_ipv_vars, physical_ipv_vars, sexual_ipv_vars, economic_ipv_vars, other_ipv_vars)


# Define the two treatment variables ("treatment_csh_trnsfr",)
treatment_vars=c("treatment_csh_trnsfr","treatment_pi","treatment_pi_pool")

# Label for the treatment variables
labels_vars = c("Cash transfert","Capital","Psychosocial","Full")

# Define controls variables for the regression 
control_vars = c("hhh_fem_bl", "mem_n_bl")

# Define strata variables
strata_vars <- c("strata") 

# Define cluster variables 
cluster_vars <- c("cluster")

followup_MRT_hh_control <- followup_MRT_hh %>% filter(treatment_pi=="Control")

# Title for each index
control_ipv_title = "**Table : effect of the program on controlling Behavior**"
emotional_ipv_title = "**Table : effect of the program on emotional violence**"
physical_ipv_title = "**Table : effect of the program on physical violence**"
sexual_ipv_title = "**Table : effect of the program on sexual violence**"
economic_ipv_title = "**Table : effect of the program on economic violence**"
other_ipv_title = "**Table : effect of the program on other ipv index**"


```

## Controlling Behavior

```{r}
######################## Fist estimate ##########################################


# Use map_dfr to iterate over each outcome and estimate effects for different treatment variables
mainResults <- map_dfr(treatment_vars, function(curr_treat_var) {
  tempResults <- map_dfr(control_ipv_vars, function(depvar) {    
    bind_rows(
      getEstimateGlobal(depvar, curr_treat_var, control_vars, strata_vars, cluster_vars, followup_MRT_hh) %>%
        mutate(depvar = depvar, curr_treat_var = curr_treat_var)
    )
  })
})

# Extract results for different outcomes variables 
## Cash transfer regression models
# Extract specific models for cash transfer from the main results
m11 <- mainResults$results_base[[1]]  # First cash transfer model
m12 <- mainResults$results_base[[2]]  # Second cash transfer model
#m13 <- mainResults$results_base[[3]]  # Third cash transfer model
# Alternative way to filter cash transfer models from the dataset
m1 <- mainResults %>% 
  filter(curr_treat_var=="treatment_csh_trnsfr") %>% 
  select(results_base) %>% 
  as.list()

## Productive inclusion regression models
# Extract specific models for productive inclusion from the main results
m21 <- mainResults$results_base[[3]]  # First productive inclusion model
m22 <- mainResults$results_base[[4]]  # Second productive inclusion model
#m23 <- mainResults$results_base[[6]]  # Third productive inclusion model
m31 <- mainResults$results_base[[5]]  # First pool productive inclusion model
m32 <- mainResults$results_base[[6]]  # Second pool productive inclusion model
#m33 <- mainResults$results_base[[9]]  # Third pool productive inclusion model
# Alternative way to filter productive inclusion models from the dataset
m2 <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(results_base) %>% 
  as.list()

# Extract interaction terms for productive inclusion treatments
# Full Psychosocial interaction term
full_Psychosocial <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(full_Psychosocial) %>% 
  pull() %>% 
  as.numeric()

# Full Capital interaction term
full_Capital <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(full_Capital) %>% 
  pull() %>% 
  as.numeric()

# Psychosocial and Capital interaction term
psychosocial_Capital <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(psychosocial_Capital) %>% 
  pull() %>% 
  as.numeric()

# Initialize empty vectors to store descriptive statistics
# These will store mean and standard deviation for each outcome variable
mean_values <- c()  # Vector to store mean values
sd_values <- c()   # Vector to store standard deviation values

# Calculate descriptive statistics for each outcome variable
# Loop through the list of outcome variables
for (depvar in control_ipv_vars) {
  # Calculate and round mean, ignoring NA values
  mean_values <- c(mean_values,  round(mean(followup_MRT_hh_control[[depvar]], na.rm = TRUE), 3))
  
  # Calculate and round standard deviation, ignoring NA values
  sd_values <- c(sd_values,  round(sd(followup_MRT_hh_control[[depvar]], na.rm = TRUE), 3))
}

# Create lists of models for easier processing
models_pi <- list(m21, m22)  # Productive inclusion models
models_pi_pool <- list(m31, m32)  # Productive inclusion models pool
models_csh_trnsfr <- list(m11, m12)  # Cash transfer models

# Create regression tables for Productive Inclusion models
tbl_list_pi <- map(models_pi, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is 
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_pi")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})",
                         hide_se = TRUE) %>%
  add_glance_table(include = c(nobs, r.squared)))

tbl_list_pi_pool <- map(models_pi_pool, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is 
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_pi_pool")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})",
                         hide_se = TRUE)%>%
  add_glance_table(include = c(nobs, r.squared)))

# Create regression tables for Cash Transfer models
tbl_list_csh_trnsfr <- map(models_csh_trnsfr, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_csh_trnsfr")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})",
                         hide_se = TRUE)%>%
  add_glance_table(include = c(nobs, r.squared)))

# Modify headers for the Productive Inclusion and Cash Transfer models
## Refusal = missing
# tbl_list_pi[[1]] <- tbl_list_pi[[1]] %>%
#    modify_header(estimate = "**lst 12 mnths \n Refusal = missing**")
# 
# tbl_list_csh_trnsfr[[1]] <- tbl_list_csh_trnsfr[[1]] %>%
#    modify_header(estimate = "**lst 12 mnths \n Refusal = missing**")
# 
# tbl_list_pi_pool[[1]] <- tbl_list_pi_pool[[1]] %>%
#    modify_header(estimate = "**lst 12 mnths \n Refusal = missing**")
# 
# ## Refusal = 0
# tbl_list_pi[[2]] <- tbl_list_pi[[2]] %>%
#    modify_header(estimate = "**lst 12 mnths \n Refusal = 0**")
# 
# tbl_list_csh_trnsfr[[2]] <- tbl_list_csh_trnsfr[[2]] %>%
#    modify_header(estimate = "**lst 12 mnths \n Refusal = 0**")
# 
# tbl_list_pi_pool[[2]] <- tbl_list_pi_pool[[2]] %>%
#    modify_header(estimate = "**lst 12 mnths \n Refusal = 0**")
#  
# ## Refusal = 1
# tbl_list_pi[[3]] <- tbl_list_pi[[3]] %>%
#    modify_header(estimate = "**lst 12 mnths \n Refusal = 1**")
# 
# tbl_list_csh_trnsfr[[3]] <- tbl_list_csh_trnsfr[[3]] %>%
#    modify_header(estimate = "**lst 12 mnths \n Refusal = 1**")
# 
# tbl_list_pi_pool[[3]] <- tbl_list_pi_pool[[3]] %>%
#    modify_header(estimate = "**lst 12 mnths \n Refusal = 1**")

tbl_list_pi[[1]] <- tbl_list_pi[[1]] %>%
   modify_header(estimate = "Binary for \n control IPV In the \n last 12 months")

tbl_list_csh_trnsfr[[1]] <- tbl_list_csh_trnsfr[[1]] %>%
   modify_header(estimate = "Binary for \n control IPV In the \n last 12 months")

tbl_list_pi_pool[[1]] <- tbl_list_pi_pool[[1]] %>%
   modify_header(estimate = "Binary for \n control IPV In the \n last 12 months")

## Refusal = 0
tbl_list_pi[[2]] <- tbl_list_pi[[2]] %>%
   modify_header(estimate = "Control \n IPV intensity \n index z-scr")

tbl_list_csh_trnsfr[[2]] <- tbl_list_csh_trnsfr[[2]] %>%
   modify_header(estimate = "Control \n IPV intensity \n index z-scr")

tbl_list_pi_pool[[2]] <- tbl_list_pi_pool[[2]] %>%
   modify_header(estimate = "Control \n IPV intensity \n index z-scr")
 

# tbl_list = list(
#   tbl_stack(list(tbl_list_csh_trnsfr[[1]], tbl_list_pi[[1]], tbl_list_pi_pool[[1]])),  # First models (Refusal = missing)
#   tbl_stack(list(tbl_list_csh_trnsfr[[2]], tbl_list_pi[[2]], tbl_list_pi_pool[[2]])),  # Second models (Refusal = 0)
#   tbl_stack(list(tbl_list_csh_trnsfr[[3]], tbl_list_pi[[3]], tbl_list_pi_pool[[3]]))  # Third models (Refusal = 1)
# )

# Merge the stacked tables into a single table with column headers
# tbl <- tbl_merge(
#   tbls = tbl_list,
#   tab_spanner = c("(1)", "(2)", "(3)")
# )

# Merge the stacked tables into a single table with column headers
## Cash transfert
tbl_csh_trnsfr <- tbl_merge(
  tbls = list(tbl_list_csh_trnsfr[[1]],# First models (Refusal = missing)
              tbl_list_csh_trnsfr[[2]] # Second models (Refusal = 0)
              # tbl_list_csh_trnsfr[[3]]
              ),  # Third models (Refusal = 1)
  tab_spanner = c("(1)", "(2)")
)

## Productive inclusion
tbl_pi <- tbl_merge(
  tbls = list(tbl_list_pi[[1]], # First models (Refusal = missing)
              tbl_list_pi[[2]] # Second models (Refusal = 0)
              # tbl_list_pi[[3]]
              ), # Third models (Refusal = 1)
  tab_spanner = c("(1)", "(2)")
)

## Pool Productive inclusion
tbl_pi_pool <- tbl_merge(
  tbls = list(tbl_list_pi_pool[[1]], # First models (Refusal = missing)
              tbl_list_pi_pool[[2]] # Second models (Refusal = 0)
              # tbl_list_pi_pool[[3]]
              ), # Third models (Refusal = 1)
  tab_spanner = c("(1)", "(2)")
)

# Create a list of stacked tables combining Cash Transfer and Productive Inclusion models
# Each list element combines the corresponding models from both treatment types
tbl <- tbl_stack(list(tbl_csh_trnsfr, tbl_pi, tbl_pi_pool))

# Modify table body to customize variable labels
tbl <- tbl %>%
  modify_table_body(~ .x %>%
                      mutate(label = case_when(
                        # Rename specific treatment variables
                        variable == "treatment_piCapital" ~ "Capital",
                        variable == "treatment_piPsychosocial" ~ "Psychosocial",
                        variable == "treatment_piFull" ~ "Full",
                        variable == "treatment_pi_poolPool" ~ "Full",
                        # Label cash transfer and productive inclusion treatments
                        variable == "treatment_csh_trnsfr" & is.na(term_1) ~ "Tekavoul",
                        variable == "treatment_pi"& is.na(term_1) ~ "Productive Inclusion",
                        variable == "treatment_pi_pool"& is.na(term_1) ~ "Productive Inclusion (Pool)",
                        TRUE ~ label  # Keep original labels for other variables
                      )))

# Create a tribble (transposed tibble) with additional rows for the table
# These rows include control mean, standard deviation, and interaction terms
additional_rows <- tribble(
  ~variable,  ~var_label, ~label, ~estimate_1, ~estimate_2, 
  "Control mean @ follow up-2","Control mean @ follow up-2","Control mean @ follow up-2",mean_values[1], mean_values[2], 
  "Control SD @ follow up-2","Control SD @ follow up-2","Control SD @ follow up-2",  sd_values[1], sd_values[2], 
  "Full - Psychosocial","Full - Psychosocial","Full - Psychosocial",   full_Psychosocial[1], full_Psychosocial[2], 
  "Full - Capital","Full - Capital", "Full - Capital", full_Capital[1], full_Capital[2], 
  "Psychosocial - Capital","Psychosocial - Capital","Psychosocial - Capital",  psychosocial_Capital[1], psychosocial_Capital[2]
)

# Append the additional rows to the table body
tbl$table_body <- bind_rows(tbl$table_body, additional_rows)

# Final table formatting
tbl <- tbl %>%
  # Set table caption
  modify_caption(control_ipv_title) %>%
  # Modify header for the label column
  modify_header(label = "**Outcome**") %>%
  # Remove all existing footnotes
  modify_footnote(everything() ~ NA) %>%
  modify_footnote(all_stat_cols() ~ NA) %>%
  # Add custom footnote with methodological details
  modify_footnote(label = "Notes: Results presented are OLS estimates that include controls for randomization strata (commune) and, where possible, baseline outcomes.  We control for social promotion intervention. Enumerator fixed effects are included in all regression. We estimate the regressions for the productive beneficiaries aged 18-49 only. Robust standard errors are shown in parentheses, clustered at the village proxy level. *** p < 0.01, ** p < 0.05, * p < 0.1.")

# Print the final table
tbl

# Generate a latex table using stargazer to display the regression results
# Capture the output of stargazer as text

# stargazer(m21,m22,m23,
#           title = "", digits = 2, float = TRUE, 
#           se.position = "below", type = "text", 
#           omit.stat = c("LL", "ser", "f", "adj.rsq", "res.dev"), 
#           dep.var.labels.include = FALSE, font.size = "small",
#           notes.align = "l", table.placement = "H", header = F,
#           column.labels = c("lst 12 mnths", 
#                             "lst 12 mnths - Refusal = 0", 
#                             "lst 12 mnths - Refusal = 1"),
#           keep = c("treatment_piCapital", "treatment_piPsychosocial", "treatment_piFull"),
#           covariate.labels = c("Capital","Psychosocial","Full"),
#           add.lines = list(c('Baseline Controls', 'Yes', 'Yes', 'Yes'),
#                            c('Control mean @ follow up-2', mean_values),
#                            c('Control SD @ follow up-2', sd_values),
#                            c("Full - Psychosocial",full_Psychosocial),
#                            c("Full - Capital",full_Capital),
#                            c("Psychosocial - Capital",psychosocial_Capital)),
#           out = "output/table/main results/controlling_behavior_index.text", 
#           notes = "")


# header <- str_squish(str_remove("Table : Effect of the controlling Behavior index", "\n"))
# # Set Table footer
# footer <- str_squish(str_remove("Notes: Results presented are OLS estimates that include controls for randomization strata (commune) and, where possible, baseline outcomes. We control for social promotion intervention. Enumerator fixed effects are included in all regression. We estimate the regressions for the productive beneficiaries aged 18-49 only. Robust standard errors are shown in parentheses, clustered at the village proxy level. *** p < 0.01, ** p < 0.05, * p < 0.1.", "\n"))
# # Set custom_tab() defaults
# customtab_defaults()
# custom_tab(table_output, header, footer)



```

## Emotional Violence

```{r}
######################## Fist estimate ##########################################


# Use map_dfr to iterate over each outcome and estimate effects for different treatment variables
mainResults <- map_dfr(treatment_vars, function(curr_treat_var) {
  tempResults <- map_dfr(emotional_ipv_vars, function(depvar) {    
    bind_rows(
      getEstimateGlobal(depvar, curr_treat_var, control_vars, strata_vars, cluster_vars, followup_MRT_hh) %>%
        mutate(depvar = depvar, curr_treat_var = curr_treat_var)
    )
  })
})

# Extract results for different outcomes variables 
## Cash transfer regression models
# Extract specific models for cash transfer from the main results
m11 <- mainResults$results_base[[1]]  # First cash transfer model
m12 <- mainResults$results_base[[2]]  # Second cash transfer model
m13 <- mainResults$results_base[[3]]  # Third cash transfer model
m14 <- mainResults$results_base[[4]] 
# m15 <- mainResults$results_base[[5]]  
# m16 <- mainResults$results_base[[6]]  
# m17 <- mainResults$results_base[[7]]  
# m18 <- mainResults$results_base[[8]]  
# Alternative way to filter cash transfer models from the dataset
m1 <- mainResults %>% 
  filter(curr_treat_var=="treatment_csh_trnsfr") %>% 
  select(results_base) %>% 
  as.list()

## Productive inclusion regression models
# Extract specific models for productive inclusion from the main results
m21 <- mainResults$results_base[[5]]  # First productive inclusion model
m22 <- mainResults$results_base[[6]]  # Second productive inclusion model
m23 <- mainResults$results_base[[7]]  # Third productive inclusion model
m24 <- mainResults$results_base[[8]]  
#m25 <- mainResults$results_base[[10]]  
# m26 <- mainResults$results_base[[14]]  
# m27 <- mainResults$results_base[[15]]  
# m28 <- mainResults$results_base[[16]]  

m31 <- mainResults$results_base[[9]]  # First pool productive inclusion model
m32 <- mainResults$results_base[[10]]  # Second pool productive inclusion model
m33 <- mainResults$results_base[[11]]  # Third pool productive inclusion model
m34 <- mainResults$results_base[[12]]  
#m35 <- mainResults$results_base[[15]]  
# m36 <- mainResults$results_base[[22]] 
# m37 <- mainResults$results_base[[23]]  
# m38 <- mainResults$results_base[[24]] 

# Alternative way to filter productive inclusion models from the dataset
m2 <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(results_base) %>% 
  as.list()

# Extract interaction terms for productive inclusion treatments
# Full Psychosocial interaction term
full_Psychosocial <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(full_Psychosocial) %>% 
  pull() %>% 
  as.numeric()

# Full Capital interaction term
full_Capital <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(full_Capital) %>% 
  pull() %>% 
  as.numeric()

# Psychosocial and Capital interaction term
psychosocial_Capital <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(psychosocial_Capital) %>% 
  pull() %>% 
  as.numeric()

# Initialize empty vectors to store descriptive statistics
# These will store mean and standard deviation for each outcome variable
mean_values <- c()  # Vector to store mean values
sd_values <- c()   # Vector to store standard deviation values

# Calculate descriptive statistics for each outcome variable
# Loop through the list of outcome variables
for (depvar in emotional_ipv_vars) {
  # Calculate and round mean, ignoring NA values
  mean_values <- c(mean_values,  round(mean(followup_MRT_hh_control[[depvar]], na.rm = TRUE), 3))
  
  # Calculate and round standard deviation, ignoring NA values
  sd_values <- c(sd_values,  round(sd(followup_MRT_hh_control[[depvar]], na.rm = TRUE), 3))
}

# Create lists of models for easier processing
models_pi <- list(m21, m22, m23, m24)  # Productive inclusion models
models_pi_pool <- list(m31, m32, m33, m34)  # Productive inclusion models pool
models_csh_trnsfr <- list(m11, m12, m13, m14)  # Cash transfer models

# Create regression tables for Productive Inclusion models
tbl_list_pi <- map(models_pi, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is 
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_pi")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})",
                         hide_se = TRUE) %>%
  add_glance_table(include = c(nobs, r.squared)))

tbl_list_pi_pool <- map(models_pi_pool, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is 
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_pi_pool")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})",
                         hide_se = TRUE)%>%
  add_glance_table(include = c(nobs, r.squared)))

# Create regression tables for Cash Transfer models
tbl_list_csh_trnsfr <- map(models_csh_trnsfr, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_csh_trnsfr")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})",
                         hide_se = TRUE)%>%
  add_glance_table(include = c(nobs, r.squared)))

# Modify headers for the Productive Inclusion and Cash Transfer models
## for : ever
### Refusal = missing
# tbl_list_pi[[1]] <- tbl_list_pi[[1]] %>%
#    modify_header(estimate = "Binary \n for emo. \n IPV ever")
# 
# tbl_list_csh_trnsfr[[1]] <- tbl_list_csh_trnsfr[[1]] %>%
#    modify_header(estimate = "Binary \n for emo. \n IPV ever")
# 
# tbl_list_pi_pool[[1]] <- tbl_list_pi_pool[[1]] %>%
#    modify_header(estimate = "Binary \n for emo. \n IPV ever")
# 

tbl_list_pi[[1]] <- tbl_list_pi[[1]] %>%
   modify_header(estimate = "Binary \n for emo. IPV \n in the last 12 months")

tbl_list_csh_trnsfr[[1]] <- tbl_list_csh_trnsfr[[1]] %>%
   modify_header(estimate = "Binary \n for emo. IPV \n in the last 12 months")

tbl_list_pi_pool[[1]] <- tbl_list_pi_pool[[1]] %>%
   modify_header(estimate = "Binary \n for emo. IPV \n in the last 12 months")
 

tbl_list_pi[[2]] <- tbl_list_pi[[2]] %>%
   modify_header(estimate = "Emo. \n IPV intensity \n index z-scr")

tbl_list_csh_trnsfr[[2]] <- tbl_list_csh_trnsfr[[2]] %>%
   modify_header(estimate = "Emo. \n IPV intensity \n index z-scr")

tbl_list_pi_pool[[2]] <- tbl_list_pi_pool[[2]] %>%
   modify_header(estimate = "Emo. \n IPV intensity \n index z-scr")


tbl_list_pi[[3]] <- tbl_list_pi[[3]] %>%
   modify_header(estimate = "Emo. \n IPV severity \n index")

tbl_list_csh_trnsfr[[3]] <- tbl_list_csh_trnsfr[[3]] %>%
   modify_header(estimate = "Emo. \n IPV severity \n index")

tbl_list_pi_pool[[3]] <- tbl_list_pi_pool[[3]] %>%
   modify_header(estimate = "Emo. \n IPV severity \n index")


tbl_list_pi[[4]] <- tbl_list_pi[[4]] %>%
   modify_header(estimate = "Emo. \n IPV severity \n index z-scr")

tbl_list_csh_trnsfr[[4]] <- tbl_list_csh_trnsfr[[4]] %>%
   modify_header(estimate = "Emo. \n IPV severity \n index z-scr")

tbl_list_pi_pool[[4]] <- tbl_list_pi_pool[[4]] %>%
   modify_header(estimate = "Emo. \n IPV severity \n index z-scr")
 
# ## Refusal = 1
# tbl_list_pi[[6]] <- tbl_list_pi[[6]] %>%
#    modify_header(estimate = "**lst 12 mnths \n Refusal = 1**")
# 
# tbl_list_csh_trnsfr[[6]] <- tbl_list_csh_trnsfr[[6]] %>%
#    modify_header(estimate = "**lst 12 mnths \n Refusal = 1**")
# 
# tbl_list_pi_pool[[6]] <- tbl_list_pi_pool[[6]] %>%
#    modify_header(estimate = "**lst 12 mnths \n Refusal = 1**")
# 
# ## for : Severity in last 12 months
# ### Severity index
# tbl_list_pi[[7]] <- tbl_list_pi[[7]] %>%
#    modify_header(estimate = "**Severity index**")
# 
# tbl_list_csh_trnsfr[[7]] <- tbl_list_csh_trnsfr[[7]] %>%
#    modify_header(estimate = "**Severity index**")
# 
# tbl_list_pi_pool[[7]] <- tbl_list_pi_pool[[7]] %>%
#    modify_header(estimate = "**Severity index**")
# 
# ## Severity index z-scr
# tbl_list_pi[[8]] <- tbl_list_pi[[8]] %>%
#    modify_header(estimate = "**Severity index z-scr**")
# 
# tbl_list_csh_trnsfr[[8]] <- tbl_list_csh_trnsfr[[8]] %>%
#    modify_header(estimate = "**Severity index z-scr**")
# 



# Merge the stacked tables into a single table with column headers

tbl_csh_trnsfr <- tbl_merge(
  tbls = list(tbl_list_csh_trnsfr[[1]],# Ever: First models (Refusal = missing)
              tbl_list_csh_trnsfr[[2]], # Ever: Second models (Refusal = 0)
              tbl_list_csh_trnsfr[[3]],  # Ever: Third models (Refusal = 1)
              tbl_list_csh_trnsfr[[4]]# lst 12 mnths: First models (Refusal = missing)
              # tbl_list_csh_trnsfr[[5]] # lst 12 mnths: Second models (Refusal = 0)
              # tbl_list_csh_trnsfr[[6]],# lst 12 mnths: Third models (Refusal = 1)
              # tbl_list_csh_trnsfr[[7]], # Severity index
              # tbl_list_csh_trnsfr[[8]]# Severity index z-scr
              ),  # lst 12 mnths: Third models (Refusal = 1)
  tab_spanner = c("(1)", "(2)", "(3)", "(4)")
)

## Productive inclusion
tbl_pi <- tbl_merge(
  tbls = list(tbl_list_pi[[1]],# Ever: First models (Refusal = missing)
              tbl_list_pi[[2]], # Ever: Second models (Refusal = 0)
              tbl_list_pi[[3]],  # Ever: Third models (Refusal = 1)
              tbl_list_pi[[4]]# lst 12 mnths: First models (Refusal = missing)
              # tbl_list_pi[[5]] # lst 12 mnths: Second models (Refusal = 0)
              # tbl_list_pi[[6]],# lst 12 mnths: Third models (Refusal = 1)
              # tbl_list_pi[[7]], # Severity index
              # tbl_list_pi[[8]]
              ),# Severity index z-scr
  tab_spanner = c("(1)", "(2)", "(3)", "(4)")
)

## Pool Productive inclusion
tbl_pi_pool <- tbl_merge(
  tbls = list(tbl_list_pi_pool[[1]],# Ever: First models (Refusal = missing)
              tbl_list_pi_pool[[2]], # Ever: Second models (Refusal = 0)
              tbl_list_pi_pool[[3]],  # Ever: Third models (Refusal = 1)
              tbl_list_pi_pool[[4]]# lst 12 mnths: First models (Refusal = missing)
              # tbl_list_pi_pool[[5]] # lst 12 mnths: Second models (Refusal = 0)
              # tbl_list_pi_pool[[6]],# lst 12 mnths: Third models (Refusal = 1)
              # tbl_list_pi_pool[[7]], # Severity index
              # tbl_list_pi_pool[[8]]
              ),# Severity index z-scr
  tab_spanner = c("(1)", "(2)", "(3)", "(4)")
)

# Create a list of stacked tables combining Cash Transfer and Productive Inclusion models
# Each list element combines the corresponding models from both treatment types
tbl <- tbl_stack(list(tbl_csh_trnsfr, tbl_pi, tbl_pi_pool))

# Modify table body to customize variable labels
tbl <- tbl %>%
  modify_table_body(~ .x %>%
                      mutate(label = case_when(
                        # Rename specific treatment variables
                        variable == "treatment_piCapital" ~ "Capital",
                        variable == "treatment_piPsychosocial" ~ "Psychosocial",
                        variable == "treatment_piFull" ~ "Full",
                        variable == "treatment_pi_poolPool" ~ "Full",
                        # Label cash transfer and productive inclusion treatments
                        variable == "treatment_csh_trnsfr" & is.na(term_1) ~ "Tekavoul",
                        variable == "treatment_pi"& is.na(term_1) ~ "Productive Inclusion",
                        variable == "treatment_pi_pool"& is.na(term_1) ~ "Productive Inclusion (Pool)",
                        TRUE ~ label  # Keep original labels for other variables
                      )))

# Create a tribble (transposed tibble) with additional rows for the table
# These rows include control mean, standard deviation, and interaction terms
additional_rows <- tribble(
  ~variable,  ~var_label, ~label, ~estimate_1, ~estimate_2, ~estimate_3, ~estimate_4, 
  "Control mean @ follow up-2","Control mean @ follow up-2","Control mean @ follow up-2", mean_values[1], mean_values[2], mean_values[3], mean_values[4], 
  "Control SD @ follow up-2","Control SD @ follow up-2","Control SD @ follow up-2",  sd_values[1], sd_values[2], sd_values[3], sd_values[4], 
  "Full - Psychosocial","Full - Psychosocial","Full - Psychosocial",   full_Psychosocial[1], full_Psychosocial[2], full_Psychosocial[3], full_Psychosocial[4], 
  "Full - Capital","Full - Capital", "Full - Capital", full_Capital[1], full_Capital[2], full_Capital[3], full_Capital[4], 
  "Psychosocial - Capital","Psychosocial - Capital","Psychosocial - Capital",  psychosocial_Capital[1], psychosocial_Capital[2], psychosocial_Capital[3], psychosocial_Capital[4]
)

# Append the additional rows to the table body
tbl$table_body <- bind_rows(tbl$table_body, additional_rows)

# Final table formatting
tbl <- tbl %>%
  # Set table caption
  modify_caption(emotional_ipv_title) %>%
  # Modify header for the label column
  modify_header(label = "**Outcome**") %>%
  # Remove all existing footnotes
  modify_footnote(everything() ~ NA) %>%
  modify_footnote(all_stat_cols() ~ NA) %>%
  # Add custom footnote with methodological details
  modify_footnote(label = "Notes: Results presented are OLS estimates that include controls for randomization strata (commune) and, where possible, baseline outcomes.  We control for social promotion intervention. Enumerator fixed effects are included in all regression. We estimate the regressions for the productive beneficiaries aged 18-49 only. Robust standard errors are shown in parentheses, clustered at the village proxy level. *** p < 0.01, ** p < 0.05, * p < 0.1.")

# Print the final table
tbl

```


## Physical Violence

```{r}
######################## Fist estimate ##########################################

# Use map_dfr to iterate over each outcome and estimate effects for different treatment variables
mainResults <- map_dfr(treatment_vars, function(curr_treat_var) {
  tempResults <- map_dfr(physical_ipv_vars, function(depvar) {    
    bind_rows(
      getEstimateGlobal(depvar, curr_treat_var, control_vars, strata_vars, cluster_vars, followup_MRT_hh) %>%
        mutate(depvar = depvar, curr_treat_var = curr_treat_var)
    )
  })
})

# Extract results for different outcomes variables 
## Cash transfer regression models
# Extract specific models for cash transfer from the main results
m11 <- mainResults$results_base[[1]]  # First cash transfer model
m12 <- mainResults$results_base[[2]]  # Second cash transfer model
m13 <- mainResults$results_base[[3]]  # Third cash transfer model
m14 <- mainResults$results_base[[4]] 
# m15 <- mainResults$results_base[[5]]  
# m16 <- mainResults$results_base[[6]]  
# m17 <- mainResults$results_base[[7]]  
# m18 <- mainResults$results_base[[8]]  

## Productive inclusion regression models
# Extract specific models for productive inclusion from the main results
m21 <- mainResults$results_base[[5]]  # First productive inclusion model
m22 <- mainResults$results_base[[6]]  # Second productive inclusion model
m23 <- mainResults$results_base[[7]]  # Third productive inclusion model
m24 <- mainResults$results_base[[8]]  
#m25 <- mainResults$results_base[[10]]  
# m26 <- mainResults$results_base[[14]]  
# m27 <- mainResults$results_base[[15]]  
# m28 <- mainResults$results_base[[16]]  

m31 <- mainResults$results_base[[9]]  # First pool productive inclusion model
m32 <- mainResults$results_base[[10]]  # Second pool productive inclusion model
m33 <- mainResults$results_base[[11]]  # Third pool productive inclusion model
m34 <- mainResults$results_base[[12]]  
#m35 <- mainResults$results_base[[15]]  
# m36 <- mainResults$results_base[[22]] 
# m37 <- mainResults$results_base[[23]]  
# m38 <- mainResults$results_base[[24]] 

# Alternative way to filter cash transfer models from the dataset
m1 <- mainResults %>% 
  filter(curr_treat_var=="treatment_csh_trnsfr") %>% 
  select(results_base) %>% 
  as.list()

# Alternative way to filter productive inclusion models from the dataset
m2 <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(results_base) %>% 
  as.list()

# Extract interaction terms for productive inclusion treatments
# Full Psychosocial interaction term
full_Psychosocial <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(full_Psychosocial) %>% 
  pull() %>% 
  as.numeric()

# Full Capital interaction term
full_Capital <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(full_Capital) %>% 
  pull() %>% 
  as.numeric()

# Psychosocial and Capital interaction term
psychosocial_Capital <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(psychosocial_Capital) %>% 
  pull() %>% 
  as.numeric()

# Initialize empty vectors to store descriptive statistics
# These will store mean and standard deviation for each outcome variable
mean_values <- c()  # Vector to store mean values
sd_values <- c()   # Vector to store standard deviation values

# Calculate descriptive statistics for each outcome variable
# Loop through the list of outcome variables
for (depvar in physical_ipv_vars) {
  # Calculate and round mean, ignoring NA values
  mean_values <- c(mean_values,  round(mean(followup_MRT_hh_control[[depvar]], na.rm = TRUE), 3))
  
  # Calculate and round standard deviation, ignoring NA values
  sd_values <- c(sd_values,  round(sd(followup_MRT_hh_control[[depvar]], na.rm = TRUE), 3))
}

# Create lists of models for easier processing
models_pi <- list(m21, m22, m23, m24)  # Productive inclusion models
models_pi_pool <- list(m31, m32, m33, m34)  # Productive inclusion models pool
models_csh_trnsfr <- list(m11, m12, m13, m14)  # Cash transfer models

# Create regression tables for Productive Inclusion models
tbl_list_pi <- map(models_pi, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is 
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_pi")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})",
                         hide_se = TRUE) %>%
  add_glance_table(include = c(nobs, r.squared)))

tbl_list_pi_pool <- map(models_pi_pool, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is 
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_pi_pool")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})",
                         hide_se = TRUE)%>%
  add_glance_table(include = c(nobs, r.squared)))

# Create regression tables for Cash Transfer models
tbl_list_csh_trnsfr <- map(models_csh_trnsfr, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_csh_trnsfr")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})",
                         hide_se = TRUE)%>%
  add_glance_table(include = c(nobs, r.squared)))

# Modify headers for the Productive Inclusion and Cash Transfer models
# tbl_list_pi[[1]] <- tbl_list_pi[[1]] %>%
#    modify_header(estimate = "Binary \n for phy. \n IPV ever")
# 
# tbl_list_csh_trnsfr[[1]] <- tbl_list_csh_trnsfr[[1]] %>%
#    modify_header(estimate = "Binary \n for phy. \n IPV ever")
# 
# tbl_list_pi_pool[[1]] <- tbl_list_pi_pool[[1]] %>%
#    modify_header(estimate = "Binary \n for phy. \n IPV ever")


tbl_list_pi[[1]] <- tbl_list_pi[[1]] %>%
   modify_header(estimate = "Binary \n for phy. IPV \n in the last 12 months")

tbl_list_csh_trnsfr[[1]] <- tbl_list_csh_trnsfr[[1]] %>%
   modify_header(estimate = "Binary \n for phy. IPV \n in the last 12 months")

tbl_list_pi_pool[[1]] <- tbl_list_pi_pool[[1]] %>%
   modify_header(estimate = "Binary \n for phy. IPV \n in the last 12 months")
 

tbl_list_pi[[2]] <- tbl_list_pi[[2]] %>%
   modify_header(estimate = "Phy. \n IPV intensity \n index z-scr")

tbl_list_csh_trnsfr[[2]] <- tbl_list_csh_trnsfr[[2]] %>%
   modify_header(estimate = "Phy. \n IPV intensity \n index z-scr")

tbl_list_pi_pool[[2]] <- tbl_list_pi_pool[[2]] %>%
   modify_header(estimate = "Phy. \n IPV intensity \n index z-scr")


tbl_list_pi[[3]] <- tbl_list_pi[[3]] %>%
   modify_header(estimate = "Phy. \n IPV severity \n index")

tbl_list_csh_trnsfr[[3]] <- tbl_list_csh_trnsfr[[3]] %>%
   modify_header(estimate = "Phy. \n IPV severity \n index")

tbl_list_pi_pool[[3]] <- tbl_list_pi_pool[[3]] %>%
   modify_header(estimate = "Phy. \n IPV severity \n index")


tbl_list_pi[[4]] <- tbl_list_pi[[4]] %>%
   modify_header(estimate = "Phy. \n IPV severity \n index z-scr")

tbl_list_csh_trnsfr[[4]] <- tbl_list_csh_trnsfr[[4]] %>%
   modify_header(estimate = "Phy. \n IPV severity \n index z-scr")

tbl_list_pi_pool[[4]] <- tbl_list_pi_pool[[4]] %>%
   modify_header(estimate = "Phy. \n IPV severity \n index z-scr")
 



# Merge the stacked tables into a single table with column headers

tbl_csh_trnsfr <- tbl_merge(
  tbls = list(tbl_list_csh_trnsfr[[1]],# Ever: First models (Refusal = missing)
              tbl_list_csh_trnsfr[[2]], # Ever: Second models (Refusal = 0)
              tbl_list_csh_trnsfr[[3]],  # Ever: Third models (Refusal = 1)
              tbl_list_csh_trnsfr[[4]]# lst 12 mnths: First models (Refusal = missing)
              #tbl_list_csh_trnsfr[[5]] # lst 12 mnths: Second models (Refusal = 0)
              # tbl_list_csh_trnsfr[[6]],# lst 12 mnths: Third models (Refusal = 1)
              # tbl_list_csh_trnsfr[[7]], # Severity index
              # tbl_list_csh_trnsfr[[8]]# Severity index z-scr
              ),  # lst 12 mnths: Third models (Refusal = 1)
  tab_spanner = c("(1)", "(2)", "(3)", "(4)")
)

## Productive inclusion
tbl_pi <- tbl_merge(
  tbls = list(tbl_list_pi[[1]],# Ever: First models (Refusal = missing)
              tbl_list_pi[[2]], # Ever: Second models (Refusal = 0)
              tbl_list_pi[[3]],  # Ever: Third models (Refusal = 1)
              tbl_list_pi[[4]]# lst 12 mnths: First models (Refusal = missing)
              #tbl_list_pi[[5]] # lst 12 mnths: Second models (Refusal = 0)
              # tbl_list_pi[[6]],# lst 12 mnths: Third models (Refusal = 1)
              # tbl_list_pi[[7]], # Severity index
              # tbl_list_pi[[8]]
              ),# Severity index z-scr
  tab_spanner = c("(1)", "(2)", "(3)", "(4)")
)

## Pool Productive inclusion
tbl_pi_pool <- tbl_merge(
  tbls = list(tbl_list_pi_pool[[1]],# Ever: First models (Refusal = missing)
              tbl_list_pi_pool[[2]], # Ever: Second models (Refusal = 0)
              tbl_list_pi_pool[[3]],  # Ever: Third models (Refusal = 1)
              tbl_list_pi_pool[[4]]# lst 12 mnths: First models (Refusal = missing)
              #tbl_list_pi_pool[[5]] # lst 12 mnths: Second models (Refusal = 0)
              # tbl_list_pi_pool[[6]],# lst 12 mnths: Third models (Refusal = 1)
              # tbl_list_pi_pool[[7]], # Severity index
              # tbl_list_pi_pool[[8]]
              ),# Severity index z-scr
  tab_spanner = c("(1)", "(2)", "(3)", "(4)")
)

# Create a list of stacked tables combining Cash Transfer and Productive Inclusion models
# Each list element combines the corresponding models from both treatment types
tbl <- tbl_stack(list(tbl_csh_trnsfr, tbl_pi, tbl_pi_pool))

# Modify table body to customize variable labels
tbl <- tbl %>%
  modify_table_body(~ .x %>%
                      mutate(label = case_when(
                        # Rename specific treatment variables
                        variable == "treatment_piCapital" ~ "Capital",
                        variable == "treatment_piPsychosocial" ~ "Psychosocial",
                        variable == "treatment_piFull" ~ "Full",
                        variable == "treatment_pi_poolPool" ~ "Full",
                        # Label cash transfer and productive inclusion treatments
                        variable == "treatment_csh_trnsfr" & is.na(term_1) ~ "Tekavoul",
                        variable == "treatment_pi"& is.na(term_1) ~ "Productive Inclusion",
                        variable == "treatment_pi_pool"& is.na(term_1) ~ "Productive Inclusion (Pool)",
                        TRUE ~ label  # Keep original labels for other variables
                      )))

# Create a tribble (transposed tibble) with additional rows for the table
# These rows include control mean, standard deviation, and interaction terms
additional_rows <- tribble(
  ~variable,  ~var_label, ~label, ~estimate_1, ~estimate_2, ~estimate_3, ~estimate_4, 
  "Control mean @ follow up-2","Control mean @ follow up-2","Control mean @ follow up-2", mean_values[1], mean_values[2], mean_values[3], mean_values[4], 
  "Control SD @ follow up-2","Control SD @ follow up-2","Control SD @ follow up-2",  sd_values[1], sd_values[2], sd_values[3], sd_values[4], 
  "Full - Psychosocial","Full - Psychosocial","Full - Psychosocial",   full_Psychosocial[1], full_Psychosocial[2], full_Psychosocial[3], full_Psychosocial[4], 
  "Full - Capital","Full - Capital", "Full - Capital", full_Capital[1], full_Capital[2], full_Capital[3], full_Capital[4], 
  "Psychosocial - Capital","Psychosocial - Capital","Psychosocial - Capital",  psychosocial_Capital[1], psychosocial_Capital[2], psychosocial_Capital[3], psychosocial_Capital[4]
)

# Append the additional rows to the table body
tbl$table_body <- bind_rows(tbl$table_body, additional_rows)

# Final table formatting
tbl <- tbl %>%
  # Set table caption
  modify_caption(physical_ipv_title) %>%
  # Modify header for the label column
  modify_header(label = "**Outcome**") %>%
  # Remove all existing footnotes
  modify_footnote(everything() ~ NA) %>%
  modify_footnote(all_stat_cols() ~ NA) %>%
  # Add custom footnote with methodological details
  modify_footnote(label = "Notes: Results presented are OLS estimates that include controls for randomization strata (commune) and, where possible, baseline outcomes.  We control for social promotion intervention. Enumerator fixed effects are included in all regression. We estimate the regressions for the productive beneficiaries aged 18-49 only. Robust standard errors are shown in parentheses, clustered at the village proxy level. *** p < 0.01, ** p < 0.05, * p < 0.1.")

# Print the final table
tbl


```

## Sexual Violence

```{r}
######################## Fist estimate ##########################################

# Use map_dfr to iterate over each outcome and estimate effects for different treatment variables
mainResults <- map_dfr(treatment_vars, function(curr_treat_var) {
  tempResults <- map_dfr(sexual_ipv_vars, function(depvar) {    
    bind_rows(
      getEstimateGlobal(depvar, curr_treat_var, control_vars, strata_vars, cluster_vars, followup_MRT_hh) %>%
        mutate(depvar = depvar, curr_treat_var = curr_treat_var)
    )
  })
})

# Extract results for different outcomes variables 
## Cash transfer regression models
# Extract specific models for cash transfer from the main results
m11 <- mainResults$results_base[[1]]  # First cash transfer model
m12 <- mainResults$results_base[[2]]  # Second cash transfer model
m13 <- mainResults$results_base[[3]]  # Third cash transfer model
m14 <- mainResults$results_base[[4]] 
# m15 <- mainResults$results_base[[5]]  
# m16 <- mainResults$results_base[[6]]  
# m17 <- mainResults$results_base[[7]]  
# m18 <- mainResults$results_base[[8]]  

## Productive inclusion regression models
# Extract specific models for productive inclusion from the main results
m21 <- mainResults$results_base[[5]]  # First productive inclusion model
m22 <- mainResults$results_base[[6]]  # Second productive inclusion model
m23 <- mainResults$results_base[[7]]  # Third productive inclusion model
m24 <- mainResults$results_base[[8]]  
#m25 <- mainResults$results_base[[10]]  
# m26 <- mainResults$results_base[[14]]  
# m27 <- mainResults$results_base[[15]]  
# m28 <- mainResults$results_base[[16]]  

m31 <- mainResults$results_base[[9]]  # First pool productive inclusion model
m32 <- mainResults$results_base[[10]]  # Second pool productive inclusion model
m33 <- mainResults$results_base[[11]]  # Third pool productive inclusion model
m34 <- mainResults$results_base[[12]]  
#m35 <- mainResults$results_base[[15]]  
# m36 <- mainResults$results_base[[22]] 
# m37 <- mainResults$results_base[[23]]  
# m38 <- mainResults$results_base[[24]] 


# Alternative way to filter cash transfer models from the dataset
m1 <- mainResults %>% 
  filter(curr_treat_var=="treatment_csh_trnsfr") %>% 
  select(results_base) %>% 
  as.list()

# Alternative way to filter productive inclusion models from the dataset
m2 <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(results_base) %>% 
  as.list()

# Extract interaction terms for productive inclusion treatments
# Full Psychosocial interaction term
full_Psychosocial <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(full_Psychosocial) %>% 
  pull() %>% 
  as.numeric()

# Full Capital interaction term
full_Capital <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(full_Capital) %>% 
  pull() %>% 
  as.numeric()

# Psychosocial and Capital interaction term
psychosocial_Capital <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(psychosocial_Capital) %>% 
  pull() %>% 
  as.numeric()

# Initialize empty vectors to store descriptive statistics
# These will store mean and standard deviation for each outcome variable
mean_values <- c()  # Vector to store mean values
sd_values <- c()   # Vector to store standard deviation values

# Calculate descriptive statistics for each outcome variable
# Loop through the list of outcome variables
for (depvar in sexual_ipv_vars) {
  # Calculate and round mean, ignoring NA values
  mean_values <- c(mean_values,  round(mean(followup_MRT_hh_control[[depvar]], na.rm = TRUE), 3))
  
  # Calculate and round standard deviation, ignoring NA values
  sd_values <- c(sd_values,  round(sd(followup_MRT_hh_control[[depvar]], na.rm = TRUE), 3))
}

# Create lists of models for easier processing
models_pi <- list(m21, m22, m23, m24)  # Productive inclusion models
models_pi_pool <- list(m31, m32, m33, m34)  # Productive inclusion models pool
models_csh_trnsfr <- list(m11, m12, m13, m14)  # Cash transfer models

# Create regression tables for Productive Inclusion models
tbl_list_pi <- map(models_pi, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is 
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_pi")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})",
                         hide_se = TRUE) %>%
  add_glance_table(include = c(nobs, r.squared)))

tbl_list_pi_pool <- map(models_pi_pool, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is 
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_pi_pool")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})",
                         hide_se = TRUE)%>%
  add_glance_table(include = c(nobs, r.squared)))

# Create regression tables for Cash Transfer models
tbl_list_csh_trnsfr <- map(models_csh_trnsfr, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_csh_trnsfr")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})",
                         hide_se = TRUE)%>%
  add_glance_table(include = c(nobs, r.squared)))

# Modify headers for the Productive Inclusion and Cash Transfer models
## for : ever
### Refusal = missing
# Modify headers for the Productive Inclusion and Cash Transfer models
# tbl_list_pi[[1]] <- tbl_list_pi[[1]] %>%
#    modify_header(estimate = "Binary \n for sex. \n IPV ever")
# 
# tbl_list_csh_trnsfr[[1]] <- tbl_list_csh_trnsfr[[1]] %>%
#    modify_header(estimate = "Binary \n for sex. \n IPV ever")
# 
# tbl_list_pi_pool[[1]] <- tbl_list_pi_pool[[1]] %>%
#    modify_header(estimate = "Binary \n for sex. \n IPV ever")


tbl_list_pi[[1]] <- tbl_list_pi[[1]] %>%
   modify_header(estimate = "Binary \n for sex. IPV \n in the last 12 months")

tbl_list_csh_trnsfr[[1]] <- tbl_list_csh_trnsfr[[1]] %>%
   modify_header(estimate = "Binary \n for sex. IPV \n in the last 12 months")

tbl_list_pi_pool[[1]] <- tbl_list_pi_pool[[1]] %>%
   modify_header(estimate = "Binary \n for sex. IPV \n in the last 12 months")
 

tbl_list_pi[[2]] <- tbl_list_pi[[2]] %>%
   modify_header(estimate = "Sex. \n IPV intensity \n index z-scr")

tbl_list_csh_trnsfr[[2]] <- tbl_list_csh_trnsfr[[2]] %>%
   modify_header(estimate = "Sex. \n IPV intensity \n index z-scr")

tbl_list_pi_pool[[2]] <- tbl_list_pi_pool[[2]] %>%
   modify_header(estimate = "Sex. \n IPV intensity \n index z-scr")


tbl_list_pi[[3]] <- tbl_list_pi[[3]] %>%
   modify_header(estimate = "Sex. \n IPV severity \n index")

tbl_list_csh_trnsfr[[3]] <- tbl_list_csh_trnsfr[[3]] %>%
   modify_header(estimate = "Sex. \n IPV severity \n index")

tbl_list_pi_pool[[3]] <- tbl_list_pi_pool[[3]] %>%
   modify_header(estimate = "Sex. \n IPV severity \n index")


tbl_list_pi[[4]] <- tbl_list_pi[[4]] %>%
   modify_header(estimate = "Sex. \n IPV severity \n index z-scr")

tbl_list_csh_trnsfr[[4]] <- tbl_list_csh_trnsfr[[4]] %>%
   modify_header(estimate = "Sex. \n IPV severity \n index z-scr")

tbl_list_pi_pool[[4]] <- tbl_list_pi_pool[[4]] %>%
   modify_header(estimate = "Sex. \n IPV severity \n index z-scr")
 



# Merge the stacked tables into a single table with column headers

tbl_csh_trnsfr <- tbl_merge(
  tbls = list(tbl_list_csh_trnsfr[[1]],# Ever: First models (Refusal = missing)
              tbl_list_csh_trnsfr[[2]], # Ever: Second models (Refusal = 0)
              tbl_list_csh_trnsfr[[3]],  # Ever: Third models (Refusal = 1)
              tbl_list_csh_trnsfr[[4]]# lst 12 mnths: First models (Refusal = missing)
              #tbl_list_csh_trnsfr[[5]] # lst 12 mnths: Second models (Refusal = 0)
              # tbl_list_csh_trnsfr[[6]],# lst 12 mnths: Third models (Refusal = 1)
              # tbl_list_csh_trnsfr[[7]], # Severity index
              # tbl_list_csh_trnsfr[[8]]# Severity index z-scr
              ),  # lst 12 mnths: Third models (Refusal = 1)
  tab_spanner = c("(1)", "(2)", "(3)", "(4)")
)

## Productive inclusion
tbl_pi <- tbl_merge(
  tbls = list(tbl_list_pi[[1]],# Ever: First models (Refusal = missing)
              tbl_list_pi[[2]], # Ever: Second models (Refusal = 0)
              tbl_list_pi[[3]],  # Ever: Third models (Refusal = 1)
              tbl_list_pi[[4]]# lst 12 mnths: First models (Refusal = missing)
              #tbl_list_pi[[5]] # lst 12 mnths: Second models (Refusal = 0)
              # tbl_list_pi[[6]],# lst 12 mnths: Third models (Refusal = 1)
              # tbl_list_pi[[7]], # Severity index
              # tbl_list_pi[[8]]
              ),# Severity index z-scr
  tab_spanner = c("(1)", "(2)", "(3)", "(4)")
)

## Pool Productive inclusion
tbl_pi_pool <- tbl_merge(
  tbls = list(tbl_list_pi_pool[[1]],# Ever: First models (Refusal = missing)
              tbl_list_pi_pool[[2]], # Ever: Second models (Refusal = 0)
              tbl_list_pi_pool[[3]],  # Ever: Third models (Refusal = 1)
              tbl_list_pi_pool[[4]]# lst 12 mnths: First models (Refusal = missing)
              #tbl_list_pi_pool[[5]] # lst 12 mnths: Second models (Refusal = 0)
              # tbl_list_pi_pool[[6]],# lst 12 mnths: Third models (Refusal = 1)
              # tbl_list_pi_pool[[7]], # Severity index
              # tbl_list_pi_pool[[8]]
              ),# Severity index z-scr
  tab_spanner = c("(1)", "(2)", "(3)", "(4)")
)

# Create a list of stacked tables combining Cash Transfer and Productive Inclusion models
# Each list element combines the corresponding models from both treatment types
tbl <- tbl_stack(list(tbl_csh_trnsfr, tbl_pi, tbl_pi_pool))

# Modify table body to customize variable labels
tbl <- tbl %>%
  modify_table_body(~ .x %>%
                      mutate(label = case_when(
                        # Rename specific treatment variables
                        variable == "treatment_piCapital" ~ "Capital",
                        variable == "treatment_piPsychosocial" ~ "Psychosocial",
                        variable == "treatment_piFull" ~ "Full",
                        variable == "treatment_pi_poolPool" ~ "Full",
                        # Label cash transfer and productive inclusion treatments
                        variable == "treatment_csh_trnsfr" & is.na(term_1) ~ "Tekavoul",
                        variable == "treatment_pi"& is.na(term_1) ~ "Productive Inclusion",
                        variable == "treatment_pi_pool"& is.na(term_1) ~ "Productive Inclusion (Pool)",
                        TRUE ~ label  # Keep original labels for other variables
                      )))

# Create a tribble (transposed tibble) with additional rows for the table
# These rows include control mean, standard deviation, and interaction terms
additional_rows <- tribble(
  ~variable,  ~var_label, ~label, ~estimate_1, ~estimate_2, ~estimate_3, ~estimate_4, 
  "Control mean @ follow up-2","Control mean @ follow up-2","Control mean @ follow up-2", mean_values[1], mean_values[2], mean_values[3], mean_values[4], 
  "Control SD @ follow up-2","Control SD @ follow up-2","Control SD @ follow up-2",  sd_values[1], sd_values[2], sd_values[3], sd_values[4], 
  "Full - Psychosocial","Full - Psychosocial","Full - Psychosocial",   full_Psychosocial[1], full_Psychosocial[2], full_Psychosocial[3], full_Psychosocial[4], 
  "Full - Capital","Full - Capital", "Full - Capital", full_Capital[1], full_Capital[2], full_Capital[3], full_Capital[4], 
  "Psychosocial - Capital","Psychosocial - Capital","Psychosocial - Capital",  psychosocial_Capital[1], psychosocial_Capital[2], psychosocial_Capital[3], psychosocial_Capital[4]
)

# Append the additional rows to the table body
tbl$table_body <- bind_rows(tbl$table_body, additional_rows)

# Final table formatting
tbl <- tbl %>%
  # Set table caption
  modify_caption(sexual_ipv_title) %>%
  # Modify header for the label column
  modify_header(label = "**Outcome**") %>%
  # Remove all existing footnotes
  modify_footnote(everything() ~ NA) %>%
  modify_footnote(all_stat_cols() ~ NA) %>%
  # Add custom footnote with methodological details
  modify_footnote(label = "Notes: Results presented are OLS estimates that include controls for randomization strata (commune) and, where possible, baseline outcomes.  We control for social promotion intervention. Enumerator fixed effects are included in all regression. We estimate the regressions for the productive beneficiaries aged 18-49 only. Robust standard errors are shown in parentheses, clustered at the village proxy level. *** p < 0.01, ** p < 0.05, * p < 0.1.")

# Print the final table
tbl



```

## Economic Violence

```{r}
######################## Fist estimate ##########################################

# Use map_dfr to iterate over each outcome and estimate effects for different treatment variables
mainResults <- map_dfr(treatment_vars, function(curr_treat_var) {
  tempResults <- map_dfr(economic_ipv_vars, function(depvar) {    
    bind_rows(
      getEstimateGlobal(depvar, curr_treat_var, control_vars, strata_vars, cluster_vars, followup_MRT_hh) %>%
        mutate(depvar = depvar, curr_treat_var = curr_treat_var)
    )
  })
})

# Extract results for different outcomes variables 
## Cash transfer regression models
# Extract specific models for cash transfer from the main results
m11 <- mainResults$results_base[[1]]  # First cash transfer model
m12 <- mainResults$results_base[[2]]  # Second cash transfer model
m13 <- mainResults$results_base[[3]]  # Third cash transfer model
m14 <- mainResults$results_base[[4]] 
# m15 <- mainResults$results_base[[5]]  
# m16 <- mainResults$results_base[[6]]  
# m17 <- mainResults$results_base[[7]]  
# m18 <- mainResults$results_base[[8]]  

## Productive inclusion regression models
# Extract specific models for productive inclusion from the main results
m21 <- mainResults$results_base[[5]]  # First productive inclusion model
m22 <- mainResults$results_base[[6]]  # Second productive inclusion model
m23 <- mainResults$results_base[[7]]  # Third productive inclusion model
m24 <- mainResults$results_base[[8]]  
#m25 <- mainResults$results_base[[10]]  
# m26 <- mainResults$results_base[[14]]  
# m27 <- mainResults$results_base[[15]]  
# m28 <- mainResults$results_base[[16]]  

m31 <- mainResults$results_base[[9]]  # First pool productive inclusion model
m32 <- mainResults$results_base[[10]]  # Second pool productive inclusion model
m33 <- mainResults$results_base[[11]]  # Third pool productive inclusion model
m34 <- mainResults$results_base[[12]]  
#m35 <- mainResults$results_base[[15]]  
# m36 <- mainResults$results_base[[22]] 
# m37 <- mainResults$results_base[[23]]  
# m38 <- mainResults$results_base[[24]] 

# Alternative way to filter cash transfer models from the dataset
m1 <- mainResults %>% 
  filter(curr_treat_var=="treatment_csh_trnsfr") %>% 
  select(results_base) %>% 
  as.list()

# Alternative way to filter productive inclusion models from the dataset
m2 <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(results_base) %>% 
  as.list()

# Extract interaction terms for productive inclusion treatments
# Full Psychosocial interaction term
full_Psychosocial <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(full_Psychosocial) %>% 
  pull() %>% 
  as.numeric()

# Full Capital interaction term
full_Capital <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(full_Capital) %>% 
  pull() %>% 
  as.numeric()

# Psychosocial and Capital interaction term
psychosocial_Capital <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(psychosocial_Capital) %>% 
  pull() %>% 
  as.numeric()

# Initialize empty vectors to store descriptive statistics
# These will store mean and standard deviation for each outcome variable
mean_values <- c()  # Vector to store mean values
sd_values <- c()   # Vector to store standard deviation values

# Calculate descriptive statistics for each outcome variable
# Loop through the list of outcome variables
for (depvar in economic_ipv_vars) {
  # Calculate and round mean, ignoring NA values
  mean_values <- c(mean_values,  round(mean(followup_MRT_hh_control[[depvar]], na.rm = TRUE), 3))
  
  # Calculate and round standard deviation, ignoring NA values
  sd_values <- c(sd_values,  round(sd(followup_MRT_hh_control[[depvar]], na.rm = TRUE), 3))
}

# Create lists of models for easier processing
models_pi <- list(m21, m22, m23, m24)  # Productive inclusion models
models_pi_pool <- list(m31, m32, m33, m34)  # Productive inclusion models pool
models_csh_trnsfr <- list(m11, m12, m13, m14)  # Cash transfer models

# Create regression tables for Productive Inclusion models
tbl_list_pi <- map(models_pi, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is 
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_pi")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})",
                         hide_se = TRUE) %>%
  add_glance_table(include = c(nobs, r.squared)))

tbl_list_pi_pool <- map(models_pi_pool, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is 
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_pi_pool")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})",
                         hide_se = TRUE)%>%
  add_glance_table(include = c(nobs, r.squared)))

# Create regression tables for Cash Transfer models
tbl_list_csh_trnsfr <- map(models_csh_trnsfr, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_csh_trnsfr")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})",
                         hide_se = TRUE)%>%
  add_glance_table(include = c(nobs, r.squared)))

# Modify headers for the Productive Inclusion and Cash Transfer models
## for : ever
### Refusal = missing
# Modify headers for the Productive Inclusion and Cash Transfer models
# tbl_list_pi[[1]] <- tbl_list_pi[[1]] %>%
#    modify_header(estimate = "Binary \n for eco. \n IPV ever")
# 
# tbl_list_csh_trnsfr[[1]] <- tbl_list_csh_trnsfr[[1]] %>%
#    modify_header(estimate = "Binary \n for eco. \n IPV ever")
# 
# tbl_list_pi_pool[[1]] <- tbl_list_pi_pool[[1]] %>%
#    modify_header(estimate = "Binary \n for eco. \n IPV ever")


tbl_list_pi[[1]] <- tbl_list_pi[[1]] %>%
   modify_header(estimate = "Binary \n for eco. IPV \n in the last 12 months")

tbl_list_csh_trnsfr[[1]] <- tbl_list_csh_trnsfr[[1]] %>%
   modify_header(estimate = "Binary \n for eco. IPV \n in the last 12 months")

tbl_list_pi_pool[[1]] <- tbl_list_pi_pool[[1]] %>%
   modify_header(estimate = "Binary \n for eco. IPV \n in the last 12 months")
 

tbl_list_pi[[2]] <- tbl_list_pi[[2]] %>%
   modify_header(estimate = "Eco. \n IPV intensity \n index z-scr")

tbl_list_csh_trnsfr[[2]] <- tbl_list_csh_trnsfr[[2]] %>%
   modify_header(estimate = "Eco. \n IPV intensity \n index z-scr")

tbl_list_pi_pool[[2]] <- tbl_list_pi_pool[[2]] %>%
   modify_header(estimate = "Eco. \n IPV intensity \n index z-scr")


tbl_list_pi[[3]] <- tbl_list_pi[[3]] %>%
   modify_header(estimate = "Eco. \n IPV severity \n index")

tbl_list_csh_trnsfr[[3]] <- tbl_list_csh_trnsfr[[3]] %>%
   modify_header(estimate = "Eco. \n IPV severity \n index")

tbl_list_pi_pool[[3]] <- tbl_list_pi_pool[[3]] %>%
   modify_header(estimate = "Eco. \n IPV severity \n index")


tbl_list_pi[[4]] <- tbl_list_pi[[4]] %>%
   modify_header(estimate = "Eco. \n IPV severity \n index z-scr")

tbl_list_csh_trnsfr[[4]] <- tbl_list_csh_trnsfr[[4]] %>%
   modify_header(estimate = "Eco. \n IPV severity \n index z-scr")

tbl_list_pi_pool[[4]] <- tbl_list_pi_pool[[4]] %>%
   modify_header(estimate = "Eco. \n IPV severity \n index z-scr")
 



# Merge the stacked tables into a single table with column headers

tbl_csh_trnsfr <- tbl_merge(
  tbls = list(tbl_list_csh_trnsfr[[1]],# Ever: First models (Refusal = missing)
              tbl_list_csh_trnsfr[[2]], # Ever: Second models (Refusal = 0)
              tbl_list_csh_trnsfr[[3]],  # Ever: Third models (Refusal = 1)
              tbl_list_csh_trnsfr[[4]]# lst 12 mnths: First models (Refusal = missing)
              #tbl_list_csh_trnsfr[[5]] # lst 12 mnths: Second models (Refusal = 0)
              # tbl_list_csh_trnsfr[[6]],# lst 12 mnths: Third models (Refusal = 1)
              # tbl_list_csh_trnsfr[[7]], # Severity index
              # tbl_list_csh_trnsfr[[8]]# Severity index z-scr
              ),  # lst 12 mnths: Third models (Refusal = 1)
  tab_spanner = c("(1)", "(2)", "(3)", "(4)")
)

## Productive inclusion
tbl_pi <- tbl_merge(
  tbls = list(tbl_list_pi[[1]],# Ever: First models (Refusal = missing)
              tbl_list_pi[[2]], # Ever: Second models (Refusal = 0)
              tbl_list_pi[[3]],  # Ever: Third models (Refusal = 1)
              tbl_list_pi[[4]]# lst 12 mnths: First models (Refusal = missing)
              #tbl_list_pi[[5]] # lst 12 mnths: Second models (Refusal = 0)
              # tbl_list_pi[[6]],# lst 12 mnths: Third models (Refusal = 1)
              # tbl_list_pi[[7]], # Severity index
              # tbl_list_pi[[8]]
              ),# Severity index z-scr
  tab_spanner = c("(1)", "(2)", "(3)", "(4)")
)

## Pool Productive inclusion
tbl_pi_pool <- tbl_merge(
  tbls = list(tbl_list_pi_pool[[1]],# Ever: First models (Refusal = missing)
              tbl_list_pi_pool[[2]], # Ever: Second models (Refusal = 0)
              tbl_list_pi_pool[[3]],  # Ever: Third models (Refusal = 1)
              tbl_list_pi_pool[[4]]# lst 12 mnths: First models (Refusal = missing)
              #tbl_list_pi_pool[[5]] # lst 12 mnths: Second models (Refusal = 0)
              # tbl_list_pi_pool[[6]],# lst 12 mnths: Third models (Refusal = 1)
              # tbl_list_pi_pool[[7]], # Severity index
              # tbl_list_pi_pool[[8]]
              ),# Severity index z-scr
  tab_spanner = c("(1)", "(2)", "(3)", "(4)")
)

# Create a list of stacked tables combining Cash Transfer and Productive Inclusion models
# Each list element combines the corresponding models from both treatment types
tbl <- tbl_stack(list(tbl_csh_trnsfr, tbl_pi, tbl_pi_pool))

# Modify table body to customize variable labels
tbl <- tbl %>%
  modify_table_body(~ .x %>%
                      mutate(label = case_when(
                        # Rename specific treatment variables
                        variable == "treatment_piCapital" ~ "Capital",
                        variable == "treatment_piPsychosocial" ~ "Psychosocial",
                        variable == "treatment_piFull" ~ "Full",
                        variable == "treatment_pi_poolPool" ~ "Full",
                        # Label cash transfer and productive inclusion treatments
                        variable == "treatment_csh_trnsfr" & is.na(term_1) ~ "Tekavoul",
                        variable == "treatment_pi"& is.na(term_1) ~ "Productive Inclusion",
                        variable == "treatment_pi_pool"& is.na(term_1) ~ "Productive Inclusion (Pool)",
                        TRUE ~ label  # Keep original labels for other variables
                      )))

# Create a tribble (transposed tibble) with additional rows for the table
# These rows include control mean, standard deviation, and interaction terms
additional_rows <- tribble(
  ~variable,  ~var_label, ~label, ~estimate_1, ~estimate_2, ~estimate_3, ~estimate_4, 
  "Control mean @ follow up-2","Control mean @ follow up-2","Control mean @ follow up-2", mean_values[1], mean_values[2], mean_values[3], mean_values[4], 
  "Control SD @ follow up-2","Control SD @ follow up-2","Control SD @ follow up-2",  sd_values[1], sd_values[2], sd_values[3], sd_values[4], 
  "Full - Psychosocial","Full - Psychosocial","Full - Psychosocial",   full_Psychosocial[1], full_Psychosocial[2], full_Psychosocial[3], full_Psychosocial[4], 
  "Full - Capital","Full - Capital", "Full - Capital", full_Capital[1], full_Capital[2], full_Capital[3], full_Capital[4],
  "Psychosocial - Capital","Psychosocial - Capital","Psychosocial - Capital",  psychosocial_Capital[1], psychosocial_Capital[2], psychosocial_Capital[3], psychosocial_Capital[4]
)

# Append the additional rows to the table body
tbl$table_body <- bind_rows(tbl$table_body, additional_rows)

# Final table formatting
tbl <- tbl %>%
  # Set table caption
  modify_caption(economic_ipv_title) %>%
  # Modify header for the label column
  modify_header(label = "**Outcome**") %>%
  # Remove all existing footnotes
  modify_footnote(everything() ~ NA) %>%
  modify_footnote(all_stat_cols() ~ NA) %>%
  # Add custom footnote with methodological details
  modify_footnote(label = "Notes: Results presented are OLS estimates that include controls for randomization strata (commune) and, where possible, baseline outcomes.  We control for social promotion intervention. Enumerator fixed effects are included in all regression. We estimate the regressions for the productive beneficiaries aged 18-49 only. Robust standard errors are shown in parentheses, clustered at the village proxy level. *** p < 0.01, ** p < 0.05, * p < 0.1.")

# Print the final table
tbl

```


## Other types of violences

```{r}
######################## Fist estimate ##########################################

# Use map_dfr to iterate over each outcome and estimate effects for different treatment variables
mainResults <- map_dfr(treatment_vars, function(curr_treat_var) {
  tempResults <- map_dfr(other_ipv_vars, function(depvar) {    
    bind_rows(
      getEstimateGlobal(depvar, curr_treat_var, control_vars, strata_vars, cluster_vars, followup_MRT_hh) %>%
        mutate(depvar = depvar, curr_treat_var = curr_treat_var)
    )
  })
})

# Extract results for different outcomes variables 
## Cash transfer regression models
# Extract specific models for cash transfer from the main results
m11 <- mainResults$results_base[[1]]  # First cash transfer model
m12 <- mainResults$results_base[[2]]  # Second cash transfer model
m13 <- mainResults$results_base[[3]]  # Third cash transfer model
# m14 <- mainResults$results_base[[4]] 

# Alternative way to filter cash transfer models from the dataset
m1 <- mainResults %>% 
  filter(curr_treat_var=="treatment_csh_trnsfr") %>% 
  select(results_base) %>% 
  as.list()

## Productive inclusion regression models
# Extract specific models for productive inclusion from the main results
m21 <- mainResults$results_base[[4]]  # First productive inclusion model
m22 <- mainResults$results_base[[5]]  # Second productive inclusion model
m23 <- mainResults$results_base[[6]]  # Third productive inclusion model
# m24 <- mainResults$results_base[[8]]  


m31 <- mainResults$results_base[[7]]  # First pool productive inclusion model
m32 <- mainResults$results_base[[8]]  # Second pool productive inclusion model
m33 <- mainResults$results_base[[9]]  # Third pool productive inclusion model
# m34 <- mainResults$results_base[[12]]  


# Alternative way to filter productive inclusion models from the dataset
m2 <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(results_base) %>% 
  as.list()

# Extract interaction terms for productive inclusion treatments
# Full Psychosocial interaction term
full_Psychosocial <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(full_Psychosocial) %>% 
  pull() %>% 
  as.numeric()

# Full Capital interaction term
full_Capital <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(full_Capital) %>% 
  pull() %>% 
  as.numeric()

# Psychosocial and Capital interaction term
psychosocial_Capital <- mainResults %>% 
  filter(curr_treat_var=="treatment_pi") %>% 
  select(psychosocial_Capital) %>% 
  pull() %>% 
  as.numeric()

# Initialize empty vectors to store descriptive statistics
# These will store mean and standard deviation for each outcome variable
mean_values <- c()  # Vector to store mean values
sd_values <- c()   # Vector to store standard deviation values

# Calculate descriptive statistics for each outcome variable
# Loop through the list of outcome variables
for (depvar in other_ipv_vars) {
  # Calculate and round mean, ignoring NA values
  mean_values <- c(mean_values,  round(mean(followup_MRT_hh_control[[depvar]], na.rm = TRUE), 3))
  
  # Calculate and round standard deviation, ignoring NA values
  sd_values <- c(sd_values,  round(sd(followup_MRT_hh_control[[depvar]], na.rm = TRUE), 3))
}

# Transform to character
# mean_values <- as.character(mean_values)
# sd_values <- as.character(sd_values)

# Create lists of models for easier processing
models_pi <- list(m21, m22, m23)  # Productive inclusion models
models_pi_pool <- list(m31, m32, m33)  # Productive inclusion models pool
models_csh_trnsfr <- list(m11, m12, m13)  # Cash transfer models

# Create regression tables for Productive Inclusion models
tbl_list_pi <- map(models_pi, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is 
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_pi")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})", 
                                         thresholds = c(0.001, 0.01, 0.05),hide_se = TRUE) %>%
  add_glance_table(include = c(nobs, r.squared)))

tbl_list_pi_pool <- map(models_pi_pool, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is 
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_pi_pool")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})", 
                                         thresholds = c(0.001, 0.01, 0.05),hide_se = TRUE)%>%
  add_glance_table(include = c(nobs, r.squared))) 

# Create regression tables for Cash Transfer models
tbl_list_csh_trnsfr <- map(models_csh_trnsfr, ~ tbl_regression(.x, 
                                         exponentiate = FALSE,  # Keep coefficients as-is
                                         estimate_fun = ~ style_number(.x, digits = 2),
                                         include="treatment_csh_trnsfr")  %>% 
                  add_significance_stars(pattern = "{estimate}{stars} \n ({std.error})", 
                                         thresholds = c(0.001, 0.01, 0.05),hide_se = TRUE)%>%
  add_glance_table(include = c(nobs, r.squared)))

# Modify headers for the Productive Inclusion and Cash Transfer models
## fAt least one type of violence incl. other Last 12 months 
### Refusal = missing

tbl_list_pi[[1]] <- tbl_list_pi[[1]] %>%
   modify_header(estimate = "Binary for at \n least one type of \n IPV incl. eco. \n in the last 12 months")

tbl_list_csh_trnsfr[[1]] <- tbl_list_csh_trnsfr[[1]] %>%
   modify_header(estimate = "Binary for at \n least one type of \n IPV incl. eco. \n in the last 12 months")

tbl_list_pi_pool[[1]] <- tbl_list_pi_pool[[1]] %>%
   modify_header(estimate = "Binary for at \n least one type of \n IPV incl. eco. \n in the last 12 months")

## At least one type of violence Last 12 months (Refusal = \"missing\")
tbl_list_pi[[2]] <- tbl_list_pi[[2]] %>%
   modify_header(estimate = "All IPV \n intensity index \n z-scr")

tbl_list_csh_trnsfr[[2]] <- tbl_list_csh_trnsfr[[2]] %>%
   modify_header(estimate = "All IPV \n intensity index \n z-scr")

tbl_list_pi_pool[[2]] <- tbl_list_pi_pool[[2]] %>%
   modify_header(estimate = "All IPV \n intensity index \n z-scr")
 
## At least one type of violence Last 12 months (Refusal = \"0\")
tbl_list_pi[[3]] <- tbl_list_pi[[3]] %>%
   modify_header(estimate = "Binary for \n at least one \n type of IPV \n in the last 12 months")

tbl_list_csh_trnsfr[[3]] <- tbl_list_csh_trnsfr[[3]] %>%
   modify_header(estimate = "Binary for \n at least one \n type of IPV \n in the last 12 months")

tbl_list_pi_pool[[3]] <- tbl_list_pi_pool[[3]] %>%
   modify_header(estimate = "Binary for \n at least one \n type of IPV \n in the last 12 months")



# Merge the stacked tables into a single table with column headers
## Cash transfert
tbl_csh_trnsfr <- tbl_merge(
  tbls = list(tbl_list_csh_trnsfr[[1]],# First models (Refusal = missing)
              tbl_list_csh_trnsfr[[2]], # First models (Refusal = missing) 
              tbl_list_csh_trnsfr[[3]]  # Second models (Refusal = 0) 
              #tbl_list_csh_trnsfr[[4]]# Third models (Refusal = 1)
              ),  # lst 12 mnths: Third models (Refusal = 1)
  tab_spanner = c("(1)", "(2)", "(3)")
)

## Productive inclusion
tbl_pi <- tbl_merge(
  tbls = list(tbl_list_pi[[1]],# First models (Refusal = missing)
              tbl_list_pi[[2]], # First models (Refusal = missing)
              tbl_list_pi[[3]]  # Second models (Refusal = 1)
              #tbl_list_pi[[4]]# Third models (Refusal = 1)
                ),# Severity index z-scr
  tab_spanner = c("(1)", "(2)", "(3)")
)

## Pool Productive inclusion
tbl_pi_pool <- tbl_merge(
  tbls = list(tbl_list_pi_pool[[1]], # First models (Refusal = missing)
              tbl_list_pi_pool[[2]], # First models (Refusal = missing) 
              tbl_list_pi_pool[[3]] # Second models (Refusal = 0) 
              #tbl_list_pi_pool[[4]]  # Third models (Refusal = 1)
             ),# Severity index z-scr
  tab_spanner = c("(1)", "(2)", "(3)")
)



# Create a list of stacked tables combining Cash Transfer and Productive Inclusion models
# Each list element combines the corresponding models from both treatment types
tbl <- tbl_stack(list(tbl_csh_trnsfr, tbl_pi, tbl_pi_pool))

# Modify table body to customize variable labels
tbl <- tbl %>%
  modify_table_body(~ .x %>%
                      mutate(label = case_when(
                        # Rename specific treatment variables
                        variable == "treatment_piCapital" ~ "Capital",
                        variable == "treatment_piPsychosocial" ~ "Psychosocial",
                        variable == "treatment_piFull" ~ "Full",
                        variable == "treatment_pi_poolPool" ~ "Full",
                        # Label cash transfer and productive inclusion treatments
                        variable == "treatment_csh_trnsfr" & is.na(term_1) ~ "Tekavoul",
                        variable == "treatment_pi"& is.na(term_1) ~ "Productive Inclusion",
                        variable == "treatment_pi_pool"& is.na(term_1) ~ "Productive Inclusion (Pool)",
                        TRUE ~ label  # Keep original labels for other variables
                      )))

# Create a tribble (transposed tibble) with additional rows for the table
# These rows include control mean, standard deviation, and interaction terms
additional_rows <- tribble(
  ~variable,  ~var_label, ~label, ~estimate_1, ~estimate_2, ~estimate_3,  
  "Control mean @ follow up-2","Control mean @ follow up-2","Control mean @ follow up-2", mean_values[1], mean_values[2], mean_values[3], 
  "Control SD @ follow up-2","Control SD @ follow up-2","Control SD @ follow up-2",  sd_values[1], sd_values[2], sd_values[3], 
  "Full - Psychosocial","Full - Psychosocial","Full - Psychosocial",   full_Psychosocial[1], full_Psychosocial[2], full_Psychosocial[3], 
  "Full - Capital","Full - Capital", "Full - Capital", full_Capital[1], full_Capital[2], full_Capital[3], 
  "Psychosocial - Capital","Psychosocial - Capital","Psychosocial - Capital",  psychosocial_Capital[1], psychosocial_Capital[2], psychosocial_Capital[3])

# Append the additional rows to the table body
# Combine original table with custom rows
# tbl$table_body <- tbl$table_body %>%
#   modify_table_body(
#     ~ bind_rows(.x, additional_rows)
#   )

# tbl <- tbl %>%
#   modify_table_styling(
#     rows = nrow(tbl$table_body) + 1:nrow(additional_rows), # Appending new rows
#     columns = names(additional_rows),
#     expr = ~ bind_rows(.x, additional_rows)
#   )

# tbl$table_body <- bind_rows(
#   tbl$table_body %>%
#     mutate(across(everything(), as.character)),
#   additional_rows
# )

# tbl_list_csh_trnsfr <- map(tbl_list_csh_trnsfr, ~ .x %>% modify_table_body(~ mutate(., across(everything(), as.character))))
# tbl_list_pi <- map(tbl_list_pi, ~ .x %>% modify_table_body(~ mutate(., across(everything(), as.character))))
# tbl_list_pi_pool <- map(tbl_list_pi_pool, ~ .x %>% modify_table_body(~ mutate(., across(everything(), as.character))))

# Append the additional rows to the table body
tbl$table_body <- bind_rows(tbl$table_body, additional_rows)

# Final table formatting
tbl <- tbl %>%
  # Set table caption
  modify_caption(other_ipv_title) %>%
  # Modify header for the label column
  modify_header(label = "**Outcome**") %>%
  # Remove all existing footnotes
  modify_footnote(everything() ~ NA) %>%
  modify_footnote(all_stat_cols() ~ NA) %>%
  # Add custom footnote with methodological details
  modify_footnote(label = "Notes: Results presented are OLS estimates that include controls for randomization strata (commune) and, where possible, baseline outcomes. We control for social promotion intervention. Enumerator fixed effects are included in all regression. We estimate the regressions for the productive beneficiaries aged 18-49 only. Robust standard errors are shown in parentheses, clustered at the village proxy level. *** p < 0.01, ** p < 0.05, * p < 0.1.")

# Print the final table
tbl

```

# Heterogenous effect



```{r}

####################### Second estimate #########################################
# lst_outcomes=c("olderchild_s","earlychild_s", "adult_fem_s")

# Define a list of heterogeneity variables to examine for differential treatment effects
lst_het_var <- c(
  "het_hhh_fem",          # Household head is female
  "het_hhh_edu",          # Household head nbr. year of education
  "het_pben_edu",         # Beneficiary nbr. year of education
  "het_hhh_lit",          # Household head literacy
  "het_pben_lit",          # Beneficiary literacy
  "het_save_share",         # Share of saving own by partner
  "het_ctrl_earn_index",  # Control over earnings index
  "het_ctrl_hh_index",    # Control over household decisions index
  "het_intrahh_index",    # Intra-household dynamics index
  "het_rev_sum_bohh",     # Revenue/income sum for household
  "het_age_gap"           # Age gap between partners
)

# Create a data frame of results examining heterogeneous treatment effects
# across different economic IPV outcomes, treatment variables, and heterogeneity dimensions
mainResults_het <- map_dfr(listOutcomes, function(depvar) {
 
   # For each heterogeneity variable...
  tempResults1 <- map_dfr(lst_het_var, function(het_var) { 
  
    # For each treatment variable...
    tempResults2 <- map_dfr(treatment_vars, function(treat_var) {

      bind_rows(
        # Get estimates for heterogeneous treatment effects using the specified model
        getEstimateGlobal_het(depvar, treat_var, het_var, control_vars, strata_vars, cluster_vars, followup_MRT_hh) %>%
          # Add columns identifying which variables were used in this iteration
          mutate(depvar = depvar, outcome = depvar, treat_var = treat_var, het_var = het_var)
        )
    })
  })
})

#  Mutate and recode variables for better readability
mainResults_het <- mainResults_het %>%
    mutate(
        # Recode 'name' variable
      name = dplyr::recode(name,
        cash = "(a) Tekavoul program",
        pi = "(b) Productive inclusion program"
      ),
      het_var = dplyr::recode(het_var,
                      het_hhh_fem = "Hh. head is female",
                      het_hhh_edu="Hh. head nbr. yrs of educ.",
                      het_pben_edu="Benef. nbr. yrs of educ.",
                      het_hhh_lit = "Hh. head literacy",
                      het_pben_lit = "Benef. literacy",
                      het_save_share = "Shr of resources own by prtnr",
                      het_ctrl_earn_index = "Cntrl earn. index",
                      het_ctrl_hh_index = "Cntrl hh. resources index",
                      het_intrahh_index = "Intra-hh. dynamics index",
                      het_rev_sum_bohh = "Benef. share of total hh. rev.",
                      het_age_gap = "Age gap (hh. head - benef.)"
      ),
        # Recode 'estimate' variable
      estimate = dplyr::recode(
        estimate,
        No = "low",
        Yes = "high"
      ),
        depvar = dplyr::recode(depvar,
              control_ipv_12m = "Bin. for cntrl IPV in the last 12m",
              control_ipv_inten_index = "Cntrl IPV inten. index z-scr",
              emo_ipv_ever = "Bin. for emo. IPV ever", 
              emo_ipv_12m = "Bin. for emo. IPV in the lst 12m",
              emo_severity_12m = "Emo. IPV sever. index",
              emo_severity_12m_z = "Emo. IPV sever. index z-scr",
              emo_ipv_inten_index = "Emo. IPV inten. index z-scr",
              phy_ipv_ever = "Bin. for phy. IPV ever", 
              phy_ipv_inten_index = "Phy. IPV inten. index z-scr",
              phy_ipv_12m = "Bin. for phy. IPV in the lst 12m", 
              phy_severity_12m = "Phy. IPV sever. index",
              phy_severity_12m_z = "Phy. IPV sever. z-scr",
              sex_ipv_ever = "Bin. for sex. IPV ever", 
              sex_ipv_inten_index = "Sex. IPV inten. index z-scr",
              sex_ipv_12m = "Bin. for sex. IPV in the last 12m", 
              sex_severity_12m = "Sex. IPV sever. index",
              sex_severity_12m_z = "Sex. IPV sever. index z-scr",
              eco_ipv_ever = "Bin. for eco. IPV ever", 
              eco_ipv_inten_index = "Eco. IPV inten. index z-scr",
              eco_ipv_12m = "Bin. for eco. IPV in the last 12m", 
              eco_severity_12m = "Eco. IPV sever. index",
              eco_severity_12m_z = "Eco. IPV sever. z-scr",
              ipv_all_12m = "Bin. for at least one type of IPV incl. eco. in the lst 12m", 
              all_ipv_inten_index = "All IPV inten. index z-scr",
              ipv_all2_12m = "Bin. for at least one type of IPV" 
      )
      )


    # Compute proportions by category
mainResults_het <- mainResults_het %>%
  group_by(depvar, name, het_var, typeTreat) %>%
  mutate(N_treat = sum(Ntype_treat)) %>%
  ungroup() %>%
  mutate(prop = round(Ntype_treat * 100 / N_treat, 2))

# Generate labels for the plot
  mainResults_het <- mainResults_het %>%
    group_by(depvar, name, het_var, typeTreat) %>%
    mutate(
      lab = sprintf(
        "%s \n N high treat (pct): %s (%s)\n N low treat (pct): %s (%s)",
        first(typeTreat),
        scales::comma(last(Ntype_treat)),
        scales::comma(last(prop)),
        scales::comma(first(Ntype_treat)),
        scales::comma(first(prop))
      )
    ) %>%
    ungroup()


  # Generate unique label for every one
  mainResults_het <- mainResults_het %>%
    group_by(name, het_var, typeTreat) %>%
    mutate(
      lab = first(lab)
      )%>%
    ungroup()
  
median_val <- map_dfr(gsub("het_", "", lst_het_var, fixed = TRUE), ~{
    followup_MRT_hh %>% 
        summarize(
            het_var = .x,  # Add het variable name for clarity in output
            median_value = round(median(!!sym(.x), na.rm = TRUE), 2)
        )}) %>%
  mutate(      
  het_var = dplyr::recode(het_var,
                      hhh_fem = "Hh. head is female",
                      hhh_edu="Hh. head nbr. yrs of educ.",
                      pben_edu="Benef. nbr. yrs of educ.",
                      hhh_lit = "Hh. head literacy",
                      pben_lit = "Benef. literacy",
                      save_share = "Shr of resources own by prtnr",
                      ctrl_earn_index = "Cntrl earn. index",
                      ctrl_hh_index = "Cntrl hh. resources index",
                      intrahh_index = "Intra-hh. dynamics index",
                      rev_sum_bohh = "Benef. share of total hh. rev.",
                      age_gap = "Age gap (hh. head - benef.)"
      ))
```

## Controlling Behavior 

### Household head is female

```{r}

curr_het_var = "Hh. head is female"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% control_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:4)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)


    mainResults_reg_group$lab[-c(1:4)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)

        mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)
    
#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  #facet_wrap(depvar, scales = "free_x", nrow = 2, strip.position = "top") +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"),  width = 10, height = 14, units = "cm")
```


### Household head literacy
```{r}

curr_het_var = "Hh. head literacy"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% control_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# "Ever (Refusal = \"missing\")","Ever (Refusal = \"0\")","Ever (Refusal = \"1\")", "Last 12 months (Refusal = \"missing\")", "Last 12 months (Refusal = \"0\")", "Last 12 months (Refusal = \"1\")", "Severity index (last 12 months)", "Severity z-scr (last 12 months)"

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:4)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)


    mainResults_reg_group$lab[-c(1:4)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)


    mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)
#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"),  width = 10, height = 14, units = "cm")
```

### Beneficiary literacy

```{r}
 
curr_het_var = "Hh. head literacy"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% control_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:4)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)


    mainResults_reg_group$lab[-c(1:4)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Household head nbr. of years of education

```{r}

curr_het_var = "Hh. head nbr. yrs of educ."  
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% control_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:4)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)


    mainResults_reg_group$lab[-c(1:4)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Beneficiary nbr. of years of education

```{r}

curr_het_var = "Benef. nbr. yrs of educ." 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()


mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% control_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:4)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)


    mainResults_reg_group$lab[-c(1:4)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het)
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    

```


### Beneficiary share of saving own by partner

```{r}

curr_het_var = "Shr of resources own by prtnr" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()


mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% control_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:4)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)


    mainResults_reg_group$lab[-c(1:4)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Control over earnings

```{r}
 
curr_het_var = "Cntrl earn. index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()


mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% control_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:4)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)


    mainResults_reg_group$lab[-c(1:4)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```
### Control over hh. resources

```{r}
curr_het_var = "Cntrl hh. resources index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()


mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% control_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:4)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)


    mainResults_reg_group$lab[-c(1:4)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```
### Intra-household dynamics 

```{r}

curr_het_var = "Intra-hh. dynamics index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% control_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:4)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)


    mainResults_reg_group$lab[-c(1:4)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Benef. share of total hh. revenues

```{r}

curr_het_var = "Benef. share of total hh. rev." 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()


mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% control_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:4)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)


    mainResults_reg_group$lab[-c(1:4)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Spousal age gap

```{r}

curr_het_var = "Age gap (hh. head - benef.)" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% control_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:4)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)


    mainResults_reg_group$lab[-c(1:4)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:4)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```


## Emotional Violence


### Household head is female

```{r}

curr_het_var = "Hh. head is female"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% emotional_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool'))) %>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

        mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)
    
#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```


### Household head literacy
```{r}

curr_het_var = "Hh. head literacy"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% emotional_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

        mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)
    
#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Beneficiary literacy

```{r}
 
curr_het_var = "Hh. head literacy"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% emotional_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

        mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)
    

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Household head nbr. of years of education

```{r}

curr_het_var = "Hh. head nbr. yrs of educ."  
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% emotional_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Beneficiary nbr. of years of education

```{r}

curr_het_var = "Benef. nbr. yrs of educ." 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% emotional_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Beneficiary share of saving own by partner

```{r}

curr_het_var = "Shr of resources own by prtnr" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% emotional_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Control over earnings

```{r}
 
curr_het_var = "Cntrl earn. index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% emotional_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Control over hh. resources

```{r}
curr_het_var = "Cntrl hh. resources index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% emotional_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```
### Intra-household dynamics 

```{r}

curr_het_var = "Intra-hh. dynamics index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% emotional_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Benef. share of total hh. revenues

```{r}

curr_het_var = "Benef. share of total hh. rev." 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% emotional_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Spousal age gap

```{r}

curr_het_var = "Age gap (hh. head - benef.)" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% emotional_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```


## Physical violence

### Household head is female

```{r}

curr_het_var = "Hh. head is female"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% physical_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

        mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)
    
#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```


### Household head literacy
```{r}

curr_het_var = "Hh. head literacy"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% physical_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

        mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)
    

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Beneficiary literacy

```{r}
 
curr_het_var = "Hh. head literacy"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% physical_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

        mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)
    

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Household head nbr. of years of education

```{r}

curr_het_var = "Hh. head nbr. yrs of educ."  
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% physical_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Beneficiary nbr. of years of education

```{r}

curr_het_var = "Benef. nbr. yrs of educ." 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% physical_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Beneficiary share of saving own by partner

```{r}

curr_het_var = "Shr of resources own by prtnr" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% physical_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Control over earnings

```{r}
 
curr_het_var = "Cntrl earn. index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% physical_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Control over hh. resources

```{r}
curr_het_var = "Cntrl hh. resources index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% physical_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```
### Intra-household dynamics 

```{r}

curr_het_var = "Intra-hh. dynamics index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% physical_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Benef. share of total hh. revenues

```{r}

curr_het_var = "Benef. share of total hh. rev." 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% physical_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))

# "Ever (Refusal = \"missing\")","Ever (Refusal = \"0\")","Ever (Refusal = \"1\")", "Last 12 months (Refusal = \"missing\")", "Last 12 months (Refusal = \"0\")", "Last 12 months (Refusal = \"1\")", "Severity index (last 12 months)", "Severity z-scr (last 12 months)"

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Spousal age gap

```{r}

curr_het_var = "Age gap (hh. head - benef.)" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% physical_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))

# "Ever (Refusal = \"missing\")","Ever (Refusal = \"0\")","Ever (Refusal = \"1\")", "Last 12 months (Refusal = \"missing\")", "Last 12 months (Refusal = \"0\")", "Last 12 months (Refusal = \"1\")", "Severity index (last 12 months)", "Severity z-scr (last 12 months)"

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```


## Sexual Violence 

### Household head is female

```{r}

curr_het_var = "Hh. head is female"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% sexual_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

        mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)
    
#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```


### Household head literacy
```{r}

curr_het_var = "Hh. head literacy"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% sexual_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

        mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)
    
#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Beneficiary literacy

```{r}
 
curr_het_var = "Hh. head literacy"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% sexual_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

        mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)
    
#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Household head nbr. of years of education

```{r}

curr_het_var = "Hh. head nbr. yrs of educ."  
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% sexual_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Beneficiary nbr. of years of education

```{r}

curr_het_var = "Benef. nbr. yrs of educ." 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% sexual_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Beneficiary share of saving own by partner

```{r}

curr_het_var = "Shr of resources own by prtnr" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% sexual_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Control over earnings

```{r}
 
curr_het_var = "Cntrl earn. index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% sexual_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))

# "Ever (Refusal = \"missing\")","Ever (Refusal = \"0\")","Ever (Refusal = \"1\")", "Last 12 months (Refusal = \"missing\")", "Last 12 months (Refusal = \"0\")", "Last 12 months (Refusal = \"1\")", "Severity index (last 12 months)", "Severity z-scr (last 12 months)"

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Control over hh. resources

```{r}
curr_het_var = "Cntrl hh. resources index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% sexual_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```
### Intra-household dynamics 

```{r}

curr_het_var = "Intra-hh. dynamics index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% sexual_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Benef. share of total hh. revenues

```{r}

curr_het_var = "Benef. share of total hh. rev." 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% sexual_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Spousal age gap

```{r}

curr_het_var = "Age gap (hh. head - benef.)" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% sexual_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```
## Economic Violence 

### Household head is female

```{r}

curr_het_var = "Hh. head is female"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% economic_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

        mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)
    
#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```


### Household head literacy
```{r}

curr_het_var = "Hh. head literacy"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% economic_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

        mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)
    
#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Beneficiary literacy

```{r}
 
curr_het_var = "Hh. head literacy"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% economic_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

        mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Household head nbr. of years of education

```{r}

curr_het_var = "Hh. head nbr. yrs of educ."  
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% economic_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Beneficiary nbr. of years of education

```{r}

curr_het_var = "Benef. nbr. yrs of educ." 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% economic_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Beneficiary share of saving own by partner

```{r}

curr_het_var = "Shr of resources own by prtnr" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% economic_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Control over earnings

```{r}
 
curr_het_var = "Cntrl earn. index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% economic_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))

# "Ever (Refusal = \"missing\")","Ever (Refusal = \"0\")","Ever (Refusal = \"1\")", "Last 12 months (Refusal = \"missing\")", "Last 12 months (Refusal = \"0\")", "Last 12 months (Refusal = \"1\")", "Severity index (last 12 months)", "Severity z-scr (last 12 months)"

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Control over hh. resources

```{r}
curr_het_var = "Cntrl hh. resources index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% economic_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```
### Intra-household dynamics 

```{r}

curr_het_var = "Intra-hh. dynamics index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% economic_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))

# "Ever (Refusal = \"missing\")","Ever (Refusal = \"0\")","Ever (Refusal = \"1\")", "Last 12 months (Refusal = \"missing\")", "Last 12 months (Refusal = \"0\")", "Last 12 months (Refusal = \"1\")", "Severity index (last 12 months)", "Severity z-scr (last 12 months)"

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Benef. share of total hh. revenues

```{r}

curr_het_var = "Benef. share of total hh. rev." 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% economic_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Spousal age gap

```{r}

curr_het_var = "Age gap (hh. head - benef.)" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% economic_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))

# "Ever (Refusal = \"missing\")","Ever (Refusal = \"0\")","Ever (Refusal = \"1\")", "Last 12 months (Refusal = \"missing\")", "Last 12 months (Refusal = \"0\")", "Last 12 months (Refusal = \"1\")", "Severity index (last 12 months)", "Severity z-scr (last 12 months)"

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:8)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)


    mainResults_reg_group$lab[-c(1:8)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:8)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

## Other types of violence


### Household head is female

```{r}

curr_het_var = "Hh. head is female"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% other_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:6)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)


    mainResults_reg_group$lab[-c(1:6)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)

        mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)
    

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```


### Household head literacy
```{r}

curr_het_var = "Hh. head literacy"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% other_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:6)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)


    mainResults_reg_group$lab[-c(1:6)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)

        mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)
    

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Beneficiary literacy

```{r}
 
curr_het_var = "Hh. head literacy"

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% other_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))%>% 
  mutate(estimate = dplyr::recode(estimate, low="no", high = "yes"))

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:6)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)


    mainResults_reg_group$lab[-c(1:6)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)

        mainResults_reg_group$lab <- gsub("high", "yes",mainResults_reg_group$lab, fixed = T)
    mainResults_reg_group$lab <- gsub("low", "no",mainResults_reg_group$lab, fixed = T)
    
#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("yes" = "grey69", "no" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s Tekavoul, %s productive inclusion."), 
                     first(mainResults_reg_group$N), last(mainResults_reg_group$N))
  ) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Household head nbr. of years of education

```{r}

curr_het_var = "Hh. head nbr. yrs of educ."  
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% other_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:6)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)


    mainResults_reg_group$lab[-c(1:6)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Beneficiary nbr. of years of education

```{r}

curr_het_var = "Benef. nbr. yrs of educ." 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% other_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:6)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)


    mainResults_reg_group$lab[-c(1:6)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Beneficiary share of saving own by partner

```{r}

curr_het_var = "Shr of resources own by prtnr" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% other_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:6)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)


    mainResults_reg_group$lab[-c(1:6)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
    
```

### Control over earnings

```{r}
 
curr_het_var = "Cntrl earn. index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% other_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:6)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)


    mainResults_reg_group$lab[-c(1:6)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)


#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```
### Control over hh. resources

```{r}
curr_het_var = "Cntrl hh. resources index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()


mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% other_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:6)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)


    mainResults_reg_group$lab[-c(1:6)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)


#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```
### Intra-household dynamics 

```{r}

curr_het_var = "Intra-hh. dynamics index" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% other_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))



# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:6)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)


    mainResults_reg_group$lab[-c(1:6)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Benef. share of total hh. revenues

```{r}

curr_het_var = "Benef. share of total hh. rev." 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()


mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% other_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:6)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)


    mainResults_reg_group$lab[-c(1:6)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```

### Spousal age gap

```{r}

curr_het_var = "Age gap (hh. head - benef.)" 
median_het = median_val %>% filter(het_var==curr_het_var) %>% select(median_value) %>% as.numeric()

mainResults_reg_group <- mainResults_het %>% 
  filter(outcome %in% other_ipv_vars, het_var==curr_het_var) %>% 
  arrange(name, typeTreat) %>% 
  arrange(factor(typeTreat, levels = c('Cash Assignment', 'Capital', 'Psychosocial', 'Full', 'Pool')))


# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Order 'typeTreat' and 'depvar' factors
mainResults_reg_group$typeTreat <- mainResults_reg_group$typeTreat %>%
      fct_inorder()

mainResults_reg_group$depvar <- mainResults_reg_group$depvar %>%
    fct_inorder()

# Remove unnecessary prefixes in labels
mainResults_reg_group$lab[-c(1:6)] <- gsub("N high treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)


    mainResults_reg_group$lab[-c(1:6)] <- gsub("N low treat (pct): ", "",
                                                             mainResults_reg_group$lab[-c(1:6)], fixed = T)

#  After all your data preparation and before creating the ggplot
# Convert lab to a factor maintaining the original order in the dataframe
mainResults_reg_group$lab <- factor(mainResults_reg_group$lab, 
                                   levels = unique(mainResults_reg_group$lab))

# Create a ggplot for visualization
mainResults_reg_group %>%
  ggplot(aes(x = lab, y = pe, color = estimate, ymin = `CI2.5`, ymax = `CI97.5`)) +
  geom_point(position = position_dodge(.5)) +
  geom_linerange(position = position_dodge(.5)) +
  geom_linerange(aes(ymin = CI5, ymax = CI95), lwd = 1, position = position_dodge(.5)) +
  geom_hline(yintercept = 0, lty = "dotted") +
  facet_grid(depvar~name, scales = "free_x", space="free", shrink=TRUE, drop=TRUE) +
  scale_color_manual(values = c("high" = "grey69", "low" = "black")) +
  labs(
    x = "",
    y = "Effect",
    color = first(mainResults_reg_group$het_var),
    caption = sprintf(paste0("N = %s for Tekavoul and %s for productive inclusion. Beneficiaries were divided into two groups based on the median value of %s (low ≤ %s and high > %s). "), 
   first(mainResults_reg_group$N), 
   last(mainResults_reg_group$N), 
   median_het, median_het, median_het
)) +
  guides(colour = guide_legend(order = 1), shape = guide_legend(order = 2))+
  theme_light(base_size = 8) +
  theme(legend.position = 'bottom', text = element_text(size = 8), 
        legend.direction = "horizontal")
    #Save the plot as an image
    ggsave(paste0("output/heterogeneity/",first(mainResults_reg_group$het_var),"_",first(mainResults_reg_group$depvar),".jpeg"), width = 10, height = 14, units = "cm")
```




